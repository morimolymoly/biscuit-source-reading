commit e603656259d82de6159afa9cef2a3c0814080aaa
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Nov 26 00:28:53 2014 -0500

    initial commit
    
    JOS bootloader. everything is in C. ha!
    
    probably only compiles on OpenBSD

commit 9ddff3ac353c666716c29e904aa7da5b04bfad28
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Nov 30 08:54:43 2014 -0500

    prep for 64bit

commit 115b4acb928caa1f11d9a270d00fea6d6b890f89
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 1 10:02:05 2014 -0500

    make go disk

commit 4af8fbdef2aa4ae45476ddfb357c73bfa2bd6fbb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 1 11:00:50 2014 -0500

    chentry

commit 27aa1a0f3b6e1b25b781e049aad5036240288a6f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 1 11:55:35 2014 -0500

    make sure elf header is preserved
    
    because i will use it in the go runtime init code

commit 965aef1ef0c12348a6831a4059ba3b0ed541c039
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 1 18:46:42 2014 -0500

    bss hack
    
    save bss start and end so i can zero them in the go runtime init code. can't do
    it in the bootloader because there isn't enough room.
    
    it would make memory management easier if the bootloader loaded the kernel
    segments into physically contiguous memory and then setup a page directory that
    mapped the virtual addresses to the physical addresses. then we could also do
    the bss zeroing before loading.
    
    since we are low on room though, the bootloader would need to be more than one
    sector and thus we would have to change the bootloader to load the rest of
    itself. i'll do this later.

commit 0c70b0e4653bf543abe7dd7579bbcfa72dea9425
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 1 19:12:36 2014 -0500

    first go patch
    
    adds our hacked runtime init code (make it the entry point using chentry) which
    only clears the bss and enables paging right now.

commit 0c090b247b7909be6429026804b143086943b350
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 1 22:22:30 2014 -0500

    multi-sector bootloader
    
    the first sector loads the rest of itself and then the kernel.
    
    this will be useful to load the kernel more efficiently in memory.

commit b7e4b15eddfbe5f00097c709ca5b1f207088154b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 2 10:23:51 2014 -0500

    paging in bootloader
    
    bootloader allocates pages for the kernel contiguously, maps them, and enables
    paging. this makes it easier to manage memory and doesn't assume anything about
    the placement of the kernel's PT_LOAD segments.

commit 7e69145e85fe538ff6708506c38456811308f408
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 2 10:26:53 2014 -0500

    x

commit c331e93fefe6dfe66d55ebfe562e04de70c03f17
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 2 19:08:17 2014 -0500

    64-bit/paging bootloader
    
    no painting ourselves into a 32-bit corner

commit a8c2fc0157ea360adaa45ff04a996ec490febcd6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 2 21:03:59 2014 -0500

    sweet bug

commit 15bedf681688d81a78ffb280143c25fdbb4b71c9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 2 21:49:54 2014 -0500

    64bit chentry

commit 27d356eff2c253871187a8a0b4e651a8d31e4ac2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 2 21:50:10 2014 -0500

    switch to amd64 go

commit 110dc34776b3739e6dd59e18649e2962fb189fea
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Dec 4 10:07:16 2014 -0500

    x

commit f16cf4eabe2547424cb9c75123bca8e0b98eb3a4
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Dec 4 19:48:31 2014 -0500

    another sweet bug
    
    cannot clobber ebx since ebx is reserved on 386 with PIC. gcc errors
    instead of dealing with it for you since it may have surprising
    performance results if you are unaware that ebx is reserved.

commit 27c91785b71cd8ebadabc2704d2b562dbc04ff2d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 8 11:03:33 2014 -0500

    checkpoint segmentation code
    
    never ever ever use plan9 compiler/assembler for systems code; they do not
    support data alignment or struct packing.

commit fb34baf0d8a147bd1630a5885f9450e7398d9a12
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 8 16:07:28 2014 -0500

    finish segmentation and thus TLS setup
    
    took me many hours to figure out why far ret to fix CS was faulting. since the
    default operand size of long mode is 32-bits, lret exptected the far pointer to
    be one quad on the top of the stack that looked like: 0x0000SSSSPPPPPPPP where
    S are the segment bits and P are the address bits.
    
    i was pushing two quads, first the segment then the address. that only works if
    you use lret with REX.W prefix (lretq).

commit 21cbbf98bf281a7603314eee4dfd8f3cbcb8cf77
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 8 20:35:52 2014 -0500

    give kernel new stack + guard page

commit 093483cb54a3c672fba2fc9e8f8f207b00bfb77c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 9 16:59:21 2014 -0500

    64bit interrupts
    
    useful for debugging

commit ef78116dc3c756468ebff1800ad6834c88501502
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 9 18:29:55 2014 -0500

    initialize x87 FPU
    
    i dont know whether the runtime depends on FP arithmetic

commit adab2c77653a2ee0cbef752f72ffa0e7a10985f3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 9 19:12:34 2014 -0500

    args, fake osinit
    
    runtime init is nearly done! only schedinit remains

commit 8c9494dbfbd7a4bd5f67c78d23e31c4e524e1af0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Dec 10 18:34:35 2014 -0500

    set WP too

commit b960c6718cf44dc6d639b6239305afee23c0c30c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 11 11:13:24 2014 -0500

    alloc bugfix

commit 0f121fbc25619323033e15caeae27d02abd6fd54
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 11 11:24:14 2014 -0500

    recursive pml4 mapping

commit 5461f9f3cbad091b4b2adff3fe8f0a2850aef138
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 11 12:40:25 2014 -0500

    actually set wp bit instead of fsgsbase
    
    on the plus side, i learned about the wr[fg]sbase instruction.

commit 129c91ab21a8a0cd2b297bff8f1380951c8771e8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 11 13:19:53 2014 -0500

    physical mem allocator and pgdir_walk
    
    for the second time in my life, somewhat complicated code worked exactly as
    expected on the first try. can i have a phd now?

commit e20f45f2e4df5bfabf004751448d67f4837516f6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 11 20:29:12 2014 -0500

    hacked m{,un}map, pgdir_walk bugfix
    
    ammusingly, my celebrated pgdir_walk was completely broken

commit d1ebc19a9ef8e6bac364d91770e609999f60d6f6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 11 23:31:12 2014 -0500

    x

commit a636254d2b5ef7fc7c644c5a97adbf336e851d31
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 14 22:40:00 2014 -0500

    pass schedinit()
    
    fix vm stuff and hook m{,un}map. several other hacks that should be remedied
    eventually:
    
    - disable profiling; it calls callers() which breaks somehow, probably because
      gentraceback assumes something about the stack. track this down!
    
    - comment out some calls to nanotime(); it was used to figure out when to poll
      the network and when to unmap pages
    
    - lie about number of cpus: 1

commit bbb6d0996381f9f5df5bdeee65f4b3e043c9f8dd
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Dec 20 12:19:16 2014 -0500

    move notes to doc-biscuit

commit 733a5d305f2cbdbbe26506bc0173bd49d5ff4be6
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Dec 21 10:52:04 2014 -0500

    make gcc happy by not clobbering reserved PIC reg on 32bit (ebx)

commit 26dc84ad239de17143b7da046586f11bbab14554
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 21 22:09:16 2014 -0500

    don't cache writes to VGA memory

commit a0a80a6b01fd7e599ff57b8e44114753c5581d7f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 22 00:27:04 2014 -0500

    checkpoint LAPIC/8259a initialization
    
    need timer interrupt to support clone()

commit bb563d5e0d402f56c92db0b62c234c57c4b9a354
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 22 12:53:23 2014 -0500

    timer interrupt init and trapret
    
    hook clone and write, noop sigprocmask, sigaltstack, and sigaction

commit 215573e5127e143462767917a3d1f88924e96b4f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 22 15:57:40 2014 -0500

    multitasking, start clone

commit 281dc0d458fb0667a7226090255d4abf2b1571e4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Dec 24 03:14:42 2014 -0500

    save/restore fs base, clone

commit fc32a5b86326f4ad9dc9dd9a1f83370cfc29d848
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Dec 27 18:24:23 2014 -0500

    hello world kernel works
    
    not much else will

commit 433bbf4b8572aeb567aaff02aa2bd888c97abc49
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Dec 27 18:55:45 2014 -0500

    remove old header

commit e463ca8137d393e1286aaf137908cb5c6ef17f24
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 28 17:23:54 2014 -0500

    fix makefile for new layout

commit 5eef224c8fdbb76d727b018ff068227aac5ebc81
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 28 17:26:02 2014 -0500

    don't stack check recursive pagemapping functions

commit dd59f7588b5a182ee84a9e73d6ba6890129abe32
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 28 17:26:52 2014 -0500

    disable profiling
    
    it uses callers() which is broken for some reason (may be because go assumes
    stack size of 3 pages on linux?). track this down!

commit b5b01c8fdc556bede462a2f3dbdf285b81252608
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 28 17:28:35 2014 -0500

    lie about number of cores

commit 81c40888fe49d25617643aa9ed0957547b365794
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 28 17:38:32 2014 -0500

    virtual mem, interrupts, multitasking, and runtime initialization

commit 7a444c5579ed8421834a89eabef6e7d687d21cc4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 28 17:40:23 2014 -0500

    print in throw()

commit 9b6d828a03d83528255289abe24e57ad789d76d5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 28 17:41:49 2014 -0500

    add our entry point

commit 5ac4bac1867c1cf661af4b69fb74235509c930dd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 28 17:42:06 2014 -0500

    hook syscalls for hackmode
    
    exit, write, usleep, clock_gettime, nanotime, sigprocmask, sigaction, mmap,
    munmap, futex, clone, and sigaltstack

commit 91caf7c93dd63ddc70302d2d28302f364674ac1f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 28 17:43:10 2014 -0500

    hook general syscall interface provided in "syscall" package
    
    only handles write for now

commit e57736adbfb87735340ba8cf252c3868e15a39a3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 28 17:25:15 2014 -0500

    lie about version string
    
    the version of dist we use requires that the go code is in a mercurial
    repository in order to choose a version number for the build.
    
    we use git now so lie about the version number

commit 30bce134e9a7fdc79c647cf9e6e701c245196ba3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 5 15:32:49 2015 -0500

    correctly save 64bit fsbase

commit ce32db57a5b3b4e2818c11f7208bfc8ad8ab5798
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 5 15:33:15 2015 -0500

    hook runtime-usleep, tweak timings
    
    will set timings correctly later

commit 83f0f9ac15495b5f7988a4b56347020669313612
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 5 16:03:00 2015 -0500

    noop madvise

commit 4d531fa41f2d0e26dd4ed9d61df33b4f60953e1e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 7 11:33:40 2015 -0500

    noop yield

commit 39a0208c8be70ec3064bd70f4047d869182d44d2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 7 11:39:12 2015 -0500

    go threads
    
    no parallelism though since we only use one cpu currently

commit 37c11f34743cce6a737ed9500c87984e3cc4df8c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 7 12:36:58 2015 -0500

    toy ip code

commit 2d2e2eb997a31c95accd25355bd8377dab5dcee1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 8 17:03:04 2015 -0500

    parallel write

commit ca20cfd5d989d5f939bb9cfb403486ecf2ac71bb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 9 11:28:10 2015 -0500

    rcu toy

commit e2b90b28460c5c182a19ba4fccc0fbd9450bafbb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 9 14:14:13 2015 -0500

    route table rcu

commit ad6d42827ad91457376e211cb4df704b41368f24
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 12 11:05:56 2015 -0500

    print wrapping

commit 3e42892789cdd1ba6416e7a3a3073ad6efea0547
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 12 11:12:04 2015 -0500

    remove unnecessary go patches

commit 899aeccf8e0b31b67b6e3f0fdb7a992eae99ccd3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 12 11:47:45 2015 -0500

    nits

commit 0ef3145e9227a6e2af9b3384357e920f30ff89b5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 12 18:11:13 2015 -0500

    e820 map for phys mem allocation
    
    that was not fun

commit aef9fe1364ada06733c4cf6ddc6fe11ee93e7b6f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 13 09:56:59 2015 -0500

    x

commit 73e1c51794b53774e0455bea0e94c7e546302493
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 13 12:07:24 2015 -0500

    less hacky nanotime

commit 12347a7f175c3bd775a0628d4debf348df95f9d6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 13 14:19:38 2015 -0500

    x

commit e86ca876973faa3f8c2dbeac16756907d5a02d30
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 13 15:09:27 2015 -0500

    copy main.go to tests.go

commit c1ee664573dc563f1c65e92230cfd6205fc42ed8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 13 21:44:37 2015 -0500

    baby go scheduler
    
    unfortunately, the trap handler itself is probably not that useful to write in
    go since, as go uses cooperative threads, a go trap handler interrupting its
    own go code is likely to cause problems.
    
    export helper functions too

commit e0ddec7ec7b0dfbe52f855f75b7d878d4fa6eb32
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 15 18:11:25 2015 -0500

    futex
    
    go uses futexs to sleep

commit 40dab6659da8f4a78bc994df24ae8446caf3dec5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 15 18:18:39 2015 -0500

    checkpoint bizarre go traphandler/scheduler
    
    need an idle OS proc if we want to handle faults caused by kernel go code which
    require immediate service. set maxprocs = 2 and do other stuff to make it work.

commit 69fee87513877a754faafd75c810b1a3a09928f9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 20 11:29:01 2015 -0500

    silly bugfix

commit a9476ab6c941c56ad37dc2c46c9662c320b76767
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 20 11:31:42 2015 -0500

    new trap/scheduling design and syscall stub

commit 418cba6989018144ba0a8f8e4affb65cd41fcad8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 20 16:31:15 2015 -0500

    checkpoint user programs + syscalls
    
    moving user programs to ring 3 next

commit 373f222385a59c8e30b980c817d63c94712f40a9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 20 19:20:50 2015 -0500

    put user programs in ring 3
    
    the test user program will crash unless the page tables are marked PTE_U.

commit 50ecbbdbd584d578e325aa6bc8fcbf6ec6ee2cc1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 21 16:31:09 2015 -0500

    go virtual memory management
    
    this will be useful for user program setup.  cleanup types too.

commit 5916a03063a17759f366b5a1b358295fa4f7fdb7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 21 18:28:50 2015 -0500

    don't use Vtop for every allocation and bugfix
    
    an interesting thing about this code is that there is no physical memory
    allocator.  it uses the garbage collector to allocate pages and keeps
    references to them in per-process maps of allocated pages. thus when the
    process struct goes out of scope, the page tables are reclaimed.

commit eee205a1aa4dbd4e9080398be06a0384ee10f8f3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 22 12:50:12 2015 -0500

    finish test user program
    
    uses its own page tables now.

commit 77bb8f3ddd168e95bea2b7951ed97382efb0e799
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 22 13:05:50 2015 -0500

    whoops

commit 64c545e1227a47cd047a5aa41e257f34a8387597
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 22 14:01:34 2015 -0500

    more interesting test program
    
    reschedule after syscall, terminate if page fault

commit 357e037f6e8c9f2487c39fce4d6beb897932284a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 22 15:26:20 2015 -0500

    always switch page maps during context switch

commit 2857855a2774025a2be6a5236c49ced816c4005f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 22 15:37:41 2015 -0500

    ucookie -> pid

commit 19ee6ffbb2a0706e341df96bfe64f7cb45c831ce
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 22 15:53:34 2015 -0500

    processes
    
    reclaim memory from killed procs using GC(). cool!

commit 2c38b0c06ef06f8996e72fef66ca98a4a6eefa27
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 23 10:08:26 2015 -0500

    x

commit d025305e131ab4e1d45698c07e300d9f72a1e2b6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 23 10:46:52 2015 -0500

    external user progs
    
    will include them in the kernel using bin2go.sh

commit 79ee86d7d34900996d59c0e18ee1a065d56d70c8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 23 11:39:18 2015 -0500

    whoops

commit 8ec240a08ecb401591c66d4b6721703599779e8b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 23 12:49:57 2015 -0500

    glue to include user binaries in kernel

commit 814f7e20607c23ef98b7d5906fbde56db9efc9d5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 23 19:33:35 2015 -0500

    fix evil non-deterministic bug
    
    because the go kernel runs in ring 0 and grows its own stack, the stack while
    handling a timer interrupt may not be mapped in every process. thus, during a
    context switch, the ret instruction in the lcr3 function faults. because the
    stack is no longer valid, a triple-fault/reboot results.
    
    one fix is to inline lcr3. that way the stack of the interrupted task is not
    used after the new page map is loaded.

commit 8f6094387dede531b61a46fbf344bb03da756e97
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 23 19:39:52 2015 -0500

    use the IST for double-faults
    
    the IST is an awesome feature only available in long-mode. it makes the
    processor switch stacks unconditionally, regardless of new/old privilege level.
    
    thanks to the IST, buggy kernel code or odd kernels that grow their own stacks
    don't triple-fault, but helpfully double-fault.

commit 311b76b148c5828841f322a8780f849fef719bf1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 23 19:44:31 2015 -0500

    small bugs, debug code

commit 1409579d88b7da6337d98acfb2fd984fc747389c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 26 19:35:57 2015 -0500

    fix write
    
    panic tracebacks seem to work now

commit a5a9d469f5e63b904b81d81754933b5912fea173
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 23 23:30:39 2015 -0500

    elf user programs
    
    any elf object in user/ will be inserted into the kernel as an exec'able
    binary.
    
    it would be nice to strictly separate address ranges of kernel and user
    programs.

commit db6146037f35fb5551a73b6470b2f097ff032704
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Jan 27 22:45:50 2015 -0500

    during boot, don't allocate over kernel's elf header

commit cb7a3a0c7cece65edb64b84dd7fc918308aaf587
Merge: a5a9d469f5 db6146037f
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Jan 27 22:54:59 2015 -0500

    Merge branch 'test'

commit 332fd08304791bad133b20e701c271355824e3a5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 28 09:39:35 2015 -0500

    move pmap stuff to pmap.go

commit 8b3aed756594ec41af10e42c878c05878ef27292
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 28 10:00:39 2015 -0500

    newlines

commit fcd8521060e78927edc495a53f8f20b07e52679a
Merge: 8b3aed7565 cb7a3a0c7c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 28 10:00:51 2015 -0500

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit d14a07795fbfeb289f67a0ff02b0eb4eca9c3f40
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 28 11:07:33 2015 -0500

    remove Death()

commit 8cceed5a89a84ab34ee4a5e38b0a8c92715b225d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 28 11:08:59 2015 -0500

    reduce unsafe casts

commit 8c4ae639a1b863c847078de09a3249077265a254
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 29 18:07:07 2015 -0500

    errors to stderr

commit af4dfcf8673af71c3c914043debc982c6a5a0390
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 29 18:15:00 2015 -0500

    SMP
    
    find and initialize cpus. the test boots up all found cpus (controllable with
    CPUS env variable) each of which print a hello message, spin for a moment, and
    then fault to make sure the IDT/GDT are properly setup.
    
    there is no synchronization yet. next step is to make the runtime/kernel
    thread-safe.

commit 5bb766a7a62373bb9e444fa9852f3d26e4ea82f5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 30 10:18:19 2015 -0500

    reduce unsafe casts

commit 0a2a840b325d1a9af400eb66f5d9a1a401a8775f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 30 11:21:38 2015 -0500

    disable newlines for explicit panic

commit 4fcb3dc4cfefff837f3bd453d988314e104d91f8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 30 12:36:59 2015 -0500

    setup AP stacks
    
    enter the terrible world of multicore

commit 3af60b7bc16a62b07aaefc4089da7c5d65ef1d30
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 30 15:32:01 2015 -0500

    initialize lapic/TSS on APs
    
    shuffle stuff around so APs can reuse init code

commit ba56baba55a83523ba96b67faa97578208fc3db4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Feb 1 15:44:08 2015 -0500

    serial console driver
    
    now i can actually debug biscuit over slow connection remotely.

commit cffb62b5e4b509ab76eb134641d137bfd9c18217
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Feb 1 15:45:18 2015 -0500

    don't set G (granularity) in segment descriptors
    
    although segment limits are mostly ignored in long mode, the TSS limit is not
    ignored since it is necessary to determine whether or not there is an IO bitmap
    (bitten by the damn IO bitmap again!)

commit 0cb270d196f2669a18b244c794294db067fb6917
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 2 19:01:02 2015 -0500

    serial console by default

commit 53896135ff6a10c16c3f68cca952ebf21ed258d0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 2 19:04:30 2015 -0500

    increase stackguard to 768 bytes
    
    the largest stack size of all trap paths is > 512 bytes

commit 52007cc98cb8963c1f63ef69cd35112d77b9daf3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 2 19:04:18 2015 -0500

    parallel runtime scheduler
    
    there were many bugs. discovered a bug in the plan9 C compiler and the plan9
    assembler on the way.
    
    now kernel parallelism should be easy. scheduling code desperately needs
    cleanup; will do this soon.
    
    hack_futex has been band-aid fixed -- need to fix it properly later.

commit 33ae3648201e48c0e259fe6dff15b1af6aaca4cf
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 2 20:30:09 2015 -0500

    raise GOMAXPROCS and NTHREADS to 24

commit 39dad4bd6d345346414167243e5e091da239aeb8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 4 15:43:46 2015 -0500

    evil bugfixes, fix futex
    
    all bugs were races in the scheduler/trap handling. they were hidden by a slow
    implementation of futex. there were 3 races:
    
    1- since go code is in ring 0, timer interrupts during go code are taken on go
    stacks. consider the following events on CPU1:
            - takes a timer interrupt while executing go process alpha
            - acquires the scheduling lock
            - marks alpha as runnable
            - finds and marks a new process as running
            - releases the lock
    then before CPU 1 has time to iret to the new process and stop using alpha's
    stack, CPU 2 starts running alpha and itself takes a timer interrupt
    overwriting CPU 1's stack.
    
    solve this by using the IST to always take timer interrupts on kernel stacks.
    alternatively, we could release the lock in trapret() once the stack will no
    longer be used, but it seems better to always take traps on the interrupt stack
    anyway.
    
    2- user application page faults. trap handler running on CPU 1 posts exception
    to go kernel, which is running on CPU 2, and go kernel immediately responds by
    terminating the application, reclaiming the page tables while CPU 1 is using
    them.
    
    solve this by changing to the kernel's page tables whenever posting a trap that
    may result in application termination.
    
    3- when a process on CPU 1 is trying to go to sleep for a small amount of time
    and marks itself sleeping, another CPU wakes and starts running the process
    before CPU 1 has yielded and stored the process' state.
    
    solve this by marking a process as sleeping in the timer interrupt, not
    futex(). thus a CPU trying to wake processes up will not mark the process as
    runnable yet.
    
    in conclusion, i am desperately trying to simplify the design!

commit 0c537359567f46404c57e008ed45e8d4e6d9b840
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 4 17:07:19 2015 -0500

    actually fix futex. whoops

commit 6e83cb549a8055be786d1ce7bc268369cf379d04
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 5 14:22:52 2015 -0500

    fix direct mapping
    
    funny bug. didn't discover it earlier because dmap() is currently only used to
    map physical memory under 1G.

commit 333420ea8e72883878e542b5b1271add29485382
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 5 15:36:26 2015 -0500

    fix elf loading
    
    was accidentally filling every page of each segment with the first page in the
    segment.

commit 4f03c124a56f2eef79bac417c21fb7c55d1fd7d5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 5 15:40:50 2015 -0500

    write syscall

commit 8af1a65e6794ba21365d3aa08172c600f3b3317f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 5 16:06:29 2015 -0500

    exit() and fault program

commit b3f3d16dd6868385cff7eebd7bff71591191276d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 5 17:36:11 2015 -0500

    don't destroy process
    
    needs to be fixed correctly later

commit f27fc81623c3456ff0ae11c9edb02f2ac12e1af7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 5 21:13:58 2015 -0500

    try to make gcc link user programs at high addresses
    
    use PIC to encourage the generated asm to use rip-relative addresses, then the
    instructions don't need more than 4 bytes to encode addresses.

commit c03e7c0fa946e8a080bfb7cd41982626a3bbc1d1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 5 21:27:54 2015 -0500

    fix elf loading again

commit abdd5cb51a7897babd792daaf1a30d855e6ebc58
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 5 22:13:07 2015 -0500

    primitive user-space printf

commit 4d563bdc5399b29ba0aed5b3996611411488c768
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 6 14:54:11 2015 -0500

    more printf
    
    yes, i know -- on to more important things.

commit 2e1f4e35a07100b8f9121546a46680ca5bafc999
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 6 16:07:01 2015 -0500

    don't use pointers to slices

commit f8f458eb818e680476f6b4a23dbb8e6634cffd31
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 6 16:09:15 2015 -0500

    don't give user programs VGA anymore

commit f9b749926a13226ae7cb9ca7eb86f5ed7dea444d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 6 16:55:25 2015 -0500

    wrap user main()

commit 517ccb27973338720f056dc0e19ad3b0dcb97dec
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 6 18:47:38 2015 -0500

    use IST for syscall and page faults

commit 27a8fd492d5c8cd9bdd4be2452c37a199f90eccb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 10 00:32:44 2015 -0500

    fix memprofiling

commit 550effd66d4a138ed246c98198e5935569e85605
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 10 19:43:10 2015 -0500

    specify qemu binary

commit 735431be5d22041d282e226ff9367dfd72142c3e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 10 20:13:11 2015 -0500

    yield in usleep instead of spinning

commit 0b16699f931fa679ec056e0fdf1b6d2c4a2b61d5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 10 19:58:15 2015 -0500

    stack check invlpg

commit 982ce795749af1fe1c23f4e6dad5e03e74449a6a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 10 20:10:26 2015 -0500

    stack dump goroutine too, in case it used onM

commit 4d44bd0305fd4e497963415198ec4bde5a349913
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 10 20:11:32 2015 -0500

    memory checker (disabled)
    
    sanity checks pages allocated before giving them to go. it writes the page with
    a poison value and then verifies that the page retained the poison value.

commit b7d4fd1d30f9ebfd3cec4c5893a0969692a0a204
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 10 20:14:59 2015 -0500

    halt other cores when any goroutine calls exit()

commit f645ae8782478b13033c123fb8524050b54fbd08
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 10 20:18:24 2015 -0500

    make gothrow work again, now that panic works

commit e33b2951d9eaa6977ab0cd04774a5b743f88c366
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 6 18:48:53 2015 -0500

    copy-on-write fork
    
    pretty cool! much easier to write when the forking code isn't itself
    interrupted by a page fault.

commit 4243a217f81922e2bf844aa39dd2844e71b68d43
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 6 18:59:30 2015 -0500

    getpid for tests

commit fb559b6811b566960600daa383f55a2c534ed3d6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 10 19:56:10 2015 -0500

    horrible goddamn bug
    
    go uses SSE non-temporal moves for fast copying and zeroing of newly allocated
    objects. if you are very unlucky, a zero-initializing go routine may be context
    switched after a copying go routine. since my scheduler did not save/restore
    FPU/SSE state, the SSE registers used were not saved/restored on a context
    switch.
    
    the end result was newly allocated maps having segments of 128 non-zero bytes
    and copied objects having 128 byte segments that were zeroed.
    
    save restore SSE state, and fix a few other bugs like serial access to mmaps,
    trap queue, and syscalls with locks (i'll remove these coarse locks next).
    
    also do go routine stack checks manually in C stubs -- the stack check inserted
    by the compiler panicks if any C code runs on a go routine stack. this makes me
    nervous because i'm not exactly sure why...
    
    goodbye four days of my life

commit be7c14228aa9ff8b07057a0be0aee8e22ec5556c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 11 10:44:16 2015 -0500

    go red/black tree module
    
    useful for debugging

commit 22e233447dd3b04efa6598262bd43b5abda6e6d6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 11 12:52:21 2015 -0500

    remove paranoia code, better fork test

commit 19f411b35a6312db039bd8cfa47a7e93edc0f826
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 11 12:52:58 2015 -0500

    script to help dump important data in gdb
    
    for some reason, it seems that gdb doesn't know the addres of some of my C
    symbols.

commit b8c90090d3a8ff80e240c92c6b448123083dac8a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 12 11:40:39 2015 -0500

    zero bss correctly in bootloader

commit 45823c67235655908504cff858bbc1560d1a6d6e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 12 11:53:47 2015 -0500

    lockfree per-cpu interrupt circular buffers

commit d0bef61078392506dc6a972dfdbf8a67f1eedc87
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 12 17:18:42 2015 -0500

    remove more paranoia

commit bda6cd8ad16cd0a4bbaf019764fc2744e13b9081
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 12 17:20:06 2015 -0500

    always switch to kernel page map
    
    this is ok because CPUs will always switch pmaps anyway as the interrupting
    process cannot be serviced immediately.

commit 759b2129e5926e038a247bcec7e950193c6c4855
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 12 18:30:06 2015 -0500

    serialize syscalls, parallel page faults

commit a1677af02ec8c568b49357ff12c528c0e40be807
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 12 19:10:38 2015 -0500

    fork for many moons

commit e01df541a9e4a43e767795771e4a5a6ee624aed1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 12 19:41:15 2015 -0500

    open syscall
    
    start fs stuff

commit d74ef69d3767646087bf1ec13988af9151af6764
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 12 21:34:13 2015 -0500

    fs interface
    
    need to figure out on-disk data format

commit 4b19b4e7b5c3ec511f1094d78c44cee4a4e6d032
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 12 21:38:05 2015 -0500

    fstest.c

commit 00c61ace6b20cf3175d1104bfe1d4be52c013be0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 13 14:50:22 2015 -0500

    show serial console when using vga too

commit 6cdc5a371a01a03ea35586b020388e0d6536f414
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 13 15:03:36 2015 -0500

    irqs
    
    prep for ata pio driver

commit 5c0351af5230d7b8b13635ee0402a5359372ba18
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Feb 15 20:47:30 2015 -0500

    ide disk driver and ide server go-routine daemon
    
    kernel code submits requests for ide reads/writes through a channel. its very
    straight-forward! we get kernel thread sleeping/wakeup and safe queue access
    for free via go channels. see ide_test() for example code demonstrating how to
    use the ide daemon.

commit d88b83568749b086e731f03d965081637808ae64
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 16 07:27:27 2015 -0500

    x

commit 9dad0d2841b557f0192313614a60ce3320d75f8a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 16 09:41:21 2015 -0500

    simplify trap/yieldy

commit f8659af6378f3220da230716cf79d86979fca9a4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 16 14:21:44 2015 -0500

    block cache

commit 56f76daebb10ee1718620b75ce6267e5962f20bc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 16 14:26:03 2015 -0500

    don't hold block cache lock over ide read for cache miss

commit 91bb9ae50b42de52d49343cc13fe0a73c540b8e8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 16 16:25:01 2015 -0500

    fix roundup

commit 6015ceede51000dedb3b91ae6f885a8ac280fb88
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 16 17:49:52 2015 -0500

    build a biscuit fs
    
    don't assume that the fs is on a separate disk, making it easier to boot
    biscuit on real hardware. therefore we need a mechanism to figure out where the
    fs blocks start. instead of using a real MBR, just write the bits into a
    special variable in the go kernel binary.

commit 4ca384e0e327d42a2352585f9dcfe36775e0d55a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 16 18:28:32 2015 -0500

    don't try to take spinlock in hack_exit()

commit b08febab3f62c125894f78be5b7901278a0fbf14
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 16 18:40:25 2015 -0500

    default superblock values

commit bab4bddca321f0370835fe45e7ae4949905b2414
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 16 19:00:34 2015 -0500

    basic superblock/inode decoding

commit db9f6e66310c134eb6bd008451435389c62daff1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 17 12:09:34 2015 -0500

    inode/superblock decoding
    
    avoid using unsafe pointer casts and decode the bits from the underlying block,
    which forces me to use getters/setters (ugh).
    
    don't segregate free blocks into inode/data blocks. now inodes are identified
    by a block/offset pair since four inodes are packed into one block.

commit 40a8b6d7fc07abcb952bee2752537f0774952aea
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 17 12:49:04 2015 -0500

    simplify futex shit again
    
    there is less concurrency now as the futexlock is held across the soft
    interrupt to yield, but the code becomes simpler. seems to make little
    difference for performance.

commit 83b41c48683d621b52e15c946736ea5e2537b51b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 17 15:23:07 2015 -0500

    block allocator

commit f4b41627b37d40e21260073b27e54f5f0f957876
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 17 16:43:02 2015 -0500

    put first fs block number in mbr intead of go kernel binary

commit ce66c861ad692f1d4e2ff751b1cc9903586691e3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 17 18:39:48 2015 -0500

    directory entries, kernel ls

commit 123c861e7cc0d60ca9f92c5303d06d74e3fbc2ed
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 17 18:45:22 2015 -0500

    inode size cannot be in blocks

commit 6fe47d117c609fc9f48439dcd0dd3972b1112665
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 18 14:35:50 2015 -0500

    mkbdisk.py
    
    builds a biscuit fs (with bootloader and kernel image) from the specified
    directory, recursively adding all directories and files.

commit 8bec3cf0c80e2ff467ac3b4af27cf622c7e782da
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 18 14:35:03 2015 -0500

    build biscuit fs from fsdir/, recursively ls in kernel

commit 36b0c110cb1e0f90539d7e0d15d822b600df3463
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 18 14:53:38 2015 -0500

    write freeblocks too

commit d606230fa0afffde986396724cc35d166167705a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 19 11:19:13 2015 -0500

    colored text for tests

commit e691286fa84c0b8114a6f1e124be63834d36ec2d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 19 11:20:18 2015 -0500

    readonly sys_open

commit c2d933990eae023d87b3e02e0fe7d7612935670c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 19 11:32:16 2015 -0500

    string support in printf

commit 3ed45876c6b8a14ad4688bc205568a0e51cff77e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 19 12:43:44 2015 -0500

    sys_read

commit 352c56e05a65e17579e8e403bbb670b33421ecb9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 19 12:49:02 2015 -0500

    x

commit 0630baa614c62ca7b31d142ad3a53ebca6e9a5f0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 19 12:56:27 2015 -0500

    increment fd offset too

commit d325b55ec73e51315d2a563f98827d8539e4073b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 19 13:01:40 2015 -0500

    x

commit 2d6c77a15ad0642021484501058d997ea2c43480
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 19 13:38:41 2015 -0500

    don't pass around inode block offset

commit 6ed7efe6a368f061178b504cad6ca63462465f6a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 19 18:46:16 2015 -0500

    remove syscall lock, parallel syscalls
    
    seems ok with 1, 6, and 20 cpus

commit 839915f98b3111fccd64ecc43be7e735ece4e487
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 20 11:13:47 2015 -0500

    concurrent fs syscalls
    
    we only have open/read so far, but now i have a concurrency story.

commit 863e1c6916657a17f7f174467f460e739173a6db
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 20 14:50:04 2015 -0500

    typo

commit 5dec31f2c7f895c08d5d492c221e946426aad4aa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 20 16:03:47 2015 -0500

    user snprintf

commit ff4fdc1cb5959b0aa30695e202eba0b9c8845afe
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 20 17:16:56 2015 -0500

    concurrent sys_write
    
    and user/fswrite.c to test it. next up is mkdir(), then logging!

commit 2396b3e993fd535c2cbc75791d58aef289955fb4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 23 10:28:19 2015 -0500

    user mkdir/errx/vprintf

commit 365f4220c87bb2a1fc652607ab372bd36d13b3ea
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 23 11:10:26 2015 -0500

    share locks in file-tree lock nodes to sync access to inodes

commit 5115d48cad329ec96dd5778f8531fa0c930ad8f4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 23 13:18:34 2015 -0500

    mkdir, O_CREAT, and user test programs

commit b37c4692d42a6e6a9e0ddc36ad951c640f4631fa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 23 15:47:27 2015 -0500

    make halt work

commit 7521f0925ccaee802506d4314996499644964737
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 23 16:20:30 2015 -0500

    fix padding in mkbdisk.py
    
    the old code adds an empty block if kernel is divisible by block size

commit c14beb90191e74163c20c48596a5eed576fbc664
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 23 19:23:22 2015 -0500

    journaling fs
    
    neat! fs syscalls talk to the logging daemon for admission control and
    committing.
    
    haven't written the recovery procedure yet. poorly tested so far too.

commit ee492129eeb72a404980588876590f19781a1dd5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 23 22:55:58 2015 -0500

    recovery routine

commit 8f9858db4b9aa7e0b47ec67463c71d4603c8b254
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 24 10:42:40 2015 -0500

    user argc/argv

commit fb3a928406d9eca048f045d1e266eeba30d11f74
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 24 11:02:39 2015 -0500

    only acquire fs log space and lock files if writing to fs

commit b2a77037f54130bcc1c443c9b534bf2691b76aa5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 24 11:07:32 2015 -0500

    note superfluous disk read in log commit

commit 27d7ef1e9736221ce200b089faaa7aa5903297ba
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 24 11:12:04 2015 -0500

    move PIC code out of fs.go

commit 3af0f571d394d6c0fd0cb15a01aa9c6e0ec7d2b1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 24 11:44:29 2015 -0500

    fix deadlock bug which i just introduced
    
    must get log admission before locking any files, obviously. if a thread blocks
    on log admission but has a file locked, a thread with log admission may then
    block on the file too and thus will never relinquish log access.

commit d102b8e80eef63c72526ec8755e048d42b04ecf5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 24 11:46:12 2015 -0500

    remove panic; this is not an error
    
    two concurrent syscalls may allocate inodes on the same block (though the
    syscalls will then serialize via inode lock).

commit 376d67e38b5f73fc15212ec70493f4282f457402
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 24 12:39:40 2015 -0500

    x

commit 487c35cd43b66071f54f9740830594aa63185965
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 24 17:06:37 2015 -0500

    block cache daemon
    
    no inode cache yet which is required to prevent deadlocks during directory
    entry creation -- thus fsmkdir test fails.
    
    i will kill the lock tree once inode cache is ready.

commit 344a652981645d7d99261d3c5a68a52f62705b3d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 25 14:44:57 2015 -0500

    don't do commit protocol if the log is empty

commit a1615219e9787a113023dc362c57823b9c144e89
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 25 09:22:06 2015 -0500

    read-only per-inode daemons/inode cache
    
    not sure what the termination story is yet.

commit ca3a52f3c937f6d4aa9293ae0a31b0c546d3499b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 25 14:54:39 2015 -0500

    let fs_read return an error

commit 3df7a412fc54356a64fc6664ecf2fa8ebcc6c352
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 25 16:47:37 2015 -0500

    finish conversion to per-inode daemons

commit 82b3d49c46a0ec0205fdf83a552b28238527eef9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 26 11:11:59 2015 -0500

    init fslog before trying to recover

commit 8a8e8812c0f0e60635be3c0e3699d4ef31c6f242
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 26 12:36:49 2015 -0500

    simplify file read/write

commit e516367eb55ac38786b8244e59ccf9391eb27c1b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 26 17:24:40 2015 -0500

    whoops

commit 122d4b09b7da13a550284b922ff6e864223d1b74
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 27 13:40:31 2015 -0500

    bigwrite test

commit 8ebea76b92880dbe7f843b3f9b2d9b5a83dbc257
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 27 14:42:58 2015 -0500

    waste a bunch of time doing very little
    
    rtm would scold me

commit 13ecd031e4ddbee963e192990273d9195d6261cd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 27 17:33:59 2015 -0500

    start link, simplify

commit f15439a2bd15c985f72efc0949d59cd02651aff5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 27 17:51:01 2015 -0500

    prepare to support inode freeing

commit 361844a92a804ebec096bb1f768e24e9c052949d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 1 21:43:21 2015 -0500

    parition user/kernel address completely

commit b5dca78770826c0c64b283414df6dcf9fbaaf5af
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 1 22:13:49 2015 -0500

    remove pointless elf_t field

commit 1bfa6ddee9947bf0026fa2da77dbe6b480c87771
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 1 22:25:31 2015 -0500

    sys_execv
    
    poorly tested since my user binaries are large enough that they require
    indirect block support in the fs which is not yet implemented.

commit 4950d16cc2aabddafaa34fd1a0e4ee3a21197b95
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Mar 2 08:06:55 2015 -0500

    indirect block support in mkbdisk.py

commit d20e9bf1fad5c0b775649bc0cb32025832c14a7e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 2 08:09:09 2015 -0500

    fslink.c
    
    ugh

commit ff18151272a931bb0bb52c8ffa7ad6f8ad674a40
Merge: d20e9bf1fa 4950d16cc2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 2 08:09:33 2015 -0500

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit 07bf43d8b4fffaa34c729afa9698f3784f5cfed6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 2 09:09:01 2015 -0500

    dont forget indirect block

commit 7b56b6c4587cc573bc88974d174aea90b6dc166f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 2 11:03:29 2015 -0500

    indirect block support for files

commit 5c2b3f7cfcf39eb4fe2b7a89e3e9a228863eb70d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 2 11:32:03 2015 -0500

    run user programs from file system instead of gobins
    
    still keep gobins, since it is great for putting arbitrary binaries in the
    kernel (like AP proc bootup code).

commit 296e54ea1dee3f7586e0f02f3e7ca06302eaad3f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 2 11:57:09 2015 -0500

    throw away worthless sections

commit 45dd96e849a076b96079b5c49b038d2bdcbeb610
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 2 17:11:13 2015 -0500

    resolve to keep .gitignore up-to-date
    
    to prevent me from forgetting to add files

commit 1bc0fe49805a37027fda680c118fa0a517833b1c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 2 17:28:30 2015 -0500

    inode transactions via inode daemons
    
    the basic idea is that some transaction operation is sent to one of the
    involved idaemons. this idaemon operates on the inode state and then sends (and
    waits for completion of) a new operation to another involved idaemon which may
    itself generate and send a new operation, etc. if the transaction fails
    somewhere, each idaemon cleans up and returns the error.
    
    the main challenges with this design are avoiding these deadlocks:
    
    - when simultaneously traversing up and down the directory tree, two idaemons
      may both block sending to each other. solve this by having one
      channel/goroutine daemon per direction (however i think i can make traversing
      up the tree unnecessary altogether, so this is not yet implemented).
    
    - when handling a transaction operation that results in an idaemon sending
      operations to itself. instead of using a goroutine per operation per idaemon,
      deal with this by partitioning the operations into simple/transactional
      operations. both classes are handled by a separate goroutine. transactional
      operations can only generate/send simple operations while simple operations
      cannot themselves generate any operations. (however, directory tree
      traversing is a special case: deadlock cannot occur since each idaemon
      forwards operations its children instead of sending an operation to an
      arbitrary idaemon).

commit 2850453fd408d39e8c827d4667b9af46a9fb29cf
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 3 10:48:32 2015 -0500

    fs_link via simple inode daemons; no general transactions
    
    for link, we can avoid locking both inodes simultaneously and therefore don't
    need to support general transactions over inodes.
    
    link is the only xv6 fs operation that requires atomically modifying two inodes
    (xv6 does not provide rename).

commit 7d44082df7b88d791a3912e17ae5b58c12e76087
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 3 11:27:29 2015 -0500

    only prepend cwd if specified path is relative

commit 5e9c8e17649baa07f14dead5118cf188b2e9d160
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 3 14:07:07 2015 -0500

    sys_unlink
    
    also, unshittify directory entry lookup/insertion/deletion code

commit f15ee725da6a7df220afa16c4c33ffba90792f27
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 3 14:25:41 2015 -0500

    forgot most important part of previous commit

commit 195a2bc950b0b7545b523591ca6f6831cf7851a0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 3 17:10:38 2015 -0500

    don't forget to write-back updated dir data blocks

commit f1d6d2ba84ba54b83ddce2800187414ede053358
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 3 18:39:09 2015 -0500

    make unlink work on directories
    
    unlinking directories is significantly more complex since it requires
    atomically operating on two inodes. this is the most complex inode operation.

commit 18ebe05b119796bdbe394d88a8a76dc5b50e6721
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 4 00:31:10 2015 -0500

    inode freeing

commit 4ca18dd17b0af1eff33f002ba3e9c5352d491cc2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 4 09:53:15 2015 -0500

    fix .gitignore

commit 6f17e65f95d1d312250f4a88d49496f85358f48a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 4 11:08:43 2015 -0500

    fd types, sys_close (nop), start ls

commit bb9d8e7640093c35faf61b4d0444fa19b2016ac7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 4 12:38:44 2015 -0500

    finish close, allocate fds the posix way

commit ed5868829a0d44706196c74824eb3743e2308d56
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 4 13:27:53 2015 -0500

    dmapuser() to make user space memory easier to access
    
    and to avoid a pagewalk for each page of user memory touched

commit ba53963e917bbc051a3678b8440ab8d5cc02665a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 4 14:54:29 2015 -0500

    fstat, basic ls
    
    great performance! takes ~2 seconds to list the root directory.
    
    the reason for the slowness is syscall latency. there is a long delay between
    when an interrupt/syscall is put into the interrupt circular buffer and when
    that interrupt is actually handled.

commit 50bb8bba589a3371d4eff05c21de91ef717214e8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 4 16:29:57 2015 -0500

    whoops

commit 8409defeda4a688769a0713582ca696304e7107c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 4 16:53:45 2015 -0500

    vary user program stack size

commit 094145863c4a5842114a3337171376aa17e20e81
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 4 16:54:11 2015 -0500

    strncpy

commit 4b3821131e069d74caf6f0f994f8777cfa69c5cd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 4 16:54:50 2015 -0500

    recursively ls whole fs
    
    do not run this program

commit 686850dcce55b793698c12d756151dceb6de4ae2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 5 11:21:30 2015 -0500

    reduce syscall latency by over 10x
    
    if there were no kernel threads for a CPU to run, set the timer interval to a
    smaller value so that CPUs with no work quickly find new/available threads.
    
    we can now ls the whole filesystem in < 1 sec. such speed!

commit 31bb5595f37cc92e4a358bd123a1c1d6387ae40c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 5 14:15:12 2015 -0500

    build biscuit net.img

commit f81093100063b89eaedff165f8106748ffe1656c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 5 23:50:25 2015 -0500

    silly bug
    
    the BIOS e820 call of my test hardware re-enables the interrupt flag! thus,
    immediately after we enter protected mode, an interrupt comes in but no IDT is
    setup and we triple-fault/reboot.
    
    now we make it from assembly into the C code; hurray!

commit f9e3b07e4a712891bf9f0074c6afc4b9d76a85a2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Mar 7 09:56:34 2015 -0500

    put e820 map on separate page
    
    test hardware needs more than 7 entries, thus the whole map doesn't fit in the
    first sector of the bootloader.

commit bd01896db1cb7f407775f60060d287302a67f5eb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Mar 7 10:00:40 2015 -0500

    x

commit 8686c9080ffc0f472c9a672b99c6a7c881bc868a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Mar 7 16:58:34 2015 -0500

    use 2MB pages for direct map if CPU doesn't support 1GB pages
    
    my test hardware sadly does not.
    
    biscuit now boots on real hardware!

commit d048b0d057860b97eb416153f2c5b9510e1a52db
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 9 09:11:39 2015 -0400

    send 8259a EOI on disk interrupt
    
    biscuit now seems to be fully working on at least one computer.

commit e6bd0cff43091cc69bf607cd9047d8893b632604
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 9 09:19:00 2015 -0400

    amusing bug in deadcode
    
    thank you plan9 compiler for not generating a warning

commit c501047125c6253efa626190cfad68aff2712ae2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 9 09:25:02 2015 -0400

    zero mmap'ed memory, like linux
    
    out of paranoia since the runtime expects it

commit 9c88046989403b925f92d658a4ae48bac89d2938
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 9 12:33:07 2015 -0400

    reduce thread timeslice
    
    set arbitrarily earlier, it was way too big. makes it unnecessary to use a
    small timer when halting.

commit d463bedf584f7c4ce7247f0f217afd7f52b0dd4b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 9 12:34:48 2015 -0400

    yield the specified amount of time instead of yielding once
    
    though it seems to make no difference in execution

commit 534325f98de3974d724b8f0dd6185c5fb0f1c332
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 9 12:56:25 2015 -0400

    reasonable GOMAXPROCS for test hardware

commit 955ff35b30f876da6cf9c07bbe27883ea6b8b85c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 9 14:57:10 2015 -0400

    prevent kernel threads from polling interrupt queue until timer interrupt
    
    timeslice size was a red-herring -- the syscall latency problem was that once
    all syscall work was completed, all kernel threads just spin in trap() looking
    for interrupts in the queue until the timeslice expires, only then finally
    returning to user-space (only to immediately syscall again).
    
    explicitly yield after Gosched to prevent this. this is not a great solution
    because, if there are many runnable user processes, an unlucky kernel thread
    may yield and start running a user process instead of handling the syscall.
    maybe this doesn't matter much.
    
    it would probably be better to cooperatively switch to trap() -- maybe we can
    do this in the stack growth prologue.

commit 0e2b1a6b672373289771693626b2f5e783dddd32
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 9 16:05:19 2015 -0400

    exclusive access to VGA buffer/serial console IO ports

commit aefcc32c6a904d104169f1c3658032910895c85d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 9 19:57:26 2015 -0400

    delay before writing block data in ATA PIO driver
    
    test hardware hangs otherwise

commit 0ffee04d81658fc6e93973b04f444ab96a042c87
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 9 21:15:11 2015 -0400

    fs bug 1 of 2: take the right lock in ialloc()

commit 7a41cf86801c8532c06f94b4b16232ee6bd540ff
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 9 21:18:26 2015 -0400

    fs bug 2 of 2: free inode block only if all inodes are dead

commit 51d09650859bf36c143006d19a3c545a9797a789
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 11 14:00:10 2015 -0400

    bootloader test image

commit 1430635b8a2da0a88ddc9474a6df201e679e8fda
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 11 16:18:24 2015 -0400

    1st stage boot loader debug prints

commit 2cd382b56a85b714dea7aa6542c75e41a500bf1d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 12 11:00:24 2015 -0400

    fix indirect block allocation/evict 30 bc entries

commit 9dd65e5075c6c319b0ce0765f4ca127c3c656a7e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 12 11:01:21 2015 -0400

    big file write benchmark

commit db2879d13c42ade56e0aca55a50ba5a3102d6e19
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 12 11:02:51 2015 -0400

    node imaging script

commit 52b5355129b49f193a85a3f3adfd0018338b8aa6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 12 15:53:37 2015 -0400

    get disk working with recent SATA controllers
    
    SATA controllers can be configured to support ATA/IDE, typically in the BIOS.
    There are two IDE modes, however: PCI-native and legacy. In legacy mode, the
    controller (supposedly) exactly emulates legacy IDE disks (IO ports
    0x1f6/0x3f6, IRQ 14). In PCI-native mode, PCI may have chosen different IO
    ports/mem and IRQs -- we should get the command/control block port offsets from
    the BARs and the IRQ from the Interrupt Line Register of the SATA controller's
    PCI registers. We can also put the SATA controller into legacy/PCI-native IDE
    mode directly via PCI register writes.
    
    Hard code the IDE port offset/IRQ as per the PCI registers for now. If we are
    using Qemu, use the legacy IO ports.

commit c8ba60b0a24c01ec0cffa3880fc9006fedcda11e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 12 17:57:11 2015 -0400

    unused debug code

commit 7d91880932d599e42d358858d176ac90d5a48fe6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 12 18:03:33 2015 -0400

    use new e820 entries

commit 5fb3de3476ee5bb2fb241970015d0951392d2a07
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 12 18:38:56 2015 -0400

    GOMAXPROCS=8 for new hardware

commit f22a809261947377704a6c49fe9f4cb16b4744a2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 12 18:40:38 2015 -0400

    silly MP table bug
    
    the MP table on test hardware has 4 CPU entries, but there are 8 logical CPUs.
    thus the kernel would map only 3 AP stacks, broadcast startup IPIs and then 7
    CPUs would join, 4 of which were unexpected and therefore had invalid stacks.
    as usual, invalid stacks result in triple-fault/reboot.
    
    so broadcast startup IPI, wait for CPUs to join, then map a stack for each CPU
    that joined. when i implement ACPI (which probably tells me the exact logical
    CPU count), i will wait for each CPU again.

commit c024e672ca9c91af1b04aaf00ace1a745c75b811
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 12 18:53:35 2015 -0400

    allow me to re-run bmwrite without re-formatting hd

commit c7c0fefba2fd9f89742f181201e7925e53204bd1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 13 09:32:43 2015 -0400

    x

commit 87e31402e8c111cf8b332d1256b59aca53c5fe49
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 13 17:35:23 2015 -0400

    bmread benchmark

commit c9ac55d98df5dda3b9d387cede4ba3925ef96201
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 13 17:38:22 2015 -0400

    PCI config space reads
    
    necessary to clear disk interrupts for PCI-native IDE.
    
    fix panic newlines too.

commit 3c0eed5f989d249566d5943895e177f0a8ddddd8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 13 19:40:53 2015 -0400

    PCI-native IRQ stuff
    
    make sure the disk generated the int (the IRQ is shared with some weird,
    unregistered device) and acknowledge the int the PCI-native way.

commit 8b53244a81f4200f4a3044b70f0057e00274c63f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Mar 14 01:04:08 2015 -0400

    don't take printing lock while interrupts are enabled
    
    otherwise can't use printing in interrupt handler

commit d423b9dac3d77dc8b4d74276fbf4c6b04b89efea
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Mar 14 01:18:06 2015 -0400

    tricky bug!
    
    there is a subtle difference between two LAPIC states: after machine
    power-up/reset and after the LAPIC has been disabled via the spurious interrupt
    vector. after power-up, the mask bits are all set and software can reset them.
    when the LAPIC is disabled via the spurious interrupt vector, the mask bits are
    set but writes to them are ignored!
    
    thus, depending on how the BIOS initializes the APs, you must turn enable the
    LAPIC first, then mask/enable individual vectors.
    
    now the APs don't get trapped in the HLT loop forever.

commit 25bdd7868df2329b31eb057d2c6779c902b1b13f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Mar 14 13:23:26 2015 -0400

    stop being a philistine and separate disk specific code
    
    attach the disks via PCI bus enumeration. my first time using interfaces; how
    magical!

commit 58ec22d9e0570a20b0ef8e3369fe25f67b9d325b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Mar 14 16:26:08 2015 -0400

    restore short code to reduce timer ints for halting cpus

commit 5b3cdb9e54912084087189fa5fc26ba71d5a026a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Mar 14 16:44:59 2015 -0400

    synchronize user console print too

commit 37c6e8592ec119660600039e1b1662ee91c8c487
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 16 13:48:49 2015 -0400

    catch weird error case
    
    if a bad block number is used, it may be trimmed by the cast to int32. catch
    this case explicitly.

commit 3e843a44bd08c980d90eed7e6023d4602f9f472f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 16 13:55:14 2015 -0400

    whoops, read irq from PCI too

commit 5c61be21cb77933017bcb9cb9b21f76142e0c4e9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 16 13:57:50 2015 -0400

    wait for DRQ to be set before sending data
    
    one HD failure and 5 hours later

commit 24e6d973dc265c98e43bc4bd58f80c19fc12b50f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 16 14:02:28 2015 -0400

    Outw, Rflags

commit cc32fca80b4e18eceb05b2468024428b278e6103
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 16 14:10:57 2015 -0400

    set serial console speed
    
    gee i wish i would have put useful comments in this initialization routine

commit 7e612ff4f61aded306b539a1c42237c99e19a6d0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 16 18:34:30 2015 -0400

    cycle counting

commit f05e63dbd6110153c57c3b815123f35d4267e7fd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 16 19:27:29 2015 -0400

    count cycles spent in GC

commit 7c3d9f7e69ed1d1d0549a793742aba4ea1cff293
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 16 19:28:21 2015 -0400

    dump elapsed cycles from proc creation to sys_exit

commit 6adfc7a5c388785ec7aec5b08a99764ba1adc88b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 17 09:08:29 2015 -0400

    only 140 blocks for bmwrite

commit 975a3a33a48dfa85002aee6fe98ebad2cf1c714b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 17 12:33:10 2015 -0400

    block cache capacity = 30, like xv6

commit 131be52ff6244505406fcdb3a7197886d84f7227
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 17 12:36:36 2015 -0400

    keyboard driver
    
    now i can run multiple benchmarks without reimaging/rebooting!

commit da742a91f2fbf730379b889787441bb2fcaf0112
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 17 13:15:23 2015 -0400

    sys_exec,  "shell"

commit 9ffeb4776bdb74bd0c63dfa4ff5ddfeec38a749e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 17 13:30:43 2015 -0400

    make vga easier to read

commit 5f6ba64efc754009eaa17100ce7ca5acdcfc78ee
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 17 13:33:42 2015 -0400

    remove busy waits from fork

commit 41d3d348e25c21a94bb81d194153f7c28db7609d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 17 13:46:57 2015 -0400

    prevent bewildering fork behavior

commit c383c58af8e91f68b9f582057db8349da495d762
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 17 20:28:22 2015 -0400

    easy disabled of serial console
    
    serial console driver is slow since it uses polling. it can impact performance
    measurements by as much as 5x.

commit 11e166f59553f6ad765d960dd584e519418ecba0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 19 09:08:57 2015 -0400

    don't zero data blocks
    
    i think it is safe to not zero indirect blocks too since the file size can be
    used to detect valid entries in the indirect block, but i'm not sure yet.

commit 92500c731b33fc73604687afa543e972e05cdd27
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 19 10:17:46 2015 -0400

    only write inode block if necessary

commit e69a93fcc5e9b2dbc9d7cf595598e9620cdffbfa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 19 10:18:20 2015 -0400

    dont print in bmwrite

commit 55e18ff4259890326f152c4962766b186d531df2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 19 10:34:33 2015 -0400

    put valid block in log header, not in super block
    
    remove 1 extra disk write per log commit: bring disk operations closer to
    xv6's.

commit 374e9f19fcc710a919297d075c0318d9035c8502
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 19 12:04:18 2015 -0400

    make number of APs to use configurable

commit 37c843f61acba2ed6670a6546635f896eb408faa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 19 14:57:50 2015 -0400

    don't start sysmon() goroutine -- biscuit doesn't need it
    
    i noticed that sysmon() gets scheduled very frequently while i was benchmarking
    the cost of channels. sysmon() is called by a background goroutine started by
    the runtime. it does the following:
            - if enabled, dump some scheduling debug info
            - reclaim P's from syscalls entered via cgo or the Syscall package
              (syscalls made by the runtime are not treated specially)
            - reclaim P's from goroutines that have run for more than 10ms
            - poll the network after some timeout
            - forcing a GC after some timeout
            - forcing a "scavenge" (calling madvise(DONT_NEED) on all pages not
              recently used) of the heap after some timeout
    
    we probably don't care about any of this but the GC, which biscuit can do
    better since it knows when to do it. thus, remove sysmon from biscuit.
    
    alternatively, i could fix biscuit's concept of time so that sysmon() sleeps
    for the correct amount of time.

commit 7c97126c6c067e81fae2ce6a64be218506acb01f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 19 22:13:59 2015 -0400

    channel benchmarking code
    
    for implementing a critical section, channels are about 30% more expensive in
    wall-clock time than mutexs.

commit 9f5d74ba51e450ba0fe0c643dee2a36e1ad0bf24
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 19 22:17:53 2015 -0400

    checkpoint code for event-driven CPU exception handling instead of polling
    
    insert 4 instructions into the go function call prologue to check for
    interrupts and call the interrupt handler if necessary. be careful not to
    clobber the context or TLS registers.
    
    i just realized this approach has a big problem though: what if there are no
    runnable go routines? thus we really need to start/wakeup a goroutine if there
    aren't any runnable goroutines.
    
    starting a goroutine from interrupt context is difficult though (i tried it
    earlier today) since we need to manipulate run queues in interrupt context --
    obviously interrupt code cannot attempt to acquire the mutex protecting the run
    queues.
    
    need to figure something out.

commit 5ccc61ae8b99f8f7cd34ec1d9a9a091977b20680
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 20 09:29:34 2015 -0400

    don't count sysmon in checkdead() in biscuit

commit edb9ffdfac676999735d953a1eda047fc443a248
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 20 18:48:17 2015 -0400

    check that a file is an ELF before trying to exec it
    
    so we don't panic when i accidently type "/bin"

commit ab6e4e6208b9f9df9760b11556f294d6f6a083a3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 20 14:37:07 2015 -0400

    wakeup a goroutine for CPU interrupts/no polling
    
    biscuit starts a special trap consuming goroutine, as before, but now instead
    of the Gosched/Usleep nonsense, it calls Trapsched which puts the goroutine to
    sleep if there are no more interrupts to process. when an interrupt comes in,
    the handler sets a flag which is checked by all Ps when looking for goroutines
    to run. they race for ownership of the trap consuming goroutine and the winner
    puts it on his run queue.
    
    another notable change: when an M can't find a goroutine to run, it yields
    instead of stopping itself.
    
    the difference is immediately noticable -- the test hardware with 1 or 8 CPUs
    is much more responsive. unfortunately, it doesn't improve our numbers in the
    bmwrite benchmark! interesting.
    
    the sleep/wakeup code is a little complicated; i hope to simplify it.
    
    comment out my addition to the compiler that generates the check in the
    function prologue since we don't need it. it may be useful later.

commit 223ab008de4a716bf0af4c4d1c84967883c8dff5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 22 09:25:14 2015 -0400

    x

commit 67c1eaf373a36c7ba76bdde044a6ce10383f9533
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 22 11:09:55 2015 -0400

    err(), fix printfs

commit 9f733b7c2c54b26d7897d94e4d48bb48275ceb45
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 22 11:27:04 2015 -0400

    bmopen, cls

commit f85cbf7f8b3c396e61347d7a10ac46d015a87d03
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 22 12:13:17 2015 -0400

    cleanup some vm stuff, prep for exec args

commit e6f197ebe538e85d788d4fcaf66edac2f3d553df
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 22 15:27:01 2015 -0400

    kernel support for exec args

commit 5e5c77b3f71b6a501b1c83a46bb515c67c74762c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 22 15:27:54 2015 -0400

    user space support for execv args, shell tokenizing, echo
    
    now i can run my benchmarks with different parameters without
    rebooting/reimaging. how magical!

commit 765ea2966720e6036df6a60e151b230048b00951
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 22 15:37:28 2015 -0400

    atoi() so i can actually use fancy new argv

commit 2203f6cb90bfb9a6a11f4aed59712a849a2b628c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 23 08:58:32 2015 -0400

    cat

commit 11d9aaff6ffbc92d9b8d0e32e946978c0e4bb185
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 23 09:43:53 2015 -0400

    indirect block support for directories

commit 0915ce41d136384a3c42f921e2b210f8f61d355b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 23 09:44:48 2015 -0400

    make sure buffer cache contains no more than capacity

commit 170ac7623e3576953ddd2499ef232276d2c26fc6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 23 10:13:03 2015 -0400

    sys_pause, useful for GC bm

commit 646c66f030c6cd7b6435f4789e4cb022d46fac4b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 23 10:44:28 2015 -0400

    fix execv type

commit 00aece04de074add3e8e9f4d7d54eadd3fe7ab19
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 23 10:57:21 2015 -0400

    fix process names

commit f926f3e8f2fb8c72090cb47780bb78ac16e2267d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 23 11:15:24 2015 -0400

    Gcticks()

commit 6166728b56b7472c655a0bfbfb38e98b6ad21c9d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 23 11:16:29 2015 -0400

    remember lowest closed fd instead of scanning from 0 every sys_open

commit 57f3e7654b2cc9f50741e97c382984e847cb21b4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 23 11:18:34 2015 -0400

    bmgc

commit 665a3668c3f54f0b1332c881500445e7f18e60fd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 23 14:09:20 2015 -0400

    bug

commit 83b1288303604ab250e21249028d3fdea8951ef2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 23 14:40:34 2015 -0400

    in copy_pmap(), don't deep copy the recursive mapping
    
    was very confused why the page map of user processes was twice as large as the
    kernel's!

commit 99dcb1314a9340fcc8ddd7151dd4eb917000e63f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 23 15:47:34 2015 -0400

    fix bmopen

commit 4304e957988a213f3eed156da74543eff5d74750
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 23 15:50:48 2015 -0400

    make getpid reset GC tick count

commit 49ec2261bfe0f0604fa6f5d8dae027d6c65062c8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 23 16:22:00 2015 -0400

    read-only bmopen

commit e303f32893a1a2380ff680a696648b137890860b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 31 13:46:20 2015 -0400

    remove printfs from bmopen

commit 9781f415bbf22c7bb1c96470d5fb6acc0ff5000e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 31 15:17:14 2015 -0400

    dump overflowing trap numbers

commit 9c2b4bf73549dcefa9261c65d41fb415d30b84e6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 31 15:18:46 2015 -0400

    prepare for smallfile

commit 3bdadb4d454801d2a99dcb891a9532553a2d92c5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 31 15:30:17 2015 -0400

    bmsmallfile

commit f9054caf1d1d7671995d1123f85a6455698532de
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 2 10:02:10 2015 -0400

    x

commit e580320b3c1e6906b87f27c041bf755e0e41e8ae
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 3 11:23:39 2015 -0400

    small readme

commit 2fa9f2f2df32a4ab5d916d869ff2f5a22a9f1373
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 6 14:01:18 2015 -0400

    chanbm with batching

commit e645f7c48d9dbd099debd124765028c9a5df5e8d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 6 17:20:34 2015 -0400

    x

commit 30e2cea827e7295cd69e6ba12dd6cb95538ca2a1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 7 11:47:06 2015 -0400

    bugfix: mark all user pmap pages as writable
    
    the PTE permissions determine the memory's writability.
    
    necessary for "speculative" fork!

commit d5600b6e4f75d73444053ba79074aed81105d9bf
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 8 11:29:39 2015 -0400

    print carriage return before newline for serial console
    
    so it doesn't look terrible on my serial terminal emulator

commit fe808b1dbe41439131a28b6fac1b54a245959c5d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 8 12:09:41 2015 -0400

    filter out bad keys from keyboard map

commit 52ad8578842c29124587128da43fda3ba0fc3345
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 8 14:43:15 2015 -0400

    when runtime can't find runnable go routines, yield instead of usleep
    
    the runtime kernel thread should remain runnable instead of waiting for CPU 0
    to wake it up (even though its timeout was 0).

commit dd910e91a16b6aa7073e96d6d5b4c4ef83084b52
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 8 14:46:38 2015 -0400

    cpu_wakeup() -- send timer IPI
    
    not currently used -- useful for testing

commit a3de1d47eb496fd17bea18f77a5724cd815a1554
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 13 15:21:42 2015 -0400

    pmap_iter

commit 8bf47ba337a24669760b424ef61f987a2820967b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 13 16:00:28 2015 -0400

    atoul, user rdtsc

commit 5a08cb2b364a0f7e5ddfb7707522df185a682e0d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 13 17:18:24 2015 -0400

    fix printf for big numbers

commit d61852c4b898788d56844dd22677e84a57441ce6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 13 18:46:37 2015 -0400

    handle divide by zero exceptions

commit 8f677aadc3c14bd9bde1503e76c75a0c5e158195
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 13 18:51:51 2015 -0400

    fake syscall for GC benchmarking

commit 43476e6a69ebb5b5a22bb55f86a2e2020ff822e6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 13 18:54:23 2015 -0400

    bmgc2

commit bebfd2409afb3336cc65eaf4cdf757fe498c9d07
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 16 12:31:48 2015 -0400

    specify args for first process

commit d65502520c61036f2f609e29d80e46696d1912d0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 16 12:34:28 2015 -0400

    setup recursive mapping correctly for user pmaps
    
    however, the recursive mapping is currenly unused for user pmaps

commit 17877e16cd96886aef649d7a838c0300814cc96a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 16 12:38:36 2015 -0400

    cleanup

commit a57852a3185634c55366167362477090fd0fd9b3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 16 12:38:55 2015 -0400

    correctly setup direct mapping when 1GB pages are not available
    
    a result of this bug was that using the direct mapping to access physical
    addresses higher than 1GB incorrectly mapped them back to 0. thus random
    looking memory corruption occured once the runtime mmap'ed a lot of memory (as
    in my new GC benchmark).
    
    this one only took 2 days.

commit 51dae663edbbca025fe10516649af17bc66ec8b8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 16 13:16:33 2015 -0400

    yet another printf bugfix; print 0 instead of nothing

commit 587274a4e6c357a9b3cd60f9b2501c0d6f99d6a9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 21 08:53:12 2015 -0400

    x

commit cefd263eea498878361f8f4b63a5e72ff4d96bf9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 21 12:10:49 2015 -0400

    sys_wait
    
    however, i don't understand the necessity to keep exit statuses for process
    whose parent has already exited, which results in the invariant that someone
    always calls wait().

commit edbdf065a30e1792df61d5a222a1e7252ea58028
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 22 14:47:34 2015 -0400

    benchmark how long it takes an idle CPU to find/execute a new goroutine
    
    with 1 idle CPU (looping in findrunnable() in the runtime) it takes about 7800
    cycles. with 7 idle CPUs, it takes 6900 cycles.

commit 23d1ebe901a64b4e2a6970f93fc7326fc7ee6d08
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 23 14:13:57 2015 -0400

    free old page when inserting a new page

commit 07b4070ac1b679af375309608dae9c7423df816d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 24 09:28:12 2015 -0400

    sfork benchmark

commit 4031dfc04fa705d313b986533687fd79f3292d2d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 28 13:34:54 2015 -0400

    address space bloater

commit 4360248eae1ffbbaa52d282519cecd9a97baa099
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 28 13:37:44 2015 -0400

    parallel page map copying
    
    for very large address spaces, the copying (by iteration) of the per-process
    upages map takes much longer than the parallel copy. thus upages should become
    a cache (where a miss puts an entry in upages by doing a page map walk).

commit 8d04de575d8629f82cc515f7166355e99c097954
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 28 14:17:13 2015 -0400

    user progs: mkdir, touch, unlink
    
    prepare for chdir to get usertests running

commit bd603f71be491ee5a22a81baa24b1ebf8706c753
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 28 14:39:02 2015 -0400

    path support to lsh
    
    getting fancy!

commit f48b075a57db04c9d9877cfe050debb49f2fc918
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 28 14:58:07 2015 -0400

    x

commit 880a66318a87b64f83da61541af6657441780b17
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 28 18:03:08 2015 -0400

    notify parent if user prog dies from an unexpected page fault

commit 6dccd4cde104ede09e160efa06035aec5262119b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 28 19:36:36 2015 -0400

    sys_chdir, cwd support
    
    and cleanup fs interface

commit 7b2ebea8db07596a771f473f0aef88abb2b17d13
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 28 19:38:00 2015 -0400

    add "cd" to lsh, strncmp to litc

commit 15c67ff50803709274b41574df748d5bfbd94615
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 29 10:38:09 2015 -0400

    ../ and ./ support to biscuit and disk maker script
    
    also, don't recursively list ../ or ./ in ls

commit a0336eb3489045a6c86cc46592bb681d2a937cab
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 29 12:12:05 2015 -0400

    prevent attempts to unlink . or ..
    
    ls list from cwd

commit b68e0236b68b9de70f339a6f0d4d303aa0f093f4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 29 16:50:57 2015 -0400

    fd permissions

commit a79053888f3e8c044e79a844558ea72fef5221d6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 30 13:24:20 2015 -0400

    pipe support
    
    also cleanup fs interface more, fd indirection, close all open fds on exit, and
    share fds on fork

commit d251c98e29741d63eed42122ae68f7521328c467
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri May 1 00:26:58 2015 -0400

    drain all per-cpu ints at once, not round roubin

commit 76a288d752cd38fecdb0f2a739d337695e75001f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri May 1 00:39:38 2015 -0400

    sys_kill
    
    need to cooperate with the runtime since go code is completely unaware of timer
    interrupts but a timer interrupt may be the only way that a user program stops
    executing.

commit e030a033cd5a7dc0d69524638e29c9836fb46041
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri May 1 09:32:44 2015 -0400

    x

commit 0f419741ca3a979e51365ad1c27922d391563196
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 4 10:34:23 2015 -0400

    sys_mmap, sys_munmap
    
    mmap doesn't support all flags yet

commit 7798657d2d93411830b33bf077da230bbd56931e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 4 11:42:01 2015 -0400

    crappy malloc/free
    
    doesn't reuse free'd memory. i'm curious how much memory it wastes compared to
    a real malloc.

commit 79fe6a2aab12e92cc2a5e658bdd7880f795e37bd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 4 14:42:35 2015 -0400

    cleanup exec
    
    fix clunky interface instead of working around it

commit 17754e184015f0b1ae3471a0238e35d19714131c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 4 15:44:38 2015 -0400

    don't use strlen to print buffers created by printf &c
    
    otherwise using "%c" to accidentally null terminate strings produces
    bewildering results.

commit a08bcd09a273c683443f4a294ad357c921795d9e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 4 17:20:28 2015 -0400

    lock reads/writes that conflict on a shared fd

commit 17fd1cf934bc4439b674fc34a0befe79994441e2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 4 22:06:24 2015 -0400

    ulimit for memory, fix open
    
    open with O_CREAT should fail if the file already exists only if O_EXCL is also
    given.

commit 2b651553ba79ab35d52830f1494d16bca1382272
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 5 00:03:03 2015 -0400

    make pipe closer to posix and fix bug
    
    posix spec seems to forbid short writes to pipes. also, only lock fds that
    actually have metadata to protect (INODEs).

commit 10b5bcb2eb6449d6a4cece6c0db85ab3d1d9961c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 5 00:05:00 2015 -0400

    warn when malloc() cannot mmap more memory

commit 2740f1b9cc71af542bb9b5be433a1c4d9f5ca887
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 5 11:34:02 2015 -0400

    create '../' in  root dir too
    
    didn't want it initially, but i've had a change of heart

commit 65080fb3ea94c1fe8e439f621ff9533f26d79b7a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 5 13:23:45 2015 -0400

    file creation -- fail instead of silently truncating file names
    
    in sys_{open,mkdir}, fail if a filename requires more bytes than there are in a
    directory entry.

commit 45ffaa2c5bf1945369cf33e0e037cdd2a661533b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 5 14:04:53 2015 -0400

    report error instead of panicking if someone thinks a file is a dir
    
    like usertests does

commit 934bdcd662b79d87bd39157ec6c16987433ea178
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 5 14:15:11 2015 -0400

    xv6 usertests
    
    there are a couple notable modifications:
            - sbrk test is removed; biscuit uses mmap instead and it seems silly to
              write a compatibility interface for sbrk.
    
            - fourteen test does not verify that path names are truncated (biscuit
              raises an error if pathnames are longer that what is representable)
    
    usertests pass on both qemu and the hardware

commit 5f4509ee8414bca9fda73e1de5ca7c1fc0c8b6bd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 5 17:39:03 2015 -0400

    x

commit 281f336902e98c6184513610bcb85cc6ca2ea65a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 5 18:14:44 2015 -0400

    don't copy kernel pmap pages, but reference them
    
    significant speed improvement in fork/exec since the direct mapping is so huge.

commit 88a32311d73864c5b3a8fb1e5b49f85a0c1ca1c0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 5 18:21:51 2015 -0400

    x

commit 984c38aad2ef5ab5d247cd5940715602e67f4ce8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 6 09:29:43 2015 -0400

    use pragma once instead

commit f6748d76c7c13168d43df3d5e645695480eb84d6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 6 12:08:33 2015 -0400

    keep files in memory after unlinked on disk
    
    this change was more intrusive than i expected. because open fails under
    various circumstances (ie O_CREAT on a directory), the checking code must
    decrement the in memory file's reference count in the presence of a failure.
    however, the checking code was not part of the lookup/open transaction, so such
    a scheme would not be correct. thus the checking code was moved into the inode
    daemon so the check/ref decrement are atomic with the lookup/open.
    
    also prevent opening directories as writable, chdiring to files, and add
    O_DIRECTORY flag.

commit ff7e5e183f14b69fec6c9a9917f75aa57fc05b07
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 6 16:46:05 2015 -0400

    close files, decrement memory ref count
    
    thus open files are usable after they are unlinked from the file system and
    will be freed on close.
    
    the code does not deal with the case where the machine crashes in between an
    open file being unlinked and the file's close(). i plan on logging such files
    in the journal and removing the journal entry once the file has been freed
    after close().

commit 958415720792e1f9172d031bdb54ee33dd5a3056
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 6 17:15:15 2015 -0400

    duuurp

commit 075f035ec0eb7f4cbb44a95139b5605b958f4c8a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 7 10:49:18 2015 -0400

    whoops; only close old cwd if chdir succeeds

commit be2da6e95ecfdaafe567729079c4e98c52d2a558
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 7 10:54:38 2015 -0400

    indirect block support for directories
    
    thus indirect block support is complete. indirect block support is necessary
    for the bigdir() test in usertests.

commit 9fec6eac509ac933748a9ce40cbc241dac1ac0e1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 7 10:55:32 2015 -0400

    final usertests fixes
    
    usertests expects fork to fail to fork 1000 times but biscuit succeeds (thanks
    to copy on write), so finish the fork test anyway.
    
    biscuit does not have an answer to the system running out of memory yet -- i'm
    thinking about it.
    
    usertests actually works now. now onto threading so we can run mailbench!

commit 5cd667c2b4b0f3675355ab9b9b4b653fc47c8229
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 7 17:18:07 2015 -0400

    wait -> wait4
    
    because mailbench needs waitpid and i will use wait4 to implement pthread_join

commit d1dbf22ace44180c8dab0f569c8d33a04029aebc
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu May 7 22:23:22 2015 -0400

    x

commit 288caddf00b685f06959f099efd106c0ffe698bc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri May 8 08:32:16 2015 -0400

    remove usepid

commit 0c9544f66afccab98449e99e9ed95f247407ed9d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri May 8 09:44:44 2015 -0400

    start threads
    
    let a process have more than one schedule entry and cleanup notification
    mechanism since terminating a process is more annoying now. also try coding
    style that makes frequent use of types to help differentiate identifiers.

commit 9f90a6e2339fac4d9d7f411c70f821e16882beaa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri May 8 09:51:08 2015 -0400

    prevent panic on 'mkdir /'

commit 26f446ed356b2e9e3112d44feb7a1a010cc21d0e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri May 8 10:38:15 2015 -0400

    termination protocol for threads
    
    it is no longer safe to immediately cleanup a process in sys_exit() or during
    any faults. use the notification mechanism that kill needs (to terminate a
    possibly running process) to cleanup once all threads have stopped running.

commit c61afa0dd00590d52fac36e98018143d00ddc7b5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri May 8 11:04:46 2015 -0400

    sys_threxit and prepare for syscalls from threads

commit bf003e1b260242fcea38838bc8abb76935d4d764
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri May 8 15:01:31 2015 -0400

    lock malloc(), free(), and printf()
    
    was confused why threads looked broken for a moment

commit 3f254bfa37d2db7fc7ec2886e0f475e8f7332587
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri May 8 15:11:22 2015 -0400

    threads!
    
    pretty cool. no pthreads interface yet.

commit c94cabea0e3f07107394ad1fc45e3a9653d91411
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri May 8 18:09:34 2015 -0400

    x

commit 8459658947a6f7d62abe2a0a876299b70e4b3c2e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 11 11:23:47 2015 -0400

    lock free printf(); use local buffer

commit ba3949108bd0a4e5b03d17c992bcb40057b645d0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 11 11:24:40 2015 -0400

    TLS

commit c22b59be80a5d33435db74dd716ac96421180be1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 11 12:06:14 2015 -0400

    serialize page faults within a process
    
    need TLB shootdowns for page faults/m{,un}map

commit 6aa9c3ecc22ddfe998d0b0c7943b6d63788325c6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 11 16:47:45 2015 -0400

    thrwait(), globally unique tid/pids

commit 32b4071ddc8a426bf714f3cb8265803f97bdb346
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 11 23:03:51 2015 -0400

    exit with value returned from called function

commit 1f1e7548ccd4387f9b52d515eb4abad86a20d51a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 11 23:42:23 2015 -0400

    start pthreads

commit caff467186c380f3bbac0ef77a9cd61c1c8ab900
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 13 09:02:16 2015 -0400

    x

commit 8b2c06d87337316fdec09f4d04dd1cae6cfdbcda
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 13 09:33:52 2015 -0400

    prepare to support building C++11 programs in build system

commit 95594c880ea8e07209e95fcf906581306315e0eb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 13 11:22:29 2015 -0400

    compile C++ programs so they can run on biscuit
    
    will try to build mailbench now. definitely need to add some things before it
    will compile (posix_spawn*, sys_dup, etc.)

commit b4b83a6a18fb32dfff223ab53f8209e45e9cc0ec
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 13 11:49:40 2015 -0400

    pathsubst -> addprefix/addsuffix when possible

commit 45d0763d292bede53a4355d8648b90e41edca0f5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 13 12:28:14 2015 -0400

    tell GCC to typecheck format strings
    
    was wondering how to do that when using --fno-builtin.

commit d65c07f1b3322807613d29a16f7ad389623d5cdf
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 13 14:04:40 2015 -0400

    explicitly use python2 for scripts, don't make bad prereq

commit acc9511284a94610a48c2730aec24f4c43a5c075
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 13 14:28:09 2015 -0400

    fix keyboard bug
    
    been meaning too for weeks!

commit f20916c19b6dcbcba58ae9135f027f3279baee25
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 13 16:52:33 2015 -0400

    prevent keyboard buffer from growing infinitely

commit 864f37688f95337cd9d7424cd493cabe56af1329
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 13 19:50:43 2015 -0400

    input support for serial console driver
    
    now i can easily run biscuit remotely via qemu -- i no longer need X11
    forwarding/qemu's vga screen! this will be useful while i'm in utah...

commit cb92c1b44d43fb4abfa29c6ac79d6e7c8c30beb5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 14 10:38:30 2015 -0400

    prep for gettimeofday

commit 42eb20c59b09815c3fcdca677935c16add051e65
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 14 10:41:11 2015 -0400

    fprintf, gettimeofday dummy

commit 7ce8d087e789f8d0285e40821eb601fd4ef12c90
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 14 11:04:36 2015 -0400

    fix C++ warnings, dummy lseek, and cleanup

commit b1eba9c32a54031a213b948c2453b985fff14f33
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 14 11:16:02 2015 -0400

    readline fixes

commit 59b88944da44917995298744e3b8e325643525a6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 14 12:01:06 2015 -0400

    split _entry from litc
    
    so C++ programs can link against litc.o without a definition for unmangled
    main().

commit f9e2fa74f4e7180bba820d0e44bc62f88d82fd8d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 14 13:06:59 2015 -0400

    Revert "split _entry from litc"
    
    whoops! i misunderstood the error; main in C++ is not mangled...
    
    This reverts commit 59b88944da44917995298744e3b8e325643525a6.

commit d0463bf423daf70474f56850c45b21486cceb58c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 14 14:55:49 2015 -0400

    austin's minimal libc++ and mailbench
    
    do not attempt to build mailbench yet, since i need to add unix sockets and
    other things

commit e25161b53165fe2209359e37c0fdcfc7994f5a34
Merge: d0463bf423 ec50cd95ca
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 14 14:59:45 2015 -0400

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit 6e47ca24e9f1fe90f210458da7bcef25719b638b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 14 15:24:56 2015 -0400

    fs bug -- inc ref count of shared cwd on fork

commit 8a19b52dc6f354c85b651842260a6fb105f43d4d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat May 16 16:58:36 2015 -0400

    compile mail-enqueue
    
    a few more C++ runtime things (exceptions) and the final stubs

commit 789402d59724956296ad5acc7a38d9eafc9001d4
Merge: 8a19b52dc6 80fa2b7930
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat May 16 17:00:04 2015 -0400

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit 1271cf5026388e08f8188026baece82d35401772
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 18 12:11:15 2015 -0400

    lsh -- gobble whitespace in args

commit 96f16b92e45ea592a42de4519805808c0f50c92a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 18 12:16:51 2015 -0400

    getopt and strchr

commit f06846b56b8a03320731338f5414d85016e6c0c2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 18 15:11:16 2015 -0400

    files have types, not fds

commit 31dc8cff8848a4b8942d484ca9d2c3a4ae49d778
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 18 15:14:41 2015 -0400

    x

commit 2d44c308d43953acb03a38cfa3e15612e6238598
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 18 18:24:51 2015 -0400

    mknod stubs, mknodtest

commit 759847fd92592bb41de218c5e517758cbbd4cba3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 18 18:30:12 2015 -0400

    skip empty lines in lsh

commit 64cf207a4a7c9f8fd6f0b57f80eb31f3d366a94a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 18 18:25:33 2015 -0400

    sys_mknod, device node support
    
    its annoying that device node major/minor needs to be saved in the fs.

commit 3efe8fc93afcfd4afc527abdd19244bab2c74c1a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 18 19:00:21 2015 -0400

    dev node indirection

commit 5a9855b4d7d972860a0bf1cbc18b665bb4860cf4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Jun 14 11:27:39 2015 -0400

    cleanup mknod, which will be used for UNIX sockets
    
    hooray! more biscuit hacking

commit 09a37d90d1b7bb59af353119e39dc560233a00ba
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jun 16 20:33:41 2015 -0400

    UNIX sockets, sys_bind, sys_recvfrom, sys_sendto, and sys_socket
    
    only support SOCK_DGRAM and getting sender address with recvfrom is not
    implemented yet

commit 57bf33a9fea051a7f586f4cc2a6cd27da81a157b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jun 17 10:42:54 2015 -0400

    x

commit 1f9f04a0fedc5a958863287cf35868289e9ee6fd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jun 17 11:28:09 2015 -0400

    sys_stat, make ls use stat instead of fstat

commit fa44e19a113e58f3c30f46f130ee5bd8249c8d84
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jun 17 11:31:12 2015 -0400

    sockettest.c

commit a90b20a37c678b90edbdd10edd4c777194732400
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jun 17 12:18:08 2015 -0400

    recv = wrapper around recvfrom

commit aa1c3309004d6f290e03f4a43955adedfdaf29aa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jun 17 12:44:42 2015 -0400

    O_CLOEXEC

commit 8820d7ec2f9f8c9c80eb3c75c20472a3df5fbbc8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jun 17 13:27:23 2015 -0400

    do silly open mode arg thing

commit 964c4f4743ba2deed1ef3804750dd0485b698e67
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jun 17 14:56:10 2015 -0400

    sys_pipe -> sys_pipe2

commit bb7927b1b520bd240d740e361e91474f9b4bcd86
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jun 18 12:57:37 2015 -0400

    sys_dup2

commit e1de38dd2625aeebec515d2ad66662394f1ebd6b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jun 18 14:17:33 2015 -0400

    waitpid, exit status macros

commit 5877a40f1e9b8a9d51a737e2a3c402aaf325fa94
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jun 18 19:22:32 2015 -0400

    pthread fixes, memcmp
    
    a process exit value is a byte, but a pthread exit value is 8 bytes so although
    i use wait4 for both processes and threads, we must distinguish the two use
    cases.
    
    furthermore, make terminating pthreads munmap their own stacks before
    termination.

commit 11d7fabb28c74e60f89645b87f6aea34c5adfbf5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jun 18 19:46:17 2015 -0400

    pthread_self
    
    also changed pthread_t from a struct to a tid. hopefully all pthread functions
    don't require any more info other than the tid to implement, otherwise i'll
    need to change pthread_t back into a struct.

commit 9c1badca550d973e9348604e6355d7bdadb26ed0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jun 18 20:07:19 2015 -0400

    compile mail-qman too
    
    now we can do some realistic-ish benchmarking!

commit 7ff90654efc162043033513949eda3ba746fa832
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jun 18 21:55:20 2015 -0400

    %p to printf

commit 7db28c40291ac10be9b22a53c6bda8a2c6cf3d3d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jun 19 12:34:15 2015 -0400

    x

commit 7b7661caeb5b067e05a4160d09e8b72bb3f35fbf
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jun 19 12:43:01 2015 -0400

    memmove

commit 713fd0b7c36039ba3873e3130b90234ff5906372
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jun 19 14:16:09 2015 -0400

    readline() report EOF by returning NULL

commit 67d4b33950a49ca7f999117e1a73a1cb23f7e152
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jun 19 14:17:02 2015 -0400

    shell std{in,out} redirecting
    
    it's easier to use mailbench with redirects

commit c0d4b11e195e4d2c6e2d946514bc3612e26a530f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jun 19 14:17:57 2015 -0400

    give processes 2 pages for stack instead of 1
    
    mailbench needs a lot of stack

commit 752a73404b1f34ae76adeabc873b0896ef9bef90
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jun 19 15:24:01 2015 -0400

    O_TRUNC

commit a12ddb62e5028fe0d90e5cfbb69331bf5b534e9d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jun 19 17:04:26 2015 -0400

    x

commit 1a0b0dc95c24ea3bc4568b685d91ab485375d269
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jun 23 10:35:04 2015 -0400

    pci_write
    
    untested

commit 3b7cb82d95eb29ffaf3c367835b7218a22f65a71
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jun 23 11:33:50 2015 -0400

    compile mail-deliver.cc

commit 3e986f23de0827591e9110067ed624f4677be3ca
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jun 23 12:46:04 2015 -0400

    rename stub

commit 0fc7cff8980b56e994db6c1db5f7b5e3d3ac115c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jun 23 22:39:56 2015 -0400

    x

commit b19fdbae7b5ef8aaa1d175d48e313ffaeadc1deb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jun 24 12:20:11 2015 -0400

    filesystem inode transactions
    
    also convert ulink(2) to use transactions. one great benefit of using
    transactions is that the inode daemon code is greatly simplified. i still need
    to convert open(2)'s operations to use transactions, then i will use them to
    easily implement rename.
    
    god i hate rename(2).

commit babe96c83c7449a9bc40aad5e1acd78a9d44351b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jun 24 15:39:33 2015 -0400

    convert open and mkdir to fs transactions
    
    i like this code a lot more. now rename!

commit 11d4cbc6e9083fbc30b7c98d00dd6441e0fe6308
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jun 25 15:19:56 2015 -0400

    rename(2), rename test, and mv
    
    had to extend inode transactions to lock a file iff it exists (newfile for
    rename).

commit 0375e313b1bf204b0e6166ccdfd5d07426d532d2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jun 25 16:01:04 2015 -0400

    make qman exec paths absolute

commit ba8117e4c77f491029f6f38a4be17c815d895aef
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jun 25 16:34:42 2015 -0400

    whoops; actually clear O_CLOEXEC in dup2
    
    mailbench works! cool!

commit b7119bbe4d90d0857f4e9122daca0129fd521d1b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jun 25 16:55:17 2015 -0400

    x

commit 60fbac45015f429aced6ee450d8d7288e67f6b67
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jun 25 21:48:31 2015 -0400

    fix transaction locking bugs, make rename test a little trickier
    
    make containing directory newer than the files to be moved so they are locked
    in reverse order.

commit 47a9cd3d8e3a11f0a029df560d203817e692cf01
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jun 26 16:39:09 2015 -0400

    finish DGRAM UNIX sockets
    
    make messages atomic, fill in from address in recvfrom(2), increase socket ref
    count on fork.
    
    i think mailbench is bugfree now!

commit a0af85da51a3c219e8eb564dd93dec02ed241472
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jun 30 13:53:35 2015 -0400

    user stubs for {,nano}sleep and sleep(1)

commit 9a439e3de0aa2bf3202e7eb8e19a63356ece1e0b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jun 30 13:56:14 2015 -0400

    figure out LAPIC clock speed using 8254 PIT
    
    we need a sense of time because i want timeouts to be specified in seconds,
    milliseconds, etc. instead of cycles. since the 8254 has a well known frequency
    we can use it to determine the LAPIC's frequency (which is different from the
    CPU's frequency), which we can then use to keep track of nanoseconds per timer
    interrupt.
    
    qemu's lapic clock is 1Ghz while the test hardware's is 132Mhz.
    
    time package is still broken -- this is the first step to fixing it.

commit 069222d403218b151bde2cf8faf1570d69a91997
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jun 30 23:06:20 2015 -0400

    separate code for timer interrupts and yielding
    
    since i now use the timer interrupt to keep track of wall clock time, we need
    to differentiate yields from clock ticks since only clock ticks should
    increment the uptime counter. the runtime yields a lot due to futexs.
    
    it is important that the yield interrupt use an IST since it is called from go
    routines.
    
    however, i do not yet initialize the uptime ticks -- i start at 0. thus the
    runtime thinks it is dec 31st, 1969. i don't care about this yet.

commit df06ca5319151699fcac1fb909407ac7ee125995
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jun 30 23:14:42 2015 -0400

    sys_nanosleep
    
    package time works now and is useful for this syscall. despite the vastly
    different lapic clock speeds of qemu and the test hardware, timeouts in seconds
    seem accurate.

commit 1c122b90d5969b494fd8a15b50873be37a8e3027
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jul 1 14:01:21 2015 -0400

    reminders for me

commit faf2a8650b4026c2c5e7ce2dcb4bcd1233b8fc47
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jul 1 15:21:13 2015 -0400

    lsh -- exit on EOF

commit 4a73d71e15499d9bb40d204a71b07342022a7018
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jul 1 16:02:18 2015 -0400

    posix_spawn and file actions init, destroy, and adddup2
    
    posix test in usertests too

commit ef44c553a67d1e010738c51a8ee5dbd49e5f8d1a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jul 1 16:06:40 2015 -0400

    build mailbench
    
    mailbench is a nice program that sets up and drives the actual mail benchmark.
    
    it requires support for TLS ELF sections for its "concurrent_distribution"
    class. we probably don't need concurrent_distribution, but i will write TLS
    support anyway because it is cool and should be easy to add.

commit 8a4ce3c5e015f9722a6ab9efdce2a2cfa1fad861
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 2 12:18:33 2015 -0400

    mmap_findaddr -> proc.unusedva

commit 59d6104e44837b40c7bad0fbf80f88feb3c08d54
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 2 15:03:21 2015 -0400

    kernel support for ELF PT_TLS
    
    also, renamed proc_t.userdmap to userdmap8 for symmetry with dmap/dmap8.

commit b309712aa0c4041656437a382fc8ac744e0ba372
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 2 16:27:36 2015 -0400

    finish PT_TLS, user space support
    
    and accompanying pthreads test. pretty cool!

commit 18ff9f35344cdc0dd9739ffb764a75bbb1c809fc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 2 16:37:37 2015 -0400

    more fun pthreads test for real hardware

commit 9e3ca8cc3ae67762d2e253c71208c81878fc6a1b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 2 20:37:29 2015 -0400

    sys_lseek
    
    not as simple as i expected since we need handle gaps in file writes (i.e.
    lseek'ing past the end of the file and then writing) -- unwritten blocks need
    to be zero.

commit b504aec22e58e552552b9591601c1e167ba10b5a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 2 21:04:22 2015 -0400

    silly hack for time.Now()
    
    the runtime will try to open /etc/localtime if you try to print the result or
    use any of its helper methods. specifically fail open("/etc/localtime"), but
    make sure any other opens panic.

commit 023dafbbaa2b0eb0de389b15d5a50eb1ce6e93c0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 2 21:30:33 2015 -0400

    sys_gettimeofday

commit 383c66f6d5c8dd0a1d9f289f8c6f01d3b1ecb050
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 2 21:42:38 2015 -0400

    hurray! mailbench finally works
    
    with 1 thread, qemu gets a whopping 7 emails a second!

commit f8feaa5ff3e2b7a1ac559f2b4f7fa2fa1a232657
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 2 21:49:49 2015 -0400

    another reminder to myself

commit 223921d97e2d0e15711276668ab3831e7c4d949e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 2 22:31:07 2015 -0400

    execvp

commit d082df649f63cf413b92d1b1c419c030cc9fc769
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 2 22:33:47 2015 -0400

    time(1)

commit 52298fd806ee050c089368b5706be1f0ae56b76a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jul 3 11:43:19 2015 -0400

    silence linker warnings
    
    due to asking for build-id and then throwing it away

commit a6ab783673a179ce0dc946efff4d0f8b3ccdc738
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jul 3 11:44:51 2015 -0400

    for c++11, throw bad_alloc when malloc fails

commit 43002e2265c5a79076ec571738aaea9d38bb2066
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jul 3 13:24:07 2015 -0400

    do stat correctly, don't allow O_CREAT on sockets

commit 2add19e35561b39eba566a09228c48f0900a7141
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jul 6 10:52:45 2015 -0400

    handle simultaneous page faults to the same page
    
    multithreaded mailbench requires me to finally implement thread-safe virtual
    memory.

commit e47dbb538d8f8221c32ef4d64faa505cc73663b0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jul 6 12:43:22 2015 -0400

    x

commit a1db7c77c8e7b736a5a669622838a3e1c76e87a4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jul 6 13:26:15 2015 -0400

    move proc_t lock to threadinfo_t lock

commit 00a15d92e4a2f388ac86da5cce2663fc32e43483
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jul 6 14:54:39 2015 -0400

    bite the bullet: lock access to process page map in syscalls
    
    sadly, there are two versions of some proc_t.user* functions now, one that
    takes the map lock and that doesn't. i don't think two such versions can be
    avoided.
    
    Now for the last part: TLB shootdowns!

commit ff21e8e51d1e67fbce115ae78bf1e8d9be54c685
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jul 7 09:24:07 2015 -0400

    committed on accident

commit 4188417ffa117ea3ca927335a72d8f5bf536c69f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jul 7 13:07:13 2015 -0400

    TLB shootdowns with test
    
    i learned that gcc will not warn if it fails to align data as requested.

commit 9584fc26485cd6ea356c227b6e0ac8094b5441a6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jul 7 14:37:52 2015 -0400

    fix time machine bug
    
    runtime·osyield() used the old method of yielding and thus made the nanoseconds
    counter increase way faster than it should.
    
    now multithreaded mailbench works on the test hardware.

commit 553a4eeb9a56a223ba44965df0403a066a7fdb70
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jul 8 11:33:54 2015 -0400

    serialize per-process chdir()s
    
    bug discovered on accident with a buggy program

commit 171be25929b179d9a592258439e28acfbff58afc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jul 8 13:53:17 2015 -0400

    amusing gettimeofday bug and thread-safe nanotime()

commit 73a67717438c0f113ceedeea9e89f67b217fb73f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jul 8 14:34:34 2015 -0400

    some benchmarking code

commit 36c03aeef74c95c9fa65246629476c26402f69e2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jul 8 15:13:24 2015 -0400

    whoops! actually use "nodups" map
    
    and don't unlink b for rename(a, b) when a and b reference the same file. curse
    you rename(2)!

commit 312345291a92ce45d7fab56183f468ca0efb9199
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jul 8 15:24:50 2015 -0400

    prevent race on process fd map
    
    thank you test hardware

commit 9fcb994b36e7d44cf51ae4bd4079a51c4d74949f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 9 12:18:47 2015 -0400

    %z. to printf

commit 6a9e4088225810f54b035287a1127caf9762d5b5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 9 12:47:52 2015 -0400

    make a bunch of posix headers
    
    they all simply include litc.h. i'm not sure if this is a good idea.
    
    i need this so i can easily build/compare mailbench on biscuit and linux.

commit bde1bf22d56e5cb502c00d33c22b51268d97e160
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 9 12:14:12 2015 -0400

    mailbench linux make target
    
    and restore correct header files

commit 501f948a1a7c4168d496c0f5668c0e4b06f5fdc0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jul 10 09:23:50 2015 -0400

    %f to printf

commit ef7b5918f0bd486e689081fd2a68dccb22e00467
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jul 10 11:18:48 2015 -0400

    thread-safe fd tables

commit e39a2212c2e2403cbf066b2357d168f2aa0dc640
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jul 10 11:47:16 2015 -0400

    checkpoint benchmark

commit 429171551cf6a38eb998e8a3340e6a092d12c69d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jul 13 15:38:04 2015 -0400

    x

commit 07dd327ae93e6cf32a0bebb94ea66450c7cff5fe
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jul 14 10:35:00 2015 -0400

    keep /tmp in biscuit fs

commit a85533bc0325362bfb829451ba897fa959062d40
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jul 14 10:38:36 2015 -0400

    use TSC for timekeeping instead of LAPIC clock
    
    LAPIC clock is annoying because the current time is unknown inbetween when a
    time interrupt is generated but before the time quantum is added to the clock
    (since the current count register has been reset!).  also, LAPIC timers are not
    synchronized between CPUs (obviously).
    
    TSC is much easier since it increases constantly on recent hardware. Intel
    guarantees that TSC increases at a constant rate from Pentium 4s and on.

commit 27e911a554f2db3369928a45b5cf0fe2dd8bcd7b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jul 13 12:49:11 2015 -0400

    make go profiler work!
    
    required simulating signals and setitimer (and thus an accurate way to count
    virtual time).
    
    also, make TLB shootdowns always save/restore context to reduce complexity.

commit 9612442aee13bb041bcc55d488eed68c91315d36
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jul 14 15:32:18 2015 -0400

    fake syscall to enable profiling
    
    make time(1) call it.
    
    its convenient to extract the profile from biscuit to a computer with go tools
    to vizualize the profile data. the method of extracting the profile is very
    sophisticated: biscuit dumps the profile to the serial console in a format
    suitable for "xxd -r" so we can copy and paste it.

commit 91445b6c767c175c2b6c7e82812d1c1e32e94b30
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jul 14 17:12:44 2015 -0400

    x

commit 730508cfee08830434e0717b95acd64e28dc1106
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jul 15 17:00:16 2015 -0400

    fix race in fpuinit

commit e3f5a85c9d0922bd16caa3877be57a2287d49698
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jul 16 11:16:02 2015 -0400

    cleanup - move SSE state into thread_t, ensure alignment

commit 5bca27ac923848490ca0997b813eeb929c124512
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jul 17 17:43:52 2015 -0400

    x

commit 0a194c889f673cfbc0af7672f98c17ee0f2e987a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jul 17 17:45:05 2015 -0400

    use two yield functions
    
    so i can distinguish between callers easier during profiling.

commit a2595e1dbe4ece90007a75571ffe0f5cb4fe8dab
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jul 17 17:48:51 2015 -0400

    getrusage(2) stubs
    
    this will be helpful for profiling

commit 25519899364645e69efad0eab93a08e6719be5cc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jul 17 17:54:52 2015 -0400

    accounting for system/sleep time; no user time yet

commit 24c59e8c800f22e58b0ff245d267a029e6d693f1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Jul 18 11:25:35 2015 -0400

    rusage info to time(1)
    
    and -r switch to enable kernel profiling

commit 997f52c62c3bb0573f4ab64ba0db4ad90c271ccf
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Jul 18 11:34:43 2015 -0400

    getrusage(2) and rusage arg for wait4
    
    a parent accumulates the rusage of waited for children, grandchildren, etc..
    POSIX doesn't specify this, but it seems like a good idea and both OpenBSD and
    Linux do it.
    
    does not account for user time yet.

commit 2d02337ea781c1a24e09d308455c531ac35c0853
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Jul 18 11:52:54 2015 -0400

    basic rusage usertests

commit af81a367307a1ffc167c612cbda7876366da420b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Jul 18 15:16:52 2015 -0400

    x

commit f5b812e2c082dc66ca8d544c552b514d62b84c4c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Jul 18 16:47:05 2015 -0400

    user time accounting

commit c7210626c319ea50aaab7ef7137cc24145c9907a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jul 20 15:30:16 2015 -0400

    fix fs concurrency bug and "simplify" inode locking
    
    was hard to reproduce. while "simplifying" inode locking code, i discovered two
    other bugs that when fixed make the locking code about as bad as it was before.
    
    need to figure out a decent way to deal with directory loops.

commit b1181f8564ac141f1308d57a4aa1c9b2b2f80e28
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jul 21 09:56:38 2015 -0400

    ls can use lseek now

commit 13fa6434ad9df345ce3beb60cf7b6db5bf21b36b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jul 21 10:42:47 2015 -0400

    x

commit 28512b3c50d1c30c3aaf73a9540471271dc58951
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jul 21 17:41:32 2015 -0400

    fix rusage test

commit 97ad1702599838d4f8d02f2cdffd9d275f4b9c4c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jul 21 10:43:16 2015 -0400

    poor man's CPU time accounting

commit 85a6ebf97e84ef6f73dd7a9d7ada1a1d96ddb65b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Jul 25 10:22:23 2015 -0400

    fs locking bugs
    
    ugh

commit 86e7be21852df942dc9e5e447c1faa94452a6440
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Jul 25 11:04:59 2015 -0400

    RAM FS

commit 5295dc8b941bc8d9b9fbe5030fa0fb37aecd1cde
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jul 29 14:44:04 2015 -0400

    more microbm

commit 17aa36ef02950b6ec41fa50645e327808b0df09b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jul 29 15:03:49 2015 -0400

    count kernel CPU time

commit 90ec1d3fe3c071d55c8c5b341ba635bce5598cdf
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jul 29 16:06:44 2015 -0400

    make rename(2) less shitty

commit f416948f1718246ed6846a952dc473a2f3b5eb9a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jul 29 17:49:40 2015 -0400

    use wall-clock time to profile kernel instead of virtual time
    
    the profile now claims that mutex sleeps are the bottleneck. i need to verify
    that this is true.

commit 8c549751a8b525c00ec94092153b8eb84c4722fb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 3 22:56:02 2015 -0400

    pthread barriers

commit 3ad5613aeae06e5283ed03cae291b94896caba5a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Aug 4 02:20:04 2015 -0400

    dump rip when div by 0

commit e2a0f4350ef5fdcf98594c4be9172deb0fdeea55
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Aug 4 02:24:48 2015 -0400

    more benchmark
    
    to help me compare performance of certain biscuit syscalls against linux

commit f0738a474cfb37790242534e5deb67fd1f4750db
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Aug 4 12:56:41 2015 -0400

    posix barrier fix
    
    i'm always surprised at how tricky a barrier implementation is

commit 371a36594a16952fd4265d3ded9891644d35ab2a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Aug 4 15:05:27 2015 -0400

    x

commit 34f5fde133cc359142d11f90f40e41d916b446db
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Aug 4 15:36:36 2015 -0400

    more RAM for mem fs

commit 77565733c5709b24302f40c0f869ce142369f096
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Aug 4 18:51:23 2015 -0400

    reminder for when we stop switching pmaps on interrupt

commit db087aaa12f242cc63c3f0906b30de4d9bd431fa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Aug 5 10:51:15 2015 -0400

    make qemu use Nehalem CPU instead of qemu64
    
    i want to use sysenter for fast syscalls but qemu64 doesn't seem to support
    sysenter. the test hardware supports sysenter and syscall, but sysenter looks
    easier to use.
    
    qemu64 virtual CPU claims it supports sysenter, but raises #UD if it executes
    the sysenter instruction.

commit eb23fbed3c9d1209b1ed42f6cabd047a724d395f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Aug 5 10:56:18 2015 -0400

    sys_fake2() for benchmarking syscall overhead

commit a46328ae3d0fff346e37fb567b8a8b3da246b216
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Aug 5 10:57:04 2015 -0400

    yet even more bm!

commit 52c552b50dffc526134411d943f39098d3527105
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Aug 5 12:15:02 2015 -0400

    pad GDT with another null segment
    
    sysret requires that the index to the kernel code/data segment descriptors is 4
    slots below the user code/data segments.

commit 2f77267ebb7f01d46d2ca6850fdf684f9139fe4b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Aug 6 10:27:37 2015 -0400

    sysenter/sysexit
    
    not using it for syscalls yet

commit 557416733ff81970f56e3e6a66e97de156981291
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Aug 6 14:41:34 2015 -0400

    use %gs in kernel mode to keep per-cpu state

commit d85e8930054a70fe8b14ec13ed472befac44001c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Aug 6 16:43:10 2015 -0400

    don't use int instruction to yield
    
    build trap frame in software

commit 770f1c12f18d038247360e89af1d01568a3783d8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Aug 6 22:45:32 2015 -0400

    avoid extra read in sys_execv1

commit 7798613043fe8f49fed86cd73ddbcfedffd6c8b0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 10 12:04:54 2015 -0400

    wait daemon improvements
    
    only keep state for unreaped children to prevent the map of pid->child state
    from getting too large.
    
    also, make wait daemon work correctly with threads: if there are more waiters
    than there are children, make sure the extra waiters are woken up.

commit 12f6359215edd94c1614eb0faf0a172e27d0b301
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 10 13:16:16 2015 -0400

    use runtime memmove/memclr instead of homerolled ones
    
    the builtin ones are optimized to used SSE and increase performance of a hacked
    version of mailbench by 57%.
    
    i made my own when i first started biscuit because i wasn't sure what the
    built-in ones depended on and we need these very early in the boot process.
    
    thus, we must call fpuinit() earlier in boot process.

commit ed0b07c85032473e34506733c6d46d343c6022f4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 10 13:34:59 2015 -0400

    only profile runnable kernel threads

commit 7dcd8750349a6d8b99cee23fc11757029d90c680
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 10 13:38:05 2015 -0400

    sanity check for new gs code

commit 0779a7a243ba99b46cddb1307434ea2d13cd2eb2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 10 17:36:02 2015 -0400

    use sysenter for syscalls
    
    mostly for fun. other things in biscuit are slow enough that this makes little
    difference for performance as of now.

commit 0306d1ba33af3797c2a5d21a3304a34f03c2125b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 10 17:46:43 2015 -0400

    whoops -- c++11 progs depend on litc.o

commit c1792a43a8b5c1e822567bef7978f96c7decc6f9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Aug 11 01:08:33 2015 -0400

    more bm

commit 951d6e17d16da126f934a5e10d6347015b0b6a1b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Aug 11 21:48:19 2015 -0400

    x

commit 1a788dd93fe834ce7f4b6f62ddb383074a0dc88f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Aug 13 13:44:28 2015 -0400

    warn in printf if string is longer than buffer

commit ab916a9e934cf1e8182435334525812abb5f0816
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Aug 13 13:48:22 2015 -0400

    even more bm

commit bc826d97b9b6a36c1a82dd0372898eacb8b9fb5a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Aug 13 14:19:39 2015 -0400

    single-threaded page map copying/set COW bit
    
    better for single-CPU performance and also stresses GC less.

commit 19d005dae7234febfa464a7cc950458f1aa6c31e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Aug 13 15:44:31 2015 -0400

    avoid unnecessary allocation for profile data

commit b6ca32ec644f4bc3c297d451cc261763e16a1cdc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Aug 14 08:55:33 2015 -0400

    net is a phony target

commit 038de27ac1219c23a0fd32418f39263197c69328
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Aug 14 08:58:03 2015 -0400

    in sys_execv, avoid unnecessary allocations
    
    instead of buffering binary image twice, read only the ELF header from the
    file, then read the binary image directly into process memory. increases
    hacked mailbench throughput by 13%.
    
    this ELF loading code was some of the first go code and thus it looked hideous.
    it is good that is was cleaned up.
    
    also, when reading files or writing to user space, use copy() with turns into
    an SSE optimized memmove instead of iteratively copying byte by byte!

commit 41d494632b7b1c88f015a6506523b65f274b9f0f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 10 13:25:27 2015 -0400

    for memfs, protect fs blocks with locks instead of block cache daemon

commit 91b289775210695a711c6af27c127e7c9a09cb7f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 17 20:49:08 2015 -0400

    cache directory entries in a hash table
    
    we cache both empty (for inserts/creates) and non-empty entries (for loookups).
    
    should improves throughput significantly -- haven't tested on hardware yet.

commit 9689d12f1f07e156e9c0a971745b31edf48241b8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Aug 19 10:56:21 2015 -0400

    uninterruptible while taking runtime mmap lock

commit 1dae5da00a486b7f497fe106951f960a5290fcd6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Aug 19 11:35:11 2015 -0400

    avoid many unnecessary allocations in FS
    
    instead of allocating an iresp_t for each fs operation, embed iresp_t in the
    ireq_t and have the inode deamons modify the embedded iresp_t directly.

commit 0fa367c1222ea1c0fe1586e7fc17541c23e549ed
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Aug 19 14:42:24 2015 -0400

    in fork, only track memory pages in child, not parent's pmap pages

commit f4842e96232436a12401ca6ae7f903ac94351910
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Aug 20 13:15:38 2015 -0400

    in pmap_walk, call only 4 functions instead of 18
    
    and use a literal for an address instead of a helper function since the go
    compiler apparently can't figure out that the result is constant.
    
    increases hacked mailbench throughput by 8%

commit a4586194fbae4fb3725ee7778e00c9f8d7f76493
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Aug 21 12:00:02 2015 -0400

    avoid append()
    
    if the slice's capacity is too low to append the object, the new slice gets 2x
    capacity. thus, even for slices that grow very slow, the underlying array will
    eventually become enormous.
    
    there are other places that i need to fix to prevent this behaviour too...

commit 43be9fb351d6771d863345b2a52bbc4294974ab7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Aug 21 12:02:13 2015 -0400

    if using memfs, don't bother journaling
    
    linux tmpfs also does no journaling, so this is fair. gets us another 7%.

commit 210a2df62137214edc202001ce181e055ae8f3b0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Aug 21 12:03:56 2015 -0400

    x

commit bd10a4129057dff936c842cf36cdd4578b164451
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Aug 22 13:43:30 2015 -0400

    fix process fd table races
    
    although the fd table is protected by a lock, the old code (which was adapted
    from pre-thread times) would create an fd with with the lock held, but would
    update some of the fd's fields outside the lock. thus in the presence of a
    concurrent fork, the forking thread may observe an fd with uninitialized
    fields, resulting in a page fault.

commit 9e70129751ccc447e38867fa3a4d01011f1c1f53
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Aug 23 10:46:31 2015 -0400

    fix races between copying from/to user virtual addresses and page faults
    
    if two threads page fault and call sys_read concurrently, the old sys_read code
    may copy the result to a page that was marked copy-on-write and thus has been
    since replaced. this code serializes copies to/from user space with page faults
    and adds explicit checks to fault-in the page that will be the destination of
    the copy if it is marked copy-on-write (to prevent a parent/child from
    corrupting the memory of the other). these explicit checks can go away once
    biscuit can handle a syscall without switching to the kernel pmap.
    
    care is taken so that a process's page map lock is only held for the duration
    of the copy (to avoid holding the lock while waiting for blocks from disk).
    
    as biscuit's mailbench performance doubles over and over, races that were
    hidden by sluggishness get exposed.

commit fea00157bb119b9ba81aea548fc95831138de512
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Aug 23 11:22:47 2015 -0400

    cleanup some VM code
    
    proc_t.usermapped() is rarely useful with threads; code using it probably
    suffers from TOCTTOU bugs.

commit 1d2c51e5545f1a5c8fe0dd6806c9de4058dd1a04
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 24 13:07:03 2015 -0400

    on linux, statically link mailbench
    
    increases linux throughput by 4x.
    
    dammit.

commit 9c345a1b035cde24649f91f567af9ff4e4e748b9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 24 23:10:08 2015 -0400

    in usertests, make sure child exits with 0

commit 795d8ee795c616c38ef9bdf47ee5deedc1795601
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 24 23:17:44 2015 -0400

    improve page tracking code and cleanup VM code
    
    i want to play fancier VM tricks but old tracking code did not allow a process
    to map the same physical page more than once

commit 563d1f2af1f79f20cbcb7c97459657b32a3c5bc2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Aug 25 15:04:38 2015 -0400

    bugfix: close proc_t.cwd when the process terminates

commit d5e84ede184561c76553d8f0426641f79ee05951
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Aug 25 16:48:46 2015 -0400

    bugfix: send TLB shootdowns after fork

commit 8986494801be83e0e308d898cfa45b6653d9ce81
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Aug 26 09:33:42 2015 -0400

    bugfix: in wait4, don't silently ignore bad user-provided pointers

commit edd2ea391d2af114e91362e7a44a6c1debf4e46d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Aug 27 13:23:49 2015 -0400

    use static map instead of creating it every close() on a dev file

commit e41e5df93f25f67a640085514b573b628f19b5f2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Aug 27 13:25:10 2015 -0400

    bugfix: correctly restore old process state if exec fails

commit 5d7c45f5dc6ab44d54e1aee741c822b1dffe9583
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Aug 27 14:23:02 2015 -0400

    redo wait* stuff
    
    instead of using two go daemons, one for fork'ed children and one for the
    process's threads, use a data structure protected by a lock.
    
    starting even just one wait daemon for each new process slows bicuit down on
    forkonly benchmark significantly. avoid much of that overhead by only
    allocating a map instead.
    
    the new wait_t keeps track of both child processes and threads of the owning
    process.

commit d725d0a75ee7f1a7ff17e793f0e9a8d64b5229bc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Aug 27 15:01:31 2015 -0400

    for fork, add mapped user/kernel pages directly
    
    instead of scanning each page in the pmap and recursively copying (vast
    majority of all entires are 0), set each PTE directly.
    
    however, while cleaning up this code to commit i came up with a better way...

commit 8e8867eb97d63b24d7ca50cfc86c87f3a8ee15be
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Aug 27 15:10:49 2015 -0400

    in fork, don't mark the stack of the parent or child as COW
    
    both will always fault their stacks immediately.

commit 7e2d88eac5982bb87c4026cbb76b5e045b0d6012
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 31 09:39:30 2015 -0400

    keep a process's VM info in vmregion_t/vmseg_t
    
    biscuit's previous two approaches to VM management were both biased towards
    either small or large address spaces. this approach is fast for both.
    
    track each region of mapped memory in proc_t.vmregion, which is a linked list.
    inserts into a vmregion are coalesced in order to avoid long interations during
    lookup. removals from a vmregion cause splits. since we now know the first
    virtual address of every mapped region, we can use a slice to track virtual
    pages instead of a map.
    
    there are two main benefits to this approach: 1) when forking, we can scan/copy
    only the necessary PTEs -- we never examine empty PTEs. 2) we can track
    allocated pages with a slice instead of a map which requires less CPU time and
    no allocations for insertion or iteration.
    
    biscuit is now as fast as linux on the forkonly benchmark! this improvement
    helps us a lot on all the other benchmarks too.

commit a228f4756f218f2fee724a06dbe1bd2fe7ebc8df
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 31 14:38:02 2015 -0400

    in sys_execv, make sure new stack has guard page

commit 8902b5d67f4d8b907b62f265b886ae574131d833
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Aug 31 16:33:50 2015 -0400

    use fancy new vmregion_t to find unused address space
    
    for mmap and exec argv/stack.

commit 650d4a458940a08f46bf61b93e9da731be600fc5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Aug 19 16:33:28 2015 -0400

    GC once heap size grows 8x instead of 2x

commit 18ff8e906e8e263f45b306b0e788c37b086aeb34
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 1 13:44:41 2015 -0400

    prepare for "unified" pagecache -- start removing bread/brelse
    
    block cache is going away, but we depend on it for synchronizing a couple
    things (inodes that share blocks and free bitmap blocks).
    
    i need a pagecache to get good exec performance.

commit 185b1245842d95b5b178117c5bb9161d8e86ddf5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 1 16:28:34 2015 -0400

    for inode metadata, replace block cache with inode block cache
    
    as a bonus: a bugfix that frees the indirect data blocks of an inode, not just
    the indirect pointer blocks.

commit 8682a7ed5ef4eb379976a6e037e04b747e320286
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 1 21:47:14 2015 -0400

    caching/synchronization for free bitmap blocks

commit 19e39a98c78787a5993d5e3af854665b92c79dfb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 1 23:22:02 2015 -0400

    cache all metadata; buffer cache now unused
    
    next, move all file data to the page cache

commit 0a37e88a994d4e8763eaa18078c0133449266da7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Sep 3 11:24:27 2015 -0400

    simplify fs forwardreq()

commit e4bc090164fb7d6a8eedb3ca6d453f71e7aeeb0b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Sep 3 13:31:39 2015 -0400

    prepare for new locking protocol
    
    forward traversal will go back to being synchronous.

commit c2fc8c4ba919f5650518a4b5102bc26c6b08b4da
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Sep 3 16:55:26 2015 -0400

    new (correct) inode locking
    
    hurrah! very happy to replace the old code with simpler code.

commit 974f3178ac25fa1baa080bc5a63dc80acb17e064
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Sep 4 09:35:44 2015 -0400

    x

commit e0c2040c29102ab799c80b73118984821ec8750d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Sep 6 10:37:37 2015 -0400

    add free dir ents back to list, avoid slice growth

commit b9b294419dff4654bc90c6b385a5ffb1b3115390
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Sep 6 21:57:02 2015 -0400

    page cache!
    
    pages are lazily filled from disk and dirty pages are flushed back. an
    important optimization remains to be implemented: only the dirty blocks of a
    page should be flushed, not necessarily all 8 blocks.
    
    memory mapping files should be trivial now. had to change caching scheme of
    directory entries since they are now stored in the page cache which doesn't
    know what block numbers are, only offsets.
    
    as a bonus, the memory fs is greatly improved and the block cache has been
    removed. memory fs is better because it no longer takes 30 secs during bootup
    to populate the memdisk: existing files are lazily loaded from disk.
    conveniently, the new memory fs requires no extra code -- turning on the memory
    fs simply turns page cache flushing to a no-op.

commit 00be909a93e377d012bd87e871b6f712733c02fc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Sep 7 08:59:03 2015 -0400

    flush only dirty blocks from page cache, not entire pages

commit 9b1c521643669588aba2b748b45d5c32fc8d30b9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Sep 7 10:52:03 2015 -0400

    bugfix: make sure to populate cache of free blocks after recovering from log

commit dafc97ea65526200b6249794f441afc338bb4e9a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Sep 7 11:29:54 2015 -0400

    cleanup logging

commit 38ab164fedde264071e5e6a7b13eca129636d6e2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Sep 7 22:46:46 2015 -0400

    for userspace, remove ld magic option and avoid worthless padding
    
    i've been wondering for a long time why ELF required that every segment's file
    offset == virtual address modulo the alignment. now i know one good reason for
    this requirement is so we can easily setup the address space: assuming the
    object is in a page-aligned buffer, all segments are already aligned and no
    further copying is necessary.
    
    because my linker script wants user binaries starting at a page-aligned virtual
    address, the ELF requirement above caused my userspace binaries to be bloated
    with tons of padding. the first ELF segment is a null segment which has offset
    0, thus forcing the next segment (.text, .data, etc.) to start at file offset
    2MB, apparently the default segment alignment.
    
    thus remove magic: re-enable page-alignment and change the linker scripts so
    that user binary segments start at +1 page size, requiring only 1 page of
    padding in the ELF.
    
    this is necessary so i can map page cache pages for exec.

commit 2f993f5e00b56afe5021df204b2dc4a44550d552
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Sep 7 23:05:50 2015 -0400

    in sys_exec, create address space via mapping into page cache
    
    this is absolutely necessary to get reasonable performance when exec'ing
    programs with large address spaces.

commit 240e8d2b422686e4a6c7cb64aea26a8aa58fe602
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 8 09:34:59 2015 -0400

    whoops -- make the other half of linktest work
    
    the funny thing is that even though this test has been half-broken until now,
    it helped me find tons of bugs.

commit 442d539a32b5cbccce76baf2874f9798e31682dd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 8 09:38:33 2015 -0400

    test hardware bugfix: remove panic
    
    it is not an error for a newly allocated iblk to already be in cache. thank you
    test hardware.

commit cf687b9b10c9acdc317eca53849c0fab60a9f15e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 8 09:41:06 2015 -0400

    test hardware bugfix: race between ifree() and icreate()
    
    the race occurs when icreate() is given an inode block that is shared with
    another inode that is about to be freed. before icreate() is able to install
    its inode into the block, ifree() decides to free the inode block since it
    doesn't see icreate()'s new inode.
    
    thank you test hardware.

commit b90c933eba7472982d07f09ff4ce3985da4668bf
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 8 10:23:58 2015 -0400

    put max blocks per syscall back
    
    uneeded since page cache flushes only dirty blocks now.

commit 1c87654cb1114d024c3f61f6ec0b6d2e1ea436f5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 8 12:19:40 2015 -0400

    mkbdisk.py: fill unused blocks with crap to help detect FS bugs
    
    i've been baffled all morning wondering why a bug that apparently has nothing
    to do with concurrency exhibits only on the hardware and not qemu. the answer
    is that, because qemu determines the emulated HDD size by the size of the file,
    i was zero filling all unused blocks. i do not initialize the hardware's HDD
    since that would take a long time (and should be pointless). thus an FS bug
    that uses an uninitialized block may do the right thing on qemu but not the
    hardware.

commit 04fbb3112bf5d7944d4fc60bf5db8d7c9c8a7391
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 8 12:24:20 2015 -0400

    x

commit d38f40eabf6e75fdbf53498c60b08b4801ade0dc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 8 12:41:17 2015 -0400

    bugfix: make sure newly allocated indirect pointer blocks are zero'd
    
    this wasn't a problem before because, in the days of the block cache, i eagerly
    zero'd all newly allocated blocks. for performance, i changed the code to not
    actually zero the blocks but allocate them in the metadata cache as zero'd. i
    missed this case though.

commit 8abb064fabe44ec83c7b4acaa0d584a8333c3194
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Sep 9 09:47:36 2015 -0400

    instead of copying for thread 0's TLS image, map the original COW

commit c893c802f01372a27e1063b8bfb9293552558fa1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Sep 10 11:46:36 2015 -0400

    x

commit c289b2dc130b03593ad707783907bfa786b6c2be
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Sep 11 13:29:22 2015 -0400

    silence gcc warning

commit 4f2ceb44f430b9e754d49c6ec0d508cd6ce4cd8a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Sep 11 14:33:19 2015 -0400

    init
    
    to create device nodes

commit afdf4f77ae274918d2ec188e95b0cd5b9abb2f55
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Sep 11 14:38:46 2015 -0400

    more bm

commit ed19ad5208b9c64a84b26dc3cd4eae336e3e6fb9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Sep 11 16:00:13 2015 -0400

    simplify open with O_CREAT a little

commit 5c15e1f8c6fce14600e80a86a241268b9d79324a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 15 09:14:39 2015 -0400

    x

commit 0ee2cfce58f7d0f401d3701786e15486cf08b0af
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Sep 23 14:30:33 2015 -0400

    prepare for new interrupt/syscall handling
    
    we will not switch page maps when taking an interrupt/syscall, thus add
    paranoia checks to ensure that the runtime never adds new entries to the
    kernel's PML4.
    
    thus, since user processes share kernel page tables, all mem allocated by the
    runtime will always be mapped in all processes.

commit 52e9e305acae0187d633a69328de72f08ae3a9e8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Sep 25 11:34:29 2015 -0400

    x

commit 57912c594f6ad3142c64c5ce8c1f424690a145fa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 29 14:54:26 2015 -0400

    add fxbuf to proc_t
    
    it is used to save user SSE/FPU state.

commit 3ad9816a4631fe8ffdb70106969aeaff89718350
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Sep 25 11:37:17 2015 -0400

    Userrun() for fast syscalls and better interface to user programs
    
    system call overhead is reduced 10x using this approach, putting Biscuit on par
    with Linux. i think the main reasons for this speedup are that, during
    syscalls, there is little state saved when switching to/from kernel mode and we
    now use a single go routine to handle all of a thread's CPU exceptions/syscalls
    instead of creating a new one for each event.
    
    Userrun() also makes the code for handling all user events (page faults, timer
    interrupts) clearer and exposes timer interrupts during user program execution
    to the kernel, allowing for finer grained control and time accounting.
    
    i still need to fix thread termination: since user programs are no longer
    managed via global state, it should be easier but i haven't done it yet.
    
    also, start converting C code to Go code. its painful because we have to have
    two defintions of every struct that is used by both kinds of code -- it is up
    to the programmer to make sure they are coherent. maybe this will help motivate
    me to convert more C to Go.
    
    cleanup trap() and trap circular buffer code since only IRQs/IPIs go through
    the circular buffer now. sadly, we can't handle IRQs using the new method
    because IRQs/IPIs are truly asynchronous, thus we need a way to inject them
    into the runtime regardless of whether the CPU is currently in user or kernel
    mode.

commit 3600ba2c89a0d7fdf3a700b4617e3c1842c829a8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Sep 30 13:33:47 2015 -0400

    whoops: kill rogue code

commit 7b14bae3b1ede63d14cd972c27b40a2816838078
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Oct 1 11:47:43 2015 -0400

    delete code that is now unused, fix process termination
    
    the C scheduler no longer cares about pids or notifying. still need to fix
    threads, pmap freeing, and kernel profiling.

commit 28f7b69fd71acdbabe5b664f6930a52997a1bae2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Oct 1 20:05:44 2015 -0400

    page map free'ing daemon
    
    in order to do system calls really fast, we cannot switch page maps on
    user->kernel or kernel->user transitions (on the test hardware, always
    switching page maps is 2x slower on a getpid benchmark!).
    
    but now it is tricky to know when it is safe to free a page map since any CPU
    in kernel mode may have the page map in question loaded at any time.
    
    thus, have a daemon that collects page maps once all threads of a user process
    have terminated. then, once a second, broadcast an IPI that causes all kernel
    threads to load the kernel page map, ensuring that no CPU can have the user
    page map loaded. finally, free all collected page maps. repeat.

commit e8a09a0d95cb53bdeb4c34d6a51167eb46d57e9c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Oct 1 20:28:32 2015 -0400

    Revert "page map free'ing daemon"
    
    This reverts commit 28f7b69fd71acdbabe5b664f6930a52997a1bae2.

commit 3a3cef58aba170adf42e824bf2029d88331c0c8e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Oct 1 20:53:58 2015 -0400

    better idea: use this fancy thing called a "garbage collector"
    
    before returning to a user program, set shadow pointers to the program's pmap.
    all interrupts currently load the kernel pmap, thus it is safe to clear the
    current CPU's shadow pointers in the interrupt handler after loading the kernel
    pmap.

commit 7079490f36e84e7f5e53fe5457b4b36ee837c473
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 2 10:22:55 2015 -0400

    cleanup pmap shadow pointers -- convert more C code to Go code
    
    move the definition the array of per-cpu structs from C to Go so it is all
    GC'ed.

commit 5931ae3b0c82ccaa7b59e555230c89eb8cf1793a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 2 10:27:15 2015 -0400

    for joining APs, clear interrupts without Go stack check

commit 2b3cdc7f2138ec8d05d333e45f49c68267ce213f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 2 13:22:40 2015 -0400

    fix threads and SMP; save/restore less user state
    
    only getrusage(2) is broken now

commit 936e9d809b4456cbd2ab2c2b4eed3f7ec30e3ae3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 2 18:03:35 2015 -0400

    fix FS segment bug; cleanup segment code
    
    also fix an amusing, ancient bug from when i apparently didn't yet know that
    the calling convention for both runtime C and Go code is to pass return values
    on the stack. my assembly code expected the return value in rax. magically,
    this code never broke because the compiler is apparently very likely to use rax
    to hold the return value in order to copy it to the caller's stack frame.

commit fda13ed50a16c256f2e062de1d927f407d8dbbce
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Oct 7 20:57:46 2015 -0400

    x

commit ea7508ebe748f7d6272533f19c13a347627c81dd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Oct 12 10:25:22 2015 -0400

    make 'qemu' target the same as 'gqemu'

commit 64aca7ed48eea38aa03dc2e01095cde8eab53b4f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Oct 13 10:52:02 2015 -0400

    bugfix: fix races between reading user pointers and address space operations

commit ff4494f2601584ea557c2bf3f64470ac664d4346
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Oct 13 13:30:49 2015 -0400

    avoid needless allocation+copy in proc_t.userstr()

commit afa9d96d6a0d94158343e3e1fdd2656999652ba0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Oct 14 09:48:17 2015 -0400

    in sys_exec(), avoid allocations for stack pages
    
    only allocate a page for the initial stack page -- map the rest copy-on-write
    to the zero page.

commit 748345a6653ecdb82bb861d381c3f9bdd0b5a57f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Oct 14 10:03:56 2015 -0400

    terminate processes that call bad syscalls

commit 106ba4db0e78c9f6bcaf363db615b0f9691d85a9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Oct 14 12:14:17 2015 -0400

    x

commit 8de81f7512e85b5d0abed396971c4d49e8fa59b7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 23 13:18:38 2015 -0400

    channel send, goroutine create, and hashtable insert microbenchmarks

commit 3959d7662a091a791262ae82519df61dd2e052a5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 23 14:56:38 2015 -0400

    if memfs, bail on page flushing earlier to avoid call overhead

commit ae1a9e7d1a1ec7480f04cae318854a34750b7593
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 23 15:00:03 2015 -0400

    add sys_fake2
    
    for testing

commit 5389dc74bbde98a76781deac845f56cc5b2aa0ff
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Oct 26 17:13:12 2015 -0400

    bugfix: make sure gs is set for APs too, not just BSP

commit 24af809c65c819399fbb23b963b159c1b3e2083a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Oct 27 12:00:16 2015 -0400

    Cprint(), a useful debugging function

commit e387f1e3cdbe53aab07e8fc150153ec62d729ac3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Oct 27 12:01:19 2015 -0400

    bugfix: prevent deadlock with TLB shootdown+GC
    
    the old TLB shootdown code would wait for all shootdowns to complete by cas'ing
    the variable holding the number of outstanding shootdowns with 0. it was
    possible that, before the CPU waiting for all shootdowns to complete could
    observe the 0 count, another CPU would install a new TLB count.
    
    i thought this was fine since the waiting CPU must observe 0 at some point.
    turns out it may not if the CPU that installs the new count is preempted by a
    GC before it actually sends the IPIs. then the GC loops forever, trying to
    preempt the waiting CPU (which is not preemptable as it is looping for the
    count to reach 0).
    
    this new code ensures that the waiting CPU figures out that its shootdown is
    complete, even if some other CPU installs a new count before the waiting CPU
    observes a 0 count.

commit 02f50069cf03d71c037b95cc3d03db13482374ce
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Oct 27 12:15:39 2015 -0400

    whoops: make sure APs null FS too

commit 557728807422108bd820050d5d04761883fbc03c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Oct 27 13:07:27 2015 -0400

    store file descriptors in slice instead of map

commit ff8a0da06e64d426479521cf2314d8de30c9eccb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Oct 27 14:24:22 2015 -0400

    x

commit d7fec5bd9c5ac90e48f0f4b9cefd5c56f767837d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Oct 28 08:36:18 2015 -0400

    expand litc print buffer

commit 10e8f66649f3bdf2a33eabe7d9b9fd7c6ce1834c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Oct 28 08:43:18 2015 -0400

    GC benchmark

commit 0fd492838c667bc92e4762edec27e444c78c83dd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Oct 28 12:42:47 2015 -0400

    delete old crap from hotOS paper

commit 054253568d1dbde6e9c379ab3f228ec2baade3c7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 30 11:58:22 2015 -0400

    get com0 interrupts working on hardware too
    
    now i can finally do performance experiments on my test hardware remotely!

commit a900f8371a90ee27205fe4daf0f5b7f4ae6dd854
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 30 13:32:59 2015 -0400

    x

commit 1a1aaa718bca2205e3407cc40802dfc1519fb82c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 3 14:01:51 2015 -0500

    document uart config

commit 66e05eadae1190737a639621159784461eb09d3d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 9 14:23:32 2015 -0500

    x

commit 875b5f5849129335ef603402f662276886f0d1eb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 11 08:59:15 2015 -0500

    fix potential FS race
    
    between free'ing an inode and looking up an idaemon

commit 7f2311008599fa389ee8b49a54cab6834c0ea077
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 11 10:51:53 2015 -0500

    sync(2), sync(8)

commit 5b93e0eb625df639cb80eaa082dc3bb03616e038
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 11 11:04:42 2015 -0500

    reboot(2), reboot(8)
    
    the old fashioned way

commit 84a49a7a96b0c3334d7c705ae8e2f154c0b07412
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Nov 12 14:02:37 2015 -0500

    update README.biscuit

commit 1bf4da6c74d61133358a97e618be13be87b346b2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Nov 13 09:34:29 2015 -0500

    bugfix: dont assume address space is non-empty

commit 049fefc21caee2ca07a625177fce7a32ed615944
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Nov 13 17:14:51 2015 -0500

    make elf_load() handle segment's that share pages
    
    necessary for the new, more correct C++11 binaries

commit 46ee995dbccb074b4c49b495c52301ef1b4f3830
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Nov 13 17:17:04 2015 -0500

    solve ld's bewildering "BFD assertion fail" error
    
    the problem was that my erroneous linker script included a bunch of superfluous
    ELF sections that g++ generates for object files, but apparently do not belong
    in the final executable object.

commit 5ddcf670b54b0f9f97a78c3b421929865ff2009b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Nov 14 09:15:49 2015 -0500

    disable rusagetest() until i fix getrusage(2)

commit a1e72e3eef0c18f34b0926408fac74bc1940d9e9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 16 10:58:58 2015 -0500

    x

commit 1765f5b00eafeee61fef6efb2d8ace26de29303e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 16 12:47:47 2015 -0500

    don't copy zero page in page fault handler
    
    allocator zeros objects for us, so the new writable page is already zero'd.

commit 0c7654082bab61d8a01036060447fabef78083f9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 16 12:56:09 2015 -0500

    make sure no section follows .bss
    
    to avoid a fault

commit ac13008150c81ade8e6e00338ae0e82a4c07c5a6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 16 14:54:59 2015 -0500

    x

commit 72517d286e179c2e4f74b1ac585938c08b8588fd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 16 20:42:12 2015 -0500

    x

commit a7843f5eb6dc01bdb12f3975f23b5bc9f1e31f3c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 16 22:17:33 2015 -0500

    errno
    
    because this code makes errno thread-local, this code puts a TLS section in all
    our binaries... may we should do something more clever.

commit 5cca907088114f1c480957c31590d928cea3e0f0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 17 10:32:20 2015 -0500

    bugfix: locking misuse

commit c26572a255074a62d2d525ceb22cdee5d17be894
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 17 10:56:15 2015 -0500

    use fancy new errno; make err(3) use it

commit 3fbf8d1b5aeb3c280b5c201b092e562525a5aa9c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 17 11:21:24 2015 -0500

    whoops!
    
    it's funny that usertests passed with this bug present

commit 0009592966a35dc3dcbbc6b385411e2c4917084d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 17 13:38:33 2015 -0500

    "{dev_t,time_t} shall be an integer type"
    
    but signedness seem to be left unspecified by POSIX.
    
    Redis wants time_t to be signed.

commit 33058617f2d38f6b562fca96305dc4ebea8aa788
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 18 09:06:37 2015 -0500

    x

commit 94add512e819dba5a4413f9c40cb54b95e2a9336
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 18 11:14:40 2015 -0500

    expose vsnprintf(3)

commit 7cc33cf557856a0f45acd6a00cad1ff15ac6896b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 18 11:27:47 2015 -0500

    move user space include files to user/c/include
    
    i perfer having all source in one directory, but since POSIX requires many
    include files, it is better this way.

commit a0038c9d9ffa956c0e40416d6d5fd6d3947b4b41
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 18 15:20:54 2015 -0500

    wait3(2), some wait stuff
    
    for redis

commit 60cdccbf3c925dc96b015f4eaff9ead0f98466cd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Nov 19 12:16:23 2015 -0500

    atoul -> strto{,u}l

commit b78005c2759321ca42fc4d5ccebd2f285928a428
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Nov 19 14:53:42 2015 -0500

    checkpoint Redis dependency prototypes
    
    figuring out what Redis needs to run on biscuit and using Redis as test
    application for a new way to build biscuit userspace programs.
    
    so far: a few syscalls and significant amount of libc.

commit 90dd2b5c29b84aa3500786337d3062109b57e4d6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Nov 20 05:45:23 2015 -0500

    generalize file-desciptor operations, cleanup sockets
    
    this is useful because it makes the code significantly simpler and it will make
    implementing poll(2)/select(2), which should work on any fd, easier. still need
    to cleanup a few more things.
    
    the socket code is better, but i have a much better new design which i will add
    momentarily. i may as well add non-blocking support (required by redis) while
    i'm at it.

commit 664895e2bbcdac714e9647dba182df6ea73a45c3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 23 09:08:01 2015 -0500

    more fd cleanup
    
    move offset/lock into fdops_i; remove explicit type checking

commit d619b43b85ed9fca4e6f7bc03526de866c5f76fe
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 23 09:59:48 2015 -0500

    _fs_open(), use it instead of general fs_open()
    
    fs_open() is for opening a file that has fd operations, _fs_open() is for
    manipulating files that do not have fd operations (like creating a special
    socket file during bind(2)).

commit dc6f1077014c0803346fb749d5bed0012643e821
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 23 10:11:23 2015 -0500

    remove superfluous file_t arg to fdops_i

commit 7d1cc006973eed61b4fabf3f12a899a162d4d87b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 23 10:31:49 2015 -0500

    remove unnecessary indirection
    
    it took two dereferences to get to a process' file before (fdtable->fd->file).
    this is merely an artifact of evolution. remove it.

commit 6fd98d10728ddbcc4952df2999c103da28d5e92b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 23 12:39:45 2015 -0500

    bugfix: fix races between between threads of same proc on one fd
    
    many underlying file types assume no operations will follow the last close(2)
    on the object, but two threads could race to close(2) and do any other
    operation. this code fixes these races.

commit 837637bd4114115811e5ec33d865a4f5a2c0a7a5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 25 15:33:52 2015 -0500

    bugfix: fix exec args spanning a page
    
    forgot to increment total bytes counter. uncovered via new poll(2) tests.

commit 2eb966e78034544cf84c83af00ce5f7aff23e464
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 25 17:05:15 2015 -0500

    poll(2), poll subsystem for devices
    
    the most complex part is probably the conversion of internal flags to poll
    flags. all fd types (file, dev node, UNIX socket, and pipes) are pollable now.

commit f7b299832126bc3995b9d6dec102320626f456bf
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Nov 29 12:42:55 2015 -0500

    select(2)
    
    actually a wrapper around poll(2)

commit d1dfc490f4a8324acf2229ab9de04ae91b7fc66a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 30 16:51:18 2015 -0500

    prepare for UNIX stream sockets

commit 7c7e7f9966ab45281812e36c6b6d6fba9d57344b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 1 10:12:14 2015 -0500

    send(2) -- a wrapper around sendto(2)

commit 845d7ef49328679d7c6d1c37e3804d53d8d36b04
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 1 17:26:54 2015 -0500

    UNIX stream sockets
    
    i tried several new approaches for implementing connection acceptance/reading
    and writing but using a daemon seems to be the only single mechanism that
    solves the following concurrency problems:
    - threads race on the same fd such that some operation follows the last close
      on the file.
    - threads/programs racing via a lookup a UNIX listening socket via a file and
      the listening socket terminating.
    - on a socket's last close, blocked operation should be failed
    
    also, listen(2) is odd in that it changes the underlying socket's type -- a
    listening socket and a connection socket are created via identical socket(2)
    calls, but they behave very differently.

commit 8ea1fa8343e10815c049f027eb8aedcd73a09d2f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 8 10:20:12 2015 -0500

    finish REDIS prototypes
    
    now on to REDIS dependencies...

commit 0f8c3af1b88b82aafef795c3085218a69e25913b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Dec 9 12:14:15 2015 -0500

    usertests has its own rand() -- avoid name conflict

commit 730889da67902891fd18b48a4f13b5f58531fbe4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Dec 9 12:47:42 2015 -0500

    whoops! forgot last redis prototypes

commit 94a18790d93b5c6be3253360668777ffddcbb1a1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 10 11:44:32 2015 -0500

    hiredis prototypes (redis dependency)

commit 58a535150c54fc9e9f17c2565cd9efc569580a1c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 10 12:05:38 2015 -0500

    generalize user-space circular buffer
    
    should use it for pipes too

commit 3ea3a006b6de0554dcd29aecae937e69b60ce500
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 10 12:07:27 2015 -0500

    whoops; forgot hiredis headers

commit 8002513211e2cc4312eb655d5e12466c28a75702
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Dec 11 07:40:54 2015 -0500

    use circbuf_t for pipes
    
    avoids a needless allocation/copy for each read/write and allocates only one
    buffer.

commit aa0149c9ebe5360b08d85439183810d2cab393a8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Dec 11 07:26:25 2015 -0500

    use pipes for full-duplex unix stream
    
    it's nice to reuse existing pipe code, but this requires two go-routines per
    connection -- one for each direction. if creating connections is a bottle-neck,
    it may be necessary to merge both directions into one go-routine.

commit 665f9038e32b3dd692e3ac7e2f846b3d744c2150
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Dec 11 16:31:02 2015 -0500

    finish redis and redis dependencies prototypes
    
    removed lua and linenoise dependencies from redis to avoid adding functionality
    required by them (linenoise is an interactive line-editing library used for the
    redis CLI).

commit 3290d7f6c4f77fe331bb4b0e0cd4cf3d633d5f59
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 14 13:59:41 2015 -0500

    pthread_attr_[gs]etstacksize(3), trunc(3)
    
    pthread_sigmask(3) just warns for now

commit 688e9f109a4c7458ee529b95d0bf9a0e3b32b5e0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 14 16:26:06 2015 -0500

    very accurate log(3) implementation

commit 2a11b1bca65ad36df039f089de97082fbeb6291c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 15 10:50:32 2015 -0500

    fcntl(2)
    
    only basic commands (FD_[GS]ETF[DL]) work. will add O_NONBLOCK support to UNIX
    stream sockets next.

commit 01366050b7c5d31eb20a34548d5f4f90e8b787f5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 15 11:35:26 2015 -0500

    uname(2/3)! and bunch of small stuff (isalpha, tolower, etc.)

commit fb91fb5004d25b65cb8adc3051b99ea2a5e1e6bd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 15 11:39:29 2015 -0500

    fix strtol(3)

commit d298992a3e67feb2ced05c76cc6d20515a3e7a45
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 15 16:00:34 2015 -0500

    nonblocking pipes/unix stream sockets
    
    via socket(2) or fcntl(2)

commit 853927c94fa6974d30b824b737c37fbf2d36b6a0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Dec 16 09:21:04 2015 -0500

    move O_APPEND into fops

commit 50086de85ccbc73b317b646c9d4f5935e5aa750c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Dec 16 12:18:34 2015 -0500

    x

commit 04621112012ec427a1d634a7d990f9b93648ddf0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Dec 16 14:26:08 2015 -0500

    more small things for redis
    
    rand, srand, random, srandom, strerror...

commit bcfca355e354cfbee2f77fa6b5a0a8abd80a89e4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 17 12:21:53 2015 -0500

    pread(2)/pwrite(2)

commit f3002d8ea28d5f3ca8aae5ae44c88cac68499b72
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 17 15:55:09 2015 -0500

    pthread_mutex_unlock(): crash if attempting to unlock an unlocked mutex
    
    i'm not sure if this breaks applications, but it seems like a good idea.

commit 200d1f792486a8077d6b5b5ba2a7808c9870bda9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 17 15:03:24 2015 -0500

    standard IO FILE streams

commit 2f1bea89d3bed667bb08a593d16a3ddcbeba62e4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 21 12:18:36 2015 -0500

    mkbdisk.py FS creation bug
    
    during creation of the freeblock bitmap, the calculation of the padding size
    was wrong if the # of allocated blocks was divisible by 512.

commit 3d5851d65c999b1eb06d8588fbf9291a34006253
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 21 16:01:10 2015 -0500

    realloc(3)/calloc(3)
    
    this realloc implementation may be easily tickled into to having bad
    performance.

commit d1850195ebf87f70c8539b3271a9aa17110dffcb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Dec 21 16:25:56 2015 -0500

    bunch of small stuff for redis
    
    [gs]etrlimit(2), ctype stuff, signal/sigaction (that only warn)

commit d4c3dc058688d208184a718290877290149af257
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 22 11:25:59 2015 -0500

    getcwd(2), pwd(1)

commit c850e10b94c4054d5c4268d71b43ccb55449830e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 22 11:59:28 2015 -0500

    durp isdigit(3) bug

commit de19a7cea829c57ebefa9e9b710a4e85b2f36b07
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 22 11:59:13 2015 -0500

    more small redis things

commit cf6700efc03ae70fa94119c3b2aa6ad894a5d1ed
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Dec 23 12:03:44 2015 -0500

    strtold(3)/strtod(3)

commit 3f114ec37174869cc1d11c48b0c5ab35e508bc1d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 24 10:45:58 2015 -0500

    getsockopt(2) skeleton

commit ce95945d3135eb0216dc1a6f53f979bd17865206
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 27 13:03:23 2015 -0500

    ftruncate(2)/truncate(2)
    
    and a small bugfix with little cleaup

commit 4dcf4a274dee935e34161a65e77cedd3235e1127
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 6 11:55:11 2016 -0500

    bugfix: missing curly
    
    yet i still won't make myself use curlies for single line if/while/for
    statements...

commit 031296e36c18c6f492533fa027df7791c625020f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 6 12:17:49 2016 -0500

    more stdio stuff for redis
    
    ungetc(3),fgets(3),fgetc(3),sscanf(3),ftello(3)

commit d2da78fdadb3b7ae7c48cba1b1b6537229e833aa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 15 11:17:52 2016 -0500

    qsort(3)
    
    i may throw this out for a better one later. it only took an hour or two to
    write so who cares.

commit e37e1182ad7e0173d2e832899ab30e0dd6ffbdaf
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Jan 20 10:56:45 2016 -0500

    test hardware imaging script

commit b09cd10024f8009603d96397b5831367195600e4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 20 11:05:48 2016 -0500

    update 'net' make target
    
    so malte and srivatsa can easily image the test hardware

commit 349cbfcd2d10074d61f06e3eb96c36dee8eae653
Merge: b09cd10024 e37e1182ad
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 20 11:07:05 2016 -0500

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit ddc8446131cb62e7b217e080f84d0123517a1568
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 20 15:04:39 2016 -0500

    concurrent fs syscalls may not be flushed immediately

commit 93de2795196d63767cd99a879aae2106b7792dbd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Jan 20 14:13:54 2016 -0500

    silly access(2), strdup(3), execve(2), and stub ctime{,_r}(3)
    
    biscuit has no permissions or process environments yet
    
    only one thing left for REDIS!

commit 1fedc244e479620e35b0ce5abb0b9ada4a183b10
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 21 11:31:36 2016 -0500

    allow fetching and setting "native" locale via setlocale(3)

commit b39fc1c1d693835b70a306c76d1d3445ff6be857
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 21 11:33:03 2016 -0500

    bugfix: always allocate a new object in realloc(3)
    
    the old code used the wrong original size in order to determine whether or not
    an object was being realloc'ed with a smaller size, thus corrupting the heap.

commit 8f4a9b8c39079bd5ac1909650a3a3a7302c512a9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 21 11:37:06 2016 -0500

    stubs for pthread_cond_*
    
    i think REDIS only uses them for its append-only log of DB ops, which is off by
    default.
    
    however, i will probably add futexes soon which i will use for pthread_cond_*
    and pthread_mutex_*.

commit 4124d73eed0b74241df6fc080c9b0e1f6baedc8b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 21 12:01:09 2016 -0500

    bugfix: sort 2 items correctly

commit 57007be2dcc264b5c14c4eaf7b987ca4247c41b0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 21 12:44:25 2016 -0500

    bugfix: fix prefix gobbling in strtol(3)

commit 9bada81b1c8e648585192d756be8f63d6a463ca8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 21 13:17:54 2016 -0500

    usleep(3)
    
    for redis-benchmark

commit 071dc69394e7f08bc51b4aad35eef1ab2ceb10c5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Jan 21 16:47:54 2016 -0500

    increase printf temporary buffers
    
    will replace these buffers later with fputc(3)

commit 5fdaa7033444420b815e85214dbc7963a0bfb323
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 22 09:51:12 2016 -0500

    when poll(2)ing listening sockets, only add poller if necessary

commit eeb66bd9e9c458f7de4336d8ce6fba3dc385b267
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 22 12:19:38 2016 -0500

    non-blocking accept(2)
    
    REDIS requires it

commit 9f7533d253f6633622172cb65615bb8eb189ea58
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 25 10:28:27 2016 -0500

    nvcount() -- useful for testing
    
    keep a counter on the first disk block. test kernel configurations using this
    counter to distinguish between runs without rebooting/re-imaging the test
    hardware.

commit 355962a8e8d308eaf4c15154dc56b97361e35561
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 25 10:31:07 2016 -0500

    put user stack at maximum user address
    
    makes it more likely that stack overflows immediately cause a page fault. in a
    REDIS function that assumes the stack is at least 16k, the rsp was decremented
    far below the guard page and into thread 0's TLS page, resulting in memory
    corruption.

commit ec3f4e4dd1bd94a8cdcb0349d08c5f692f3025ff
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 25 10:58:02 2016 -0500

    increase default stack size to 6 pages
    
    for REDIS. has little effect on exec performance, thanks to copy-on-write.

commit 740eb9fb65a6564b0e9de2a11ace1ec4ad33695b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 25 11:18:03 2016 -0500

    no-op pthread_setcancel{type,state}, pthread_cond{destroy,init}
    
    with hacked pthread_cond_wait, REDIS works!
    
    and it's only 500x slower than REDIS on Linux!

commit 4689e8a6c0f004f471adba94a80b66082171f35b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 26 10:40:26 2016 -0500

    bugfix: initialize pthread_mutex_ts for stdio streams

commit bb08bb59134f5cb44fd84981377ed79283252942
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 26 11:50:14 2016 -0500

    futex(2)
    
    note that this futex behaves differently from Linux's futex. this is
    intentional. the hope is that biscuit's futex turns out to be simpler.

commit bb9673b67f9caaac81e8c1b29bbdb539284f4e3c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 26 12:01:30 2016 -0500

    use futex(2) for pthread_mutex_*(3)
    
    beware: may affect performance of some programs

commit c566a5a755eb3e464c2afb6592a9cbc6505eac3c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Jan 30 09:59:29 2016 -0500

    finish futex(2), pthread_cond_* &c
    
    most of the complexity comes from the optimization to prevent a thundering herd
    after pthread_cond_broadcast(3).
    
    the original design was simple for lock/unlock only; it has since been thrown
    out due to complexity. the original design did not spuriously wake up threads,
    but avoiding spurious wake ups seems to require a lot more locked instructions
    from kernel space and allowing threads to be woken up both with and without the
    lock acquired depending on the circumstances. this made the timeout code
    (necessary for pthread_cond_timedwait(3)) quite tricky since it may be hard to
    figure out whether or not you have the lock after a timeout.

commit effc1bb8133789b1646ac9af57d284cdc1065632
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 1 10:29:38 2016 -0500

    futex(2) bugfix and cleanup
    
    remove timeout metadata if it exists after "normal" wakeup

commit d490f9b35e4ecfa4aab263ac1168d9635e722455
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 1 13:50:59 2016 -0500

    x

commit b87d6b44bc6813a4be0a075614e757b6f214e24e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 1 14:27:09 2016 -0500

    comment support for my sweet shell

commit ac56c2b9b7fc40a14457b5177eeef95426653a11
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 1 17:14:57 2016 -0500

    poll(2) timeout arg is ms, not us

commit ad7e9d171be4b9535de4da9292059ae5307c8ebf
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 1 21:42:46 2016 -0500

    bugfix: make FD_ISSET range [0, 1] instead of [-LONG_MIN, LONG_MAX]
    
    i really need to be more careful choosing my types. my select(2) implementation
    uses FD_ISSET in a function that returns type int, but the old FD_ISSET code
    returned the raw bit from the fd_set instead of returning whether the bit is
    non-zero. thus, checking bits 32 and higher were truncated and FD_ISSET always
    returned 0.
    
    redis-benchmark seems to successfully run all tests now.

commit fd09618bd9d2e2cbe8ea7e3a3c5972c3468a889a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 2 13:53:40 2016 -0500

    fix and optimize pollers_t for poll(2)
    
    to prevent uselessly iterating over large arrrays, remove metadata for waiters
    who have since timedout.
    
    also, use an array instead -- there is no need for a hashtable.

commit dadfaf660e7674d8c42d5ceb9c5fb62feb56e2aa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 3 12:55:20 2016 -0500

    use a baud rate that is not from antiquity
    
    this saves me probably 30 seconds of waiting for a performance profile to dump.

commit 00b194c052c2b9f8840567b62e49e692d0b705a9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 3 15:44:38 2016 -0500

    forgot racing case

commit 127aaa19d1e3bffa29ca490308078bc363f11dba
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 8 10:15:15 2016 -0500

    x

commit 7206bc36cec06cf8a910ef26769a3ed5d5770ab8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 8 12:07:12 2016 -0500

    avoid using select for pipe daemon
    
    i implement pipes as a goroutine daemon. threads execute operations on the pipe
    by sending on per-operation-type channels (reads, writes, polls, etc.) to the
    pipe daemon. per-operation-type channels are nice because blocking readers or
    writers is trivial -- the daemon simply doesn't read from that operation's
    channel until it is ready. thus the runtime takes care of queueing of all the
    threads for us.
    
    unfortunately, select'ing over all per-operation-type channels is slow due to
    complexity and the need to lock all selected channels. instead of selecting
    over all per-operation channels, use a single channel of a type that can
    describe all operations and manually queue blocking readers/writers.
    
    this increases xput of redis by 2x (linux is "only" 8x faster now). before this
    patch, select accounted for over 25% of cpu time on the test hardware during
    redis-benchmark. now it doesn't even showup on the profile.

commit 251c14f2155c1e1cec109db3266bf33a0a9c1679
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 8 18:07:02 2016 -0500

    for unix stream sockets, skip polling the other pipe if possible
    
    give us 14% increase on redis. there are bigger fish to fry, however.

commit 2edfb7be16739788f20a5846eeaf04a158cfd193
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 9 09:24:16 2016 -0500

    bugfix: runtime.usleep() takes us, not ns!
    
    and use the right type

commit 936269fb17bc7a205b7b177d751ab6a5c441b844
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 9 11:53:48 2016 -0500

    start fixing some types

commit cd37c7a96d6fd5d1628af4ccaa8fb9382227d7f3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 9 12:46:52 2016 -0500

    unstupidefy and convert TSS64 code C code to Go
    
    in preparation for NMI interrupts

commit 709aad3a882250082360b61c38475e2b646228d9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 9 14:37:24 2016 -0500

    allocate/map AP's NMI stack

commit 4b6d690e33c3cbba0103c62f4b86bef277178278
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 10 09:14:27 2016 -0500

    fix cpuid family/model calculation

commit 96fa737ec3f75661d98cb3a2b00eb8cf6f4cdeed
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 10 09:33:43 2016 -0500

    performance profiling skeleton via NMI and performance counters
    
    and an IPI to enable/disable the counters on all available cores.
    
    should have done this a long time ago; preliminary profiles look promising!

commit bb5a1721fff47c5a8e5614c72e91775653da9530
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 10 11:46:20 2016 -0500

    more robust kernel fault printer
    
    so that faults taken in weird scenarios, like when the print lock has been
    taken, are more likely to print to console.

commit 6a5ea486f202e6c56c962ef0016f8bb4afca0098
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 10 13:00:29 2016 -0500

    background jobs for my sweet shell

commit 58b3eb92190abc687f8f6338a61f7187408f7155
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 10 15:17:06 2016 -0500

    barebones RIP sampling

commit 571984098ed696fe6d8e34627ba6b6bae164b3c7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 11 14:33:11 2016 -0500

    profiling cleanup

commit 52f1a8f45c66b3d4feb75984ba8b1a9db45ef565
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 12 16:43:51 2016 -0500

    poor man's NMI backtracing via Intel branch profiling
    
    if only my cpu was one generation newer, the backtrace would be way more useful

commit 5622df310bc9755d2e9c920fd5dac464505b9b38
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 12 16:48:09 2016 -0500

    make stack dumps readable on serial console

commit 1c794d219b1d036e42ac185a6cd776672638e3d9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 15 09:20:06 2016 -0500

    remove pointless defer

commit 95b564452e27985f9c0dd62357a2c201dd0ec53f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 15 09:54:36 2016 -0500

    rename usercopy() to k2user()
    
    and add user2k()

commit b3e5426f69ea56239cc9aab1f754de569f81801f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 15 09:56:01 2016 -0500

    in poll(2), copy pollfds out of userspace for processing
    
    and thus avoid the overhead of reading/writing directly to userspace.

commit 0c7b32fbcb4c800a0c40572c16096d7776761211
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 16 14:05:16 2016 -0500

    bugfix: make sure stack is 16-byte aligned, for gcc
    
    gcc may emit SSE instructions wihch require 16-byte alignment.

commit 117a717ce6b4d4ca2138eceaddaa4f797f4ee640
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 16 14:35:20 2016 -0500

    note to prevent baffled cody later

commit bd583b4a0b61e7ae4ccb2d7786ea983015fba2f9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 17 10:03:17 2016 -0500

    x

commit 49ff66946400365b4c0eff9db61939998b38fd59
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 18 13:23:28 2016 -0500

    bugfix: read whole serial console fifo
    
    my hardware will not generate an interrupt until the whole fifo is read. now
    the serial console doesn't break if i accidentally paste a buffer into it.
    
    two other things: 1) use specific EOIs to ensure the irq handlers acknowledge
    the correct irq and 2) don't use auto EOI mode on 8259; it generates many
    superfluous interrupts.

commit f6a04fd2519bea0c8dd64da7bb45cf58e71133c2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 19 12:51:17 2016 -0500

    remove crappy process time accounting
    
    it was always a hack, but has been broken ever since i added fast syscalls.

commit 1e4a87498b433631824275a8d2221a3aef6072dd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 19 13:15:05 2016 -0500

    replace pipe daemon with typical implementation
    
    the pipe daemon code is not a good opportunity for us to compare the trade-offs
    of CSP style because the daemon approach has no benefits here (not even
    simplicity!), but has some serious and demonstrable performance problems
    (mainly due to the misuse of channels as locks). thus, the poor performance of
    the pipe daemon has more to do with a bad design and less to do with CSP style.
    
    the new code, unlike the daemon code, requires an order of magnitude less
    scheduling events, less memory copying, and less heap allocations. it doubles
    redis throughput.

commit 818a1d8121dcaaf94c7f199bac4af3c1ab9c6be4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 19 15:59:10 2016 -0500

    move gettimeofday(2) to userspace, similar to linux's vDSO
    
    gives redis +30%. linux is only 2x faster now!

commit cf6a4089144bd48cc739e98ff1e8fd1b89b85e54
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Feb 20 11:06:38 2016 -0500

    remove two more cheesy defers

commit e46b6a05cd8ab92256f5a029a34cfa062f76f37b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Feb 20 21:23:16 2016 -0500

    cleanup pipe use in unix stream sockets
    
    don't understand why the pipefops_t were not stack allocated...

commit e8996f5545395c87fa2585478f87cf47f3da1c1b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Feb 21 10:00:02 2016 -0500

    in poll(2), double check the fds of interest
    
    linux does the same thing. gives us a small speedup of ~10%. cleaned up the
    code a bit too.

commit cba66279018a6efdbb153903a23fc4718108d1e2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 22 17:51:07 2016 -0500

    use right type

commit b3416e90cdcb811ed12c1b122cb6e508a35f1713
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 23 12:33:59 2016 -0500

    performance counter reservation/reporting

commit e4b26400804dcdde503520bea560c8bd467d63bc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 23 14:33:30 2016 -0500

    whoops; don't forget to shift mask

commit 1537e1f51cab44f77d8fd4b94d012bed432a31db
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 24 19:39:27 2016 -0500

    avoid unnecessary TLB flush

commit fbc0a61061615ef4ff8df6fa3aec24efb77aca32
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 25 09:55:01 2016 -0500

    don't count performance events during NMI handler

commit b0be23f8208d3393f4aba7d5b6a04069fe8af6f5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 25 10:16:16 2016 -0500

    branch miss pmu event

commit 1ba3d5fc15a7977921ba873b65f718dd261fffb2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 26 14:13:18 2016 -0500

    fix mmap(2) and pthread_create(3) return values

commit 3d6b1f99fa6fed01b4f0f7b9113ec918d52857ce
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 26 14:17:12 2016 -0500

    more pmu events

commit 3c5f27f4d00edcb9515b7029905f46e079486ce0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 26 17:16:00 2016 -0500

    fix more types

commit e71a7b78e9db0130eb1f530918092f0f28bfa303
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Feb 27 11:34:09 2016 -0500

    remove more silly defer

commit d6c9f41dbb1016d865ddb05d2c0692ecccda81f0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 26 17:20:32 2016 -0500

    make malloc(3)/free(3) less brain-dead
    
    my stupidly simple malloc/free track how many objects are allocated on a
    segment and munmaps the segment when the count reaches 0. if a program mallocs
    and frees the same object in a loop, malloc will mmap/munmap a page for a
    single object continuously. apparently redis-benchmark does exactly this.
    
    thus, modify free s.t. the segment containing the object being freed is
    unmapped only if it is not the current segment into which objects are being
    allocated.
    
    improves redis throughput by 47%. on redis, linux is only 1.77x faster than
    biscuit now!

commit 20c620212cbff204c09ce38c3ddc60213e144ec2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 29 11:05:00 2016 -0500

    generalize/cleanup NMI profiling

commit 8e1f420731e5d3e1e3e2b30cd3792eacf02bc8ce
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 1 10:26:12 2016 -0500

    x

commit bb6ba62cbd0d344f9eebd77a3b5971fe9cac82dd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 1 13:50:16 2016 -0500

    bugfix: get clobbers right for thread inline asm
    
    once i added fast syscalls, i apparently forgot to update these callers.

commit e1b925f16ab14819ce245b67e267a2398f53904a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 1 13:56:06 2016 -0500

    use dirtest() in usertests

commit ffb4f0660ba1f3eb6ad0922f5cb7da2ad8c82036
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 2 12:15:05 2016 -0500

    un-derpify some of the first go code

commit 4e9106d6103cfb1bba2ae85391fac028989f2f3b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 2 12:16:21 2016 -0500

    in getopt(3), don't require whitespace between option and option argument

commit c8f1cd04b88a3b10cff7199dfe55660171c0b332
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 3 10:48:41 2016 -0500

    support "%%" format in printf

commit 44ffb855f022f86ff89825e51bd8bf505264d8ce
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 4 09:33:51 2016 -0500

    profiling sysreq

commit be1c05604b821ba71e69bcdedd9ad5157d60b7a7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 4 09:51:34 2016 -0500

    bugfix: fix vmregion_t.empty() to search only necessary entries
    
    instead of pointlessly iterating over the entire list

commit df37ba91722406a7c0167ccd63b521187f0195f1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 4 13:44:37 2016 -0500

    bigger fs

commit 9d7ed5792bf3272212cba9e35f24dda8ec796639
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 4 13:45:30 2016 -0500

    new bmgc

commit 3b52f875747da9139455aff1a73b0f19e6ed712f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 4 16:45:19 2016 -0500

    start the probably long and terrible road to merging with 1.5
    
    will then merge with 1.6 if all goes well. 1.4 -> 1.5 will probably be more
    work than 1.5 -> 1.6 since i need to convert all my C code to go code.
    fortunately, conversion to go code has a few benefits.

commit 802c0853b6181d05707a9617d894d4c20364403b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 4 16:50:07 2016 -0500

    note

commit 9bcf96fb6b3400d4994aab3079f01c0fb0162add
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 7 08:22:19 2016 -0500

    convert and cleanup segmentation code

commit a462abcffb2d074d365b07930e844e62b852af99
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 7 12:27:01 2016 -0500

    convert and cleanup interrupt init code

commit c25f8fd81340dac2232dda30103b50c15ee9a1b2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 7 16:58:16 2016 -0500

    convert/cleanup pmap, FPU, and physical memory code

commit 52206a8a4e651d7bf860ffe777e620e49e857753
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 7 22:29:40 2016 -0500

    convert runtime's fake mmap
    
    all this physical memory management code will probably go away soon

commit fabac2066375972d19f23a2997a9718b9f813e4d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 8 13:05:37 2016 -0500

    convert and fix fake munmap and tlb shootdown code

commit 01398330b0a342dca59abcd1fcbd4f9172c52c5d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 8 15:19:32 2016 -0500

    convert fake clone

commit c8bf8e0cb06d3ba231ba90071303ab38d27087fd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 8 16:37:44 2016 -0500

    start converting scheduler code

commit fe3471e33f3fe3e430246c9855c46036355c5e4f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 9 11:14:30 2016 -0500

    finish fake syscalls: exit, sigaltstack, nanotime, futex, setitimer, write

commit 624faa7efb6223d3632e7f3a65efbedab9698a2d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 9 14:37:55 2016 -0500

    convert LAPIC init code

commit 7ce9f81275ddcb9582b1289a8d57134daa7866f7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 9 17:09:15 2016 -0500

    finish init code: BSP/AP, syscall, and GS init

commit 19c7622688382187565f3028ca8b70f697663b07
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 10 11:32:26 2016 -0500

    convert trap()

commit 3b2847880ad9ea408a9c1c3405a6dfb8dc3974b0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 10 23:18:13 2016 -0500

    complete bulk of the conversion
    
    SIGPROF simulation for profiling and various others. now only a dozen or so
    lines of C code remain. the C code has no knowledge of threads or cpus.  great!

commit 458bebe13f7cf51f41d66388d18ddeac670212f5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 11 11:23:57 2016 -0500

    finish and cleanup of main C file
    
    just trap{sched,wake} C code remains.

commit 9dc22ee5cffa389a199e69a2756c6c6e4fbc4db5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 11 15:32:55 2016 -0500

    final cleanup
    
    i cannot convert the trap sleep/wake code to go since the 1.4 scheduler is in
    C.
    
    now for the merge!

commit e2f500e61c3c4075737c89bcab37cdf66cc167df
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Mar 12 15:41:30 2016 -0500

    avoid pmap freeing race
    
    a cpu's currently loaded pmap could be GC'ed after it sets the shadow pointers
    to a new pmap but before it loads the new pmap in cr3.

commit d2eb6433fbeb4c4e81dbda541959e71e03c244c6
Merge: e2f500e61c 7bc40ffb05
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 13 11:21:11 2016 -0400

    Merge tag 'go1.6' into tmerge
    
    Conflicts:
            .gitignore
            src/cmd/dist/build.c
            src/cmd/ld/lib.c
            src/liblink/obj6.c
            src/runtime/mgc0.c
            src/runtime/os_linux.c
            src/runtime/os_linux.go
            src/runtime/proc.c
            src/runtime/runtime.c
            src/runtime/stack.h
            src/runtime/sys_linux_amd64.s
            src/runtime/traceback.go

commit b193f491121140c325fed031f424c3330a043829
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Mar 12 12:20:38 2016 -0500

    1.5 updates
    
    one notable change: go1.5 no longer uses amd64 ELF TLS address of -16(%fs), but
    -8(%fs).

commit 57a9973bd03f6d002292cad5848253f3e1a90ebb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Mar 12 22:38:42 2016 -0500

    remove invariant-breaking write barriers
    
    concurrent collectors require write barriers. we need to be careful with them
    in uninterruptible code though. almost all of biscuit's runtime pointer writes
    do not reference heap allocated objects, so write barriers can be elided.
    
    go 1.5 works! that was much less painful than i thought it would be.
    
    still need to convert trap wake/sleep. then i will investigate our fancy new
    gc.

commit 28f5e5bec78489d6944748d1fae28b3aa5a54c2c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Mar 12 12:15:04 2016 -0500

    temporarily disable trap sleep/wake
    
    for easier testing. need to write trap sleep/wake for 1.5.

commit 0d4fb800de4704a94b0306fb7e6bb051c06e70b6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 13 10:08:16 2016 -0400

    convert trap sched/wake code
    
    Conflicts:
            src/runtime/proc1.go

commit 93ec45cbb498d55871ebaf82ac1a7147f892e3f4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 13 12:24:28 2016 -0400

    correct hackmode type

commit 6aab455cac150466c54183621f099381a7ead533
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 14 09:15:29 2016 -0400

    go1.6 updates
    
    only small changes: they renamed atomic functions, also use sigaltstack(2) to
    query current signal stack instead of only specifying a new one, and made m0's
    struct statically allocated.
    
    go1.6 now works too!

commit 68eebb2650da54f7f6e582705e72f58bd8537011
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 14 15:51:22 2016 -0400

    include concurrent GC marking in the idle loop

commit 9e2d502d74cec4bdfb9184688f47c19546c1873d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 14 18:31:04 2016 -0400

    whoops; make biscuit under go1.4 compile again

commit 7881d058bf2b714b58106835bb03246a0029bd44
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 16 14:59:25 2016 -0400

    upgrade FS; remove CSP misuse
    
    armed with the knowledge gained in my past two FS rewrites, this one seems to
    be the best by far. i made rename(2) much simpler by serializing renames (like
    linux) and adding a little more work in open+O_CREAT and unlink.
    
    as a bonus, biscuit's mailbench throughput increased by 47%.
    
    deleting the inode daemon and locking code was good for the soul.

commit 840a8935db9480edd0e3f984e0165cf6b50263d0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 16 15:09:37 2016 -0400

    make renametest much faster

commit e837d2c705c9ec355052c0a768fe481729ddb4ff
Merge: 68eebb2650 840a8935db
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 16 15:30:38 2016 -0400

    Merge branch 'master' into g1.6
    
    Conflicts:
            src/runtime/os_linux.c
            src/runtime/os_linux.go

commit 5f89b4886476dc2092c3e73a2079046d24234b13
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 16 15:54:13 2016 -0400

    put gcpercent back

commit 9e4035ebce76b20d8cd504c6d6ad316847ef06a4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 16 16:06:12 2016 -0400

    x

commit 5e688d3bc111e92abec2e1b8023b12b53bdafe22
Merge: 5f89b48864 9e4035ebce
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 16 16:06:26 2016 -0400

    Merge branch 'master' into g1.6

commit ed705e5d5685b44117883ef35a316f2715970817
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 17 11:06:10 2016 -0400

    fix pthread_self(3)
    
    i forgot to make it return the thread id instead of pid after adding pthread
    support, nearly a year ago.

commit d988cc4a4adfc19e7709287310486399dadd6537
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 17 14:38:52 2016 -0400

    even bigger fs

commit 1378634a881d7ca20b558dc8f028e789c685f344
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 17 14:40:36 2016 -0400

    bmgc updates for concurrent GC analysis

commit 2127140d40c07fbfb7b306413974738a6513d301
Merge: 5e688d3bc1 1378634a88
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 17 14:41:27 2016 -0400

    Merge branch 'master' into g1.6

commit 31f65868b0a0613d43a5ed7c343a9c84fca6af22
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 17 18:35:25 2016 -0400

    add a cool banner and go runtime version
    
    to avoid confusion

commit 59edf3b5abf6b6151557b79fedf956bae055cdae
Merge: 2127140d40 31f65868b0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 17 18:36:52 2016 -0400

    Merge branch 'master' into g1.6
    
    Conflicts:
            src/cmd/dist/build.c

commit 7bfde1c2a79c854799b7f9c3ec68c29c4996bbff
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 18 15:50:23 2016 -0400

    fix Cpuprint

commit a4597a0d0c30278be6922739d50c07eaaccf76d4
Merge: 59edf3b5ab 7bfde1c2a7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 18 15:51:04 2016 -0400

    Merge branch 'master' into g1.6

commit 46721a61e7443686a7f72131749e2da1456926ac
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 18 15:54:09 2016 -0400

    x

commit 35bdc6031edbfc77954c3852a47553892ccb47e6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 18 17:16:45 2016 -0400

    bmgc/bmgc2

commit 633cb94cbd172a2559bbdda51ee8f92f3e197d00
Merge: 46721a61e7 35bdc6031e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 18 17:19:56 2016 -0400

    Merge branch 'master' into g1.6

commit 62f1e5275836eb63d299462af3d44f52505ccc47
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 21 09:02:17 2016 -0400

    bmgc x

commit c516f0f7bbdf18d38bfd0cbba936ca8a2b400a01
Merge: 633cb94cbd 62f1e52758
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 21 09:04:35 2016 -0400

    Merge branch 'master' into g1.6

commit 9ab4cd8bce950703f852eaf2b9bda426322b27eb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 22 13:23:29 2016 -0400

    upgrade sys_fake/sys_fake2 to sys_info(2) and sys_prof(2)

commit b5b3193cb2317ed78d45d0bdb016e0b110fb2814
Merge: c516f0f7bb 9ab4cd8bce
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 22 13:28:47 2016 -0400

    Merge branch 'master' into g1.6

commit 95976b6c289e752b1e38f69928598291404c522e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 22 13:30:22 2016 -0400

    update sys_info(2) for go1.6 GC stats

commit 9856a08e908f32c67ccbfd60e23f9f08bb129a05
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 22 15:01:19 2016 -0400

    don't allocate in sdirname()

commit 2275f3af311be4b64383794b49f05b14001bccbb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 22 15:01:53 2016 -0400

    don't include profile dump in GC statistics

commit 59eec14d6b2950ea29d4d8de8511e33c6afcd8e5
Merge: 95976b6c28 2275f3af31
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 22 15:03:48 2016 -0400

    Merge branch 'master' into g1.6

commit 8b3aaef6b4b30764602131ed241f1851629d61a8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 25 12:06:26 2016 -0400

    x

commit ac4fd1e2efdb09a975fc88026b68508cafbb2f76
Merge: 59eec14d6b 8b3aaef6b4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 25 12:07:04 2016 -0400

    Merge branch 'master' into g1.6

commit 25fbb28fd9756a46f0493be877f7fe664ef92007
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 25 12:02:56 2016 -0400

    allocate pmap and user pages manually via reference counting

commit 74b9cf7ec29e97b74361f0548bffa4e454925023
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 28 09:35:49 2016 -0400

    x

commit e666b5217681eeb9544b7c558f51abf5b767933b
Merge: ac4fd1e2ef 74b9cf7ec2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 28 09:36:10 2016 -0400

    Merge branch 'master' into g1.6

commit 5d73957d24a2eb170242fa2b0ef4ca915e1cd1d7
Merge: e666b52176 25fbb28fd9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 28 13:52:03 2016 -0400

    Merge branch 'refpgs' into g1.6refpgs

commit 3fa98a5b08b129dca2ffab8aef784ba9f3d18638
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 28 16:10:17 2016 -0400

    "webserver" benchmark

commit d0fee2810a31128b91596422189f34c9cbb21f33
Merge: e666b52176 3fa98a5b08
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 28 16:11:03 2016 -0400

    Merge branch 'master' into g1.6

commit 98cd7b55c081eece09900c679d6ddd81e962d56e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 30 10:37:50 2016 -0400

    fix fs name checking; kill some bugs

commit 7ad53a5a398b524cc700defa153a4b117ca2d3d1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 30 10:39:30 2016 -0400

    remove csp from listening unix stream sockets
    
    nearly doubles webserver benchmark throughput

commit 1e639341ec2bc04ee845665715b68be4b2a79c42
Merge: d0fee2810a 7ad53a5a39
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 30 10:42:42 2016 -0400

    Merge branch 'master' into g1.6

commit 44287673b2d2fbfdbcbf2d9bb0fb47120bcbbc60
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 30 17:44:40 2016 -0400

    after taking NMI due to PMU, re-enable all counters
    
    not just the one that overflowed

commit 41355d0a8fd80a3952c539856fb4edb479685408
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 30 17:45:47 2016 -0400

    allow more than 10 commandline args

commit bbe8bd23a43e0be0dfc593a7e262e4c708e271b5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 30 17:47:41 2016 -0400

    extend time(3) to use our three profilers
    
    golang kernel profiling, PMU sampling, and PMC counting

commit b3c876b13ae0a95fbed94f6e7825699798d07016
Merge: 1e639341ec bbe8bd23a4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 30 17:49:23 2016 -0400

    Merge branch 'master' into g1.6

commit 6f14a295a3f442f64d075908026cbf32fb20fd92
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 31 10:54:45 2016 -0400

    x

commit 3c34e86ce52375a6a6bc347ac0e0681b7995a6ae
Merge: b3c876b13a 6f14a295a3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 31 10:54:57 2016 -0400

    Merge branch 'master' into g1.6

commit 7ee92ab6e79a7895d0764f92850f558e9f9a6965
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 1 11:54:47 2016 -0400

    time(3) gcstats: display total GCs

commit e06f912f02488b3993b4238d6c6c6b25fccde278
Merge: 3c34e86ce5 7ee92ab6e7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 1 11:55:10 2016 -0400

    Merge branch 'master' into g1.6

commit 6d5b383ca4bcb87c3338370e2b434a445a4cd67c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 1 11:54:47 2016 -0400

    more gc stats in time(3)

commit c12b1e36fcc40adeccd77dfbc7c0c76e87dedb4d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 1 15:07:46 2016 -0400

    use largest E820 segment
    
    gives me 17GB of physical memory instead of 1.3GB on my test hardware

commit 5a1fe5d1473bef03c1b3226954b564eef52653fc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 1 15:10:16 2016 -0400

    remove some pointless allocations/defers

commit 83a5f9151776641b018115e6b0da3a2906e28b07
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 1 15:13:37 2016 -0400

    even bigger fs
    
    need lots of inodes to make huge heaps of vnodes for gc experiments.
    
    640MB. such capacity!

commit 23d0c6b74a1bef2af5740c929ededed72d84ba40
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 1 15:22:19 2016 -0400

    x

commit 470361b6983f0afc73a089857c9b1fedef3a8d2e
Merge: e06f912f02 23d0c6b74a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 1 15:24:46 2016 -0400

    Merge branch 'master' into g1.6
    
    Conflicts:
            biscuit/syscall.go
            biscuit/user/c/time.c

commit f5a7edfd6286cb0b595b1c17aaae7b443942466e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 1 15:37:48 2016 -0400

    x

commit 5c449bd30bc59abd744d968212ed99fec792681b
Merge: 470361b698 f5a7edfd62
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 1 15:37:52 2016 -0400

    Merge branch 'master' into g1.6

commit 270ff99522fe4bdc5f45fc48fa2bb6809a79893e
Merge: 5d73957d24 5c449bd30b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 1 16:22:27 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs
    
    Conflicts:
            biscuit/main.go
            src/runtime/os_linux.go

commit ef6231cba723bd50bb806afb832f2d379d2b7b1b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 2 12:34:18 2016 -0400

    duration switch to mailbench
    
    useful for long-running gc experiments

commit f1e88f55dc24e55a3c9ee9be5dd51c724f98bf1d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 2 12:35:58 2016 -0400

    dir stuff
    
    opendir(3), fdopendir(3), rewinddir(3), closedir(3), readdir(3), readdir_r(3)

commit 6b1a11ce73a7e51c74f014259a9e645a51a635f7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 2 12:37:24 2016 -0400

    de-stupify ls(3) and use fancy new dir stuff
    
    don't recursively list entire fs by default so an accidental 'ls' after running
    mailbench doesn't force me to reboot.

commit 675f9cca1980fa3a0153b4fa123c22d4cb8a6296
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 2 16:40:23 2016 -0400

    rmtree(3)
    
    helpful for undoing mailbench, for benchmarking

commit b7641131aa159d1322ea963735f1bbabd294f8be
Merge: 5c449bd30b 675f9cca19
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 2 16:46:40 2016 -0400

    Merge branch 'master' into g1.6

commit 889130ecfc473a00604c0f7fff95c0793a861da0
Merge: 270ff99522 b7641131aa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 2 16:46:55 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit 6933f60199015c0ef878c9f6f70ba0514132d43c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 3 09:24:24 2016 -0400

    VM bugfix: remove pages from tracker after TLB shootdown, not before

commit 2ceb651b37162efe89d2cc7887dde67963bed69c
Merge: b7641131aa 6933f60199
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 3 09:56:03 2016 -0400

    Merge branch 'master' into g1.6

commit df1953bf04b69010c46e1b5390eb0f7bb798623b
Merge: 889130ecfc 2ceb651b37
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 3 09:59:20 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit 4c52340934ec8aa3f19d4af70080e24d1123c5da
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 3 10:12:32 2016 -0400

    fix page leaks in munmap(2) and on inode unlinking

commit ff8941313cfb62375356087224f86228317546ea
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 3 16:46:27 2016 -0400

    make FS freeblock allocation less dumb
    
    search from last found free bit in freeblock bitmap instead of from beginning
    of bitmap. necessary to prevent mailbench throughput from degrading on large
    FSes.

commit a9f875d93e52ad231571a7cab0aa5784a52cfddc
Merge: 2ceb651b37 ff8941313c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 3 16:49:08 2016 -0400

    Merge branch 'master' into g1.6

commit 3d7bc0027e77e04cb809f8b85a7c70b9644444e6
Merge: 4c52340934 a9f875d93e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 3 16:51:11 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit a2bc25f02b4011757bac8d1bdafc9f9efb307912
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 4 10:14:32 2016 -0400

    x

commit 75cffc02b0a13b4e9410d0cfa07786943563b05d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 9 11:14:11 2016 -0400

    support WNOHANG in wait4

commit 6443bfce0da86059d56b1cb40f2936606ddb8af0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 9 11:15:36 2016 -0400

    these are not errors

commit e5b85b54263d1b12959ccf9a9cb04a698ccd9607
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 9 11:20:56 2016 -0400

    hack to size kernel heap for experiments

commit 23a941e1c1003e875ed74dd1b650d55bf7ba8672
Merge: a9f875d93e e5b85b5426
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 9 11:23:31 2016 -0400

    Merge branch 'master' into g1.6

commit 05a1ae9d23ba6598729ca2526ff2721be9b51883
Merge: a2bc25f02b 23a941e1c1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 9 11:24:16 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit 6b499932b4c6c7a02ff51806181c00fe56b7da00
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 9 15:32:29 2016 -0400

    1.6 fixes

commit e1d7c27f14f93f157ada689f93dcae06a7e24aa0
Merge: 05a1ae9d23 6b499932b4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 9 15:33:17 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit b1f794b4e9b083b56b892718a8e1412fabeec586
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 16 13:54:35 2016 -0400

    PMU profile parsing script

commit f5e1820aea47813bf46e89ffc389b69b36ab7ef5
Merge: 6b499932b4 b1f794b4e9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 16 13:56:59 2016 -0400

    Merge branch 'master' into g1.6

commit b044932c21ec3e089a9ad9aa448ad59fc379e7c0
Merge: e1d7c27f14 f5e1820aea
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 16 13:57:12 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit 70b551cdfa3e12285dfc4404b24e87250271bec9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 17 13:31:16 2016 -0400

    avoid wrmsr in syscall return fast path

commit c21321b93ca32f94a581d5bc2c17a4c29bf502bf
Merge: f5e1820aea 70b551cdfa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 17 13:33:25 2016 -0400

    Merge branch 'master' into g1.6

commit a37151c9efc0f565091159d06721234dec16255b
Merge: b044932c21 c21321b93c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 17 13:34:29 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit 2904e67b8aa0d4e62d97b7997bc5ae8229deb969
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 18 14:04:57 2016 -0400

    branch instructions retired event to time(3)

commit 9da18e53e0e26cc04b00df13fdf95e470a445991
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 18 14:05:13 2016 -0400

    fancier PMU profile dumper

commit afaed0d78e3be4007eb52632ceed3576295ec47a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 18 14:06:25 2016 -0400

    don't yield Ps before returning to userspace
    
    has considerable overhead and seems like a waste of time since the user process
    can, at worst, keep the P "busy" for one scheduling quantum.

commit 22bce7dc3a3dc95087c38c9a503f386fe3f7e2de
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 18 14:09:07 2016 -0400

    poll(2) - optimizations
    
    avoid taking fd table lock many times and write 8 bytes at once

commit eeb406ef3ac59cc0e8af29fb393b0ffb60df2cae
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 18 14:12:04 2016 -0400

    cache userbuf_ts allocated in read(2) and write(2)
    
    for cases where there are few execution paths, allocation via a pool is easy
    and can reduce the allocation rate.

commit 8c004279e49447bd3c84a22d701cfc095e9b263b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 18 14:15:30 2016 -0400

    x

commit 9891544c69fd06881d11afcee6826af09093c1ff
Merge: c21321b93c 8c004279e4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 18 14:20:32 2016 -0400

    Merge branch 'master' into g1.6
    
    Conflicts:
            src/runtime/os_linux.go

commit c34f2c381382bffe2a34f8359608be1ae494bd3c
Merge: a37151c9ef 9891544c69
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 18 14:22:24 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit cc8de5ff0762b68b67b1382a1420adc5317593c7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 19 14:17:54 2016 -0400

    fix fdops_i.mmapi() args

commit 98ef6e0a6d237e65b48b6856dd38686db1ae7f71
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 19 14:19:19 2016 -0400

    fix vmregion merging bug
    
    i'll remove it soon anyway

commit 982dd8ae7ec09cf68a2b49c1e4f8fbfa38ce256f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 19 19:19:48 2016 -0400

    ping/pong microbm for redis eval

commit e6305e34251d6b647ecf90efa038fa2cdec27756
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 19 19:40:27 2016 -0400

    use per-cpu GS to track sysenter stack
    
    that way we avoid using IA32_SYSENTER_ESP which requires wrmsr.
    
    significantly reduces syscall overhead.

commit d3b976c14798556f5973821b59899b39dcb0a1a8
Merge: 9891544c69 e6305e3425
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 19 19:46:47 2016 -0400

    Merge branch 'master' into g1.6
    
    Conflicts:
            src/runtime/asm_amd64.s
            src/runtime/os_linux.go

commit 21005eb3c27132902387f94dcf234d5706657abb
Merge: c34f2c3813 d3b976c147
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 19 19:50:03 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit 40ccf54d8968340dc16bbe5995dae35ff2b84358
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 22 22:50:07 2016 -0400

    mmap and poll microbenchmarks in sfork

commit 92728cc8adf35cc5aa66279ed69c672ab536dbe1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 22 22:50:51 2016 -0400

    PMU profile parser updates

commit fd2230b6ab37ffac150a1bccf69cb45f46f62bde
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 22 22:52:09 2016 -0400

    fastpath for poll(2) on listening UNIX stream socket

commit eaf0d4d7f6b936f18e2e3b28b081d9e24a53eff2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 22 22:53:27 2016 -0400

    remove silliness

commit 4354980481920ac314e3e3260cd4cce0665df681
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 22 23:17:02 2016 -0400

    reduce system call overhead
    
    avoid all {rd,wr}msrs during syscalls. there are several necesary steps to
    achieve this:
    
    1) rewrite the kernel binary to use %gs instead of %fs (which is defined as the
    TLS indirect pointer in the amd64 ELF TLS ABI), that way we don't need to
    context switch %fs on every syscall. i tried modifying the go runtime/compiler
    to simply use %gs, but the runtime still panic'ed and the build system requires
    running go binaries natively on the host platform. thus i was unable to build
    my modified runtime fully. instead, i wrote a small script to rewrite my kernel
    binary to use %gs while the runtime build system is left unchanged.
    
    2) since the kernel now uses %gs for TLS, store the per-CPU indirect pointer in
    IA32_KERNEL_GS_BASE MSR. now we simply use swapgs to load the per-CPU indirect
    pointer.
    
    3) expand trap frame to save/restore %gs since it is per thread now. context
    switches never save/restore %fs now; %fs is explicitly loaded in Userrun(). in
    order to avoid a rdmsr to detect whether %fs is correct, we shadow the %fs
    register in a per-CPU variable. thus checking %fs is a memory load instead of
    rdmsr.

commit da19be2a966e52d34427588c1bff9ffbb72f3773
Merge: 21005eb3c2 4354980481
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 22 23:47:31 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit 3b0208af22172fcb286ddb312106b665c90b6068
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 24 09:19:40 2016 -0400

    don't need pmap shadow pointers for refpgs

commit e20a5820afb587ccf2993486aa302bd2907386f9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 24 09:20:16 2016 -0400

    whoops! forgot the rewriting script itself

commit e35dc82f504a4d9ee44bc3f0bb31c0d43bb9e5c2
Merge: 3b0208af22 e20a5820af
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 24 09:20:45 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit 596924ffdba417c898c0ff83369772fef0ed8586
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 26 11:34:52 2016 -0400

    refpgs doesn't need to keep track of user page pointers
    
    significantly reduces allocation for fork intensive workloads

commit 28e260d131a8b3e12934c04743abd5a4ee38b685
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 26 11:36:11 2016 -0400

    cache free'd slices used for accumulating PTEs to free
    
    reduces allocation rates

commit 002ce084b0bacf92d0ab5dc8043191969042d7d3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 27 22:15:47 2016 -0400

    gc cpu time counting and alloc benchmark hacks

commit 7ffd55248c85c4ecce8925c2c2a07fca6f02e60f
Merge: 28e260d131 002ce084b0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 27 22:16:25 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit c871f7aebcf628c5df3c5d3ff63d7da5b3e504d6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 27 22:20:32 2016 -0400

    make sure time(3) exits with status of child
    
    so we can detect if child failed

commit eb809ede75f4faac996545448756a952ca7c3210
Merge: 7ffd55248c c871f7aebc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 27 22:21:24 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit 4b51575f6ba81a30ae0d3954822d2e0348331d75
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 27 23:07:20 2016 -0400

    a momentous commit: add /dev/null!
    
    this will be useful for me.

commit 24adb9e8405b3385ce87ddc3eafdceedf4664dc2
Merge: eb809ede75 4b51575f6b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 27 23:09:27 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit dbb5920ebe4396ec68d4a35ed44099b7e9e0fae3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 28 07:44:45 2016 -0400

    script to show kernel calls

commit 8176d6d2ab4b9663226ccb6fd7cb2b5e0b8522ed
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 28 07:46:02 2016 -0400

    nifty program to automatically build the magic graph
    
    given a certain allocation rate and a GC CPU time goal, binary searchs for
    necessary heap size to keep the fraction of GC CPU time under the goal.
    
    this will save me a lot of time since some experiments can take >30 mins to
    run.

commit 2643b50315b6ea701827a47a0e2ae992fd74d9c3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 28 07:50:22 2016 -0400

    kernel objs to sys_info(2)

commit f08d92f10a88ff0466a16185885a6b01ce934f49
Merge: 24adb9e840 2643b50315
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 28 07:50:51 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit f36d34541d5712b2d74a3e4be81356c130cce98b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 30 09:06:38 2016 -0400

    make halp converge faster and more configurable

commit cc8f8476f2a8b05b19758812daff3b671c28bdda
Merge: f08d92f10a f36d34541d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 30 09:07:45 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit a46b47bbc3010f06590a14247128f26ea4597107
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 30 10:15:24 2016 -0400

    make pollers_t space proportional to # of polling threads
    
    much less dumb

commit b8a72cf5d40c8d1b86b90c88a39ee602c1194428
Merge: cc8f8476f2 a46b47bbc3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Apr 30 10:16:37 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit 57edc68256730d6bfbf119a6d14c39d8a6740ad7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun May 1 18:49:37 2016 -0400

    cache circular buffers for pipe_t

commit 47c5777d69fab01ae40dcfdc1b8f44a25444f01a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun May 1 18:50:48 2016 -0400

    allocate userbufs from pool for socket operations

commit a8453e467d3a4c425df01d04b219c6f7f46120dc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun May 1 18:53:51 2016 -0400

    bugfix

commit 0024949ce196d87cf55784a7ec8818ed98c7bbda
Merge: b8a72cf5d4 a8453e467d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun May 1 18:54:58 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit e6e6629cf0991d9dc43d1f5c533a7bbc13a960d7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 2 08:37:03 2016 -0400

    dur

commit 4bf711c8506e01ffd25479a385351598e8cfea60
Merge: 0024949ce1 e6e6629cf0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 2 08:37:13 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit fcb8cbf884c45c06999ae0f9e6e1502a6098f0ad
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 4 12:28:57 2016 -0400

    make halp converge even faster

commit 55c6dbdc38816d47b67e435992ccf6966e8e6caf
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 4 12:30:52 2016 -0400

    hacks to make sure bmgc's live data is spread among heap

commit ee8f2031f082a8d48da0ac9d2e15044c5e893dae
Merge: 4bf711c850 55c6dbdc38
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 4 13:07:05 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit 8279aa7841ce4d8c3f5600dc04a410200c9c0336
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 5 16:56:20 2016 -0400

    faster halp

commit 7c0621b9b6f88fdc2088b5993bd472a336f0d506
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 5 16:56:36 2016 -0400

    better munch

commit c0e756b7be0debcfdbbb41d5a59736905a976c0b
Merge: ee8f2031f0 7c0621b9b6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 5 16:57:07 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit 33b12633b799ca33f27f7e01ec58a0ecb3d63f01
Merge: 7c0621b9b6 57e459e02b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 5 16:59:22 2016 -0400

    Merge tag 'go1.6.2' into g1.6

commit 6ffa38130725167a905ec9e94078ac1b3d31e79d
Merge: c0e756b7be 33b12633b7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 5 16:59:41 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit cc468922f655cdad22990fbbaf5fa685491ff5c0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 5 23:42:11 2016 -0400

    expose dTLB event in time(3) PMU profiling

commit 1de551172dc82bdedba140de8143ac12c2b5f1aa
Merge: 6ffa381307 cc468922f6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 5 23:43:36 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit a96d19335f1c7d45fd6bf8a1ab4a76fce1175f97
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 9 20:43:39 2016 -0400

    use LBR to precisely detect branch mispredicts

commit c50ee39286fa603a3cfae882d09116ae931fc796
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 9 20:44:16 2016 -0400

    wrap long serial console lines

commit e9ca64775997f65cbff166988fdfdcb38df3d51e
Merge: 1de551172d c50ee39286
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 9 20:45:30 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit 377a0502bd3e6108817f074c649d467ac406e1da
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 10 12:24:16 2016 -0400

    iTLB miss event to time(3)

commit 67866ad78f20a71dd344ee201da8ecc24fb9af78
Merge: e9ca647759 377a0502bd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 10 12:24:50 2016 -0400

    Merge branch 'g1.6' into g1.6refpgs

commit cc26376ca4116c50a83d56cc2f2ac4e13f67b4f5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 19 17:39:03 2016 -0400

    fix ABA race in physical page allocator
    
    thats what i get for trying to be fancy

commit 1a0bc218e3c7bae5a49f57de515873d422efb6d7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 17 10:28:32 2016 -0400

    small disk again, for fast build times

commit 35903bfd364793f083136c21060ba738bd5607a7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 19 20:49:32 2016 -0400

    fancy new VM subsystem
    
    lazy page loading support for anonymous and file mappings. track mappings via
    merging red-black tree. the page fault handler now needs to know whether the
    fault is caused by a write or read. thus we pass the fault error code to the
    page fault handler (this is the first time i've had any use for a fault's error
    code).
    
    as expected, gives us a significant performance improvement on mailbench and
    the other benchmarks that fork. with only a 2x heap factor, mailbench is now
    within 9% of linux performance.
    
    i'm sure there is some low-hanging performance optimization fruit, too.

commit 581f907844f0b713d37ca61b67fbe47ac8b4e418
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 17 10:27:50 2016 -0400

    remove pmtracker_t; no longer needed
    
    prepare for fancy new VM subsystem

commit 8639eae51499bbac235e7f39f8a6bd4966dbd9fc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 23 20:52:12 2016 -0400

    better unused address lookup

commit 6d4985df1d105c34aea3bacd70f06c7bcae4b354
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jun 6 23:25:53 2016 -0400

    typo in time(1)

commit eebdc9f18d967944e8f9a7841020f5e71c8c6852
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jun 10 23:40:41 2016 -0400

    fix pmap freeing
    
    increase page map reference count when they are loaded/unloaded on each CPU
    too, that way we can safely free them.
    
    it's a real shame that allocating the page maps via the GC is prohibitively
    expensive for fork-intensive benchmarks; it was really convenient.

commit 0f2f9cba43482fe3cb1f115da80d22a81cba0006
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jun 10 23:54:55 2016 -0400

    TLB shootdown bugfix
    
    thread_t.pmap is always the kernel pmap and has been for a while now.

commit 6373fb5500f855a4e73c6909cedc7caf099cdf96
Merge: 6d4985df1d 0f2f9cba43
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Jun 11 00:01:02 2016 -0400

    Merge branch 'pmapfree' into g1.6refpgs
    
    Conflicts:
            biscuit/syscall.go

commit b9b33f8332a67ffd39872809f66394318bafd17c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Jun 11 18:43:36 2016 -0400

    remove some old crap

commit 44e26510701c3d0915f507ca260017540a9cf6a4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Jun 18 19:39:30 2016 -0400

    bugfix: don't panic if two threads simultaneously read fault
    
    also, vmregion_t.{lookup,contain} are identical so call only one and remove the
    other.

commit 7e7b3b9e67b2544764daa26ed3042a014ed8b808
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Jun 18 20:42:32 2016 -0400

    bugfix: fault-in user pages when reading too
    
    biscuit already explicitly faults-in copy-on-write pages before writing to
    them, but didn't fault-in user pages from which it would read. faulting read
    pages is now necessary (due to lazy page loading) since the user program may
    never directly access these pages which are later used as a syscall argument.
    
    also, i moved proc_t.cowfault() into proc_t.userdmap() for simplicity and added
    a test to verify read-page-faulting.

commit 2dceafbbce01f88e98e5e6d3f397cf4bc2c2df18
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Aug 5 19:58:25 2016 -0400

    bugfix: correct file offset when middle of mapped file is unmapped
    
    and cleanup

commit f204c0f9c03f813507fdf8e84ff6d2a7bf4864c4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Aug 24 18:36:22 2016 -0400

    enumerate the remaining 252 possible PCI buses, not only first 3
    
    i was confused why i couldn't find my NIC!

commit cf90e821718fad80e9d3b3d43d5b30761a4882b2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Aug 27 03:29:08 2016 -0400

    dmaplen() for direct mapping more than a page
    
    should probably replace uses of dmap/dmap8 with dmaplen

commit 2aa747c9d9958a1de6fd5a4ff3013c74f25b13fa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Aug 27 03:31:12 2016 -0400

    lookup number of CPUs via ACPI instead of MP Conf
    
    i also need ACPI to locate the IO APIC. i want to use the IO APIC instead of
    8259s so i can route IRQs to CPUs.

commit 5250fc71c0d6cdee70a41a9da2968987709d272b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Aug 27 03:42:44 2016 -0400

    checksum MADT too

commit 0dd6398408ce9631b6ebf53beead93b3f98d3754
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Aug 30 14:01:36 2016 -0400

    put all IO APIC interrupt vectors in IDT

commit c4eaea40aa0fe5a50728a0a8a260efd68e1a96dc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 6 10:50:49 2016 -0400

    export spinlocks from runtime

commit 1762b976a717768353ca0fa1741ea40e6008fca8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 6 10:51:33 2016 -0400

    use IOAPIC instead of 8259s
    
    no real functional change. mostly documentation about x86 interrupts.

commit d8a4be6ab399396c8a6ea9ec9fc8d634b9d6b115
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 6 14:45:25 2016 -0400

    support PCI memory bars, cleanup

commit 47e0a8c628f3cfa8f4bf8e39fbc65d6a417b1784
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Sep 7 12:05:40 2016 -0400

    make sure ACPI doesn't claim that MSI is broken
    
    preparing for fancy NIC

commit 69b23a97a3e902df157f300757121c3832e52319
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Sep 7 15:07:34 2016 -0400

    x

commit 8bf02d6a9330b517c72e392d090c0190b1595afb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Sep 8 14:31:43 2016 -0400

    missed makefile dep

commit 876da9e993cd8ac8ae839ee4e55fed888219c115
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Sep 8 14:46:14 2016 -0400

    bootloader: load kernel via int 13h instead of PIO
    
    this change makes it easier to boot biscuit on other PCs that have different
    disk controllers. it also allows biscuit to use an AHCI disk driver since the
    disk controller is no longer required to be in IDE mode.
    
    the change is complicated by the fact that the biscuit kernel is > 3MB, but int
    13h is a real-mode BIOS call and thus can only address 1MB of memory. thus the
    bootloader must switch between protected and real modes, reading disk blocks to
    a real-mode buffer and then copying to the actual destination after switching
    to protected mode.

commit 6bd4bbe83eebe7f0f0609c13b2525ab9dcc2ded0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Sep 10 18:32:58 2016 -0400

    new IRQ subsystem
    
    new system is simpler and doesn't create a new goroutine for each IRQ. instead
    a driver creates an IRQ-handling goroutine which calls runtime.IRQsched(irqn)
    where irqn is the IRQ number that, when received, will wake the goroutine.

commit 61b6888a836651f8674afb7077742cb5dca776f6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 13 09:15:45 2016 -0400

    dmaplen32()
    
    good for memory mapped i/o; often only 32bit accesses are defined

commit 60e2130ad03c078b3165b31297346c2754ef8ff8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 13 09:21:22 2016 -0400

    x

commit 682404b7fb59f9cbe186b27bb4b284594d58d80b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Sep 13 12:14:32 2016 -0400

    Store32() to guarantee 32bit writes without lock prefix
    
    all of the storing functions in go's atomic package use xchg, but asserting
    lock while storing to memory mapped registers seems like a bad idea.

commit 8b11fc531a51f0804139cf837728adea78d27640
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Sep 14 11:17:24 2016 -0400

    return memory bar length too

commit 211db1ef73659ddec408e9aac0c56db8e82238c7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Sep 19 11:28:02 2016 -0400

    checkpoint baby ixgbe driver
    
    general initialization and MSI testing. MSI is amazing compared to PCI
    interrupts!

commit 656e6fbdcfa7771ed19e0bead018c951288e4eae
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Sep 21 17:01:28 2016 -0400

    checkpoint ixgbe tx init

commit ed14b161447ade714b7405eae091a829d75f072b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Sep 25 12:49:18 2016 -0400

    first contact!
    
    biscuit sends its first packets on a real network!

commit ed1c0e0e337286434b5d352d6774f308c8b7c5cc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Sep 28 10:41:27 2016 -0400

    fdopen(3), pipe/dev stat(2) support, less(1)
    
    a short break from programming NIC registers

commit 74126b3788b8740fbd89212c7c587cd1bc1cdd28
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Sep 29 12:35:33 2016 -0400

    Rx works!

commit 179165abe911b964e3c6afe259b06abdb922733c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Sep 29 15:55:37 2016 -0400

    axe some old code

commit bf6c34c248876eac5d3cb97d1beeeffb92e6b61b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Sep 29 16:01:44 2016 -0400

    type crap

commit 181dd4903156bc1df3e2a061f41c1ba60f7f4c2c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Sep 30 11:14:27 2016 -0400

    tie up loose end
    
    make sure performance counter interrupt handler doesn't clobber SSE regs

commit 15ab8373f959604fb52502ba7062c8b7ef953694
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Sep 30 12:34:11 2016 -0400

    non-overlapping MSI and IRQ ranges; interrupt cleanup

commit 27ea483c69bbbfecab42df3370e18fd88a11006a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Sep 30 16:16:57 2016 -0400

    setup 256 Rx and 256 Tx queues and MSI interrupts

commit be6e29ededdc2ffb612489bf6c29e75ca57bea02
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Oct 1 15:48:05 2016 -0400

    start ixgbe interrupt handler
    
    configure interrupt throttling too

commit 9eb7d949ed99557b2f2982db4c7343631b294a8c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Oct 4 00:00:25 2016 -0400

    basic ARP resolution
    
    still deciding on interfaces

commit 2c068dfe33ec4f96c14aa2e71314f516b7f65c06
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Oct 4 12:02:59 2016 -0400

    large packets, queue senders when tx buffer is full

commit ec6e7ac71e0e95e1e4218fcfa8a6ebca799f0826
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Oct 4 16:30:30 2016 -0400

    synchronous ARP api

commit 695238907d4702b9924369238f11c14bdafd3002
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Oct 5 10:07:18 2016 -0400

    x

commit 91dddc4c47a288ef69be0dfa797889d08f582fbc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Oct 5 18:09:55 2016 -0400

    RCU routing table
    
    we need a way to guarantee that the Go compiler won't reorder things. so long
    it doesn't reorder calls in the atomic package, we should be OK on x86.

commit a9355f9237a373dc4d5e7737bfdb82738389ab88
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 7 09:23:43 2016 -0400

    allow use of entire E820 page, not just first 15 entries
    
    the code used to put the E820 entries into the MBR, thus the limit. i moved
    them to their own page a long time ago but forgot to increase the limit.
    
    this is necessary for the new biscuit hardware.

commit b695562aaec666c188c043e3191c08b0e04c306c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 7 09:55:45 2016 -0400

    fixes

commit 50c4ccd962514520ddf5791d0905d33a9e5e3246
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 7 12:47:50 2016 -0400

    ipv4 checksum offload

commit 9b82c9fbd29f164cf764f6c64c600ff74b4c48f4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 7 13:41:05 2016 -0400

    scatter/gather TX interface
    
    enables prepending packet headers with less allocation and no copying

commit cd1f3d77cca99f8bb8acffdf1fa5cd5fd717d88c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 7 22:11:18 2016 -0400

    ping local and remote hosts!
    
    finish IP checksum offload and use fancy new routing table

commit dd79bf1210c890e0dcf339e11ada979b3666924e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Oct 8 11:58:15 2016 -0400

    simplify

commit 5a7e0c16f00f12811fd99dffc8e979808ee170f6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Oct 9 13:41:01 2016 -0400

    respond to ICMP pings, cleanup
    
    supporing pings is convenient since ping(1) prints latency statistics.
    currently, biscuit's average latency and std. dev for ping responses to the LAN
    is 37ms+-20ms. how awful!
    
    also, CSP style may not be a no-starter for network code...

commit decc3a0919dbd60c4e2214a9245576be250c50d7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Oct 10 16:35:22 2016 -0400

    remove confusing asm
    
    this instruction is a no op because the immediate is sign-extended to 64-bit,
    resulting in: "andq $-1, %rax". remove it -- it is unnecessary since wrmsr
    writes edx:eax to the MSR.

commit 89055f4ab5183951a965e120390da326da2cbb2d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Oct 10 18:02:37 2016 -0400

    respond to ARP requests
    
    pings worked without ARP request support because OpenBSD snoops to fill its ARP
    table.

commit 16364c238d298791d6e4c4eb39b96bf9c44e9898
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Oct 11 17:25:10 2016 -0400

    bufix: consume all packets, not all but last one
    
    consume packets between [tail, head - 1] instead of [tail, head - 1). otherwise
    a packet may not be processed until another packet arrives.
    
    ping latency is a stable 2.5ms now.

commit 5c66f4c2d245231e9c8c445a87b873ac6aad39b1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Oct 12 11:35:51 2016 -0400

    don't print to serial console in ping critical path
    
    since my serial console driver waits for UART readiness via polling instead of
    using interrupts, printing 80 characters at 115200 baud takes 5ms. biscuit's
    ICMP average ping latency is now 250us, which is slightly less than an OpenBSD
    machine connected to the same 1Gb switch.

commit 47d2609358cd37221e6c1cb8571f3fdb64ca2cf7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Oct 13 16:29:24 2016 -0400

    x

commit c941921c0b709304ef5623d63252dc3ae1096c9a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Oct 17 09:59:38 2016 -0400

    ensure route entries are unique
    
    by including netmask in lookup key

commit 75250bbde0a5857407a2920777ed4a855897a9be
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Oct 18 19:00:35 2016 -0400

    bugfix: make sure file mmaps that span pages work

commit ad08c67802ca9e749c7bcd6c8dcb060d5c6cf66b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Oct 19 22:07:49 2016 -0400

    baby TCP stack
    
    receives packets after active-connect. nothing more.

commit dab204f44b5e8af8633971e6082e613dacfbbe9f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Oct 20 15:01:04 2016 -0400

    TCP state coalescing, window pruning, and annoying window stuff

commit ba899aa493ca7f6e34dedf5f1e57063f41984f61
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Oct 21 20:19:58 2016 -0400

    buffer data until acked or until user reads, SWS avoidance

commit 09ff2dbed41e6fb8a5da6bb473385a9d29b2196c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Oct 24 22:01:05 2016 -0400

    window management fixes

commit fbe6b40db902934c9f293bfba13889d7aaa4741f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Oct 24 22:04:33 2016 -0400

    do not delay acks when user reads grow window
    
    bulk receive seem to work OK now. the payload cksum is even correct!

commit ed84933866f97c0a7c3d575ea7a36f0b3cc56239
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Oct 25 10:34:52 2016 -0400

    delay ACKs that shrink window to < MSS, don't delay ACKs that grow window > MSS

commit bad70500c93c3993e1edbf0e19695f95ca21484a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Oct 26 16:36:09 2016 -0400

    basic TCP sending

commit d5dcdce0f9fca7cabdbbb751b8285429818615aa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Oct 27 09:43:18 2016 -0400

    biscuit visits Google and www.openbsd.org!

commit aa101251d9dfba971deb31d3dcf0535cc115653a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Oct 31 14:13:13 2016 -0400

    expose TCP connections via fds

commit d988ef63f0a44e557a83e0c75a040c42ca4f4e98
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 1 19:27:54 2016 -0400

    poll(2) support for console

commit c5634ca44e8b3ff40f3b4ea30843b83b9fa9b079
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 1 19:32:44 2016 -0400

    write(2) and poll(2) support for TCP
    
    i'm always surprised at how tricky it is get to get poll right.

commit 5a94d9580d74e231b584c297596882c7bd0967ef
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 1 19:34:50 2016 -0400

    make lnc(1) multiplex stdin and the TCP socket

commit 39ee40d1bb04fd61712c9c97d1eb3908444eaa0d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 2 13:47:00 2016 -0400

    repent of using int for error codes

commit 9dfb211bbf9b00d5475487d8d3557b798362f51d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 2 13:54:53 2016 -0400

    repent of using int for fd flags

commit 6c783e9a6764b841cbf869beef849f51ea1d648d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 2 16:25:38 2016 -0400

    TCP sending large files isn't that awful now

commit 1a800b8c39af843beaf6aca6b01aa318fd4ee46b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Nov 3 14:22:20 2016 -0400

    bugfix: don't assume a vmregion has any mappings
    
    with demand paging, a region may be mapped even though there are no PTEs for
    it. make sure a vmregion is actually mapped before attempting to copy the
    mappings during fork(2).

commit fecdb5de8f70d6f565a212aa606eb4ee555e081c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Nov 3 16:53:39 2016 -0400

    eagerly free user pages on process termination
    
    otherwise a process which tries to allocate much memory may fail, even if there
    is enough memory since a lot of memory may be sitting in the pmap of a
    terminated process which some idle CPU still has loaded. freeing the pmap
    itself is still delayed.
    
    it's harder for biscuit to detect when per-CPU resources are no longer in use
    since, for performance, we do not change pmaps during goroutine context
    switches.

commit 6b927443ed752af65048cc513188a1f3d0306508
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Nov 4 09:24:14 2016 -0400

    further simplify pmap freeing
    
    it later occured to me that, since the kernel pmap pages are shared between all
    pmaps, only the pml4 needs to be freed once it is no longer used by any CPU.

commit 4fdff3775f045cc3deebbbe0a5cf33e17ac413fe
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Nov 4 15:06:06 2016 -0400

    TCP TSO
    
    pretty convenient!

commit 51f750c19a2af9dcdff1eaf5beb21febc8d72366
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 7 12:29:07 2016 -0500

    embed TCB into tcpfops
    
    to make concurrent calls on TCP fd easier to handle

commit b3b41ee4daa3fec19fbe08a77e4c2937690caee1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 7 22:37:19 2016 -0500

    basic closing
    
    now i can reuse ports without waiting for TIME WAIT. how exciting

commit eeccdb1844c11ce608f4174d269d2a9c1caec0b2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 8 23:31:44 2016 -0500

    shutdown(2) and the rest of TCP teardown
    
    seems robust with basic tests; need a better way to test my TCP code...

commit 542018a005e42021a5820a89d7434d12e266dfb7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 9 12:31:33 2016 -0500

    allow acks == snd.una to increase window

commit 2d341bc9771db880c216e5d1d15ea8885ecab2fb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 9 12:32:43 2016 -0500

    poor man's retransmission timeouts
    
    timeout is fixed at 5 seconds

commit c698edb1e9ff0801b59cefe1aa13abe6fc0269a9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 9 16:55:56 2016 -0500

    don't sit in TIMEWAIT for eternity

commit 7ed1bb0fbec00e39f57eea3c065afa6fd080549b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Nov 10 12:26:26 2016 -0500

    benchmark to download the linux kernel
    
    takes 10s of minutes, but at least it works

commit 2c5da3edd870b46d7c384bde00fad1fb59b894d4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Nov 11 15:09:57 2016 -0500

    drop tx packets instead of blocking while in net_start()

commit d0776b75975624e7eef24993bcecfe9174a24ac2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Nov 11 15:11:09 2016 -0500

    TCP bind(2), accept(2), and listen(2)
    
    port reservation is more complicated than i expected since a listening TCP port
    can have more than one established connection at a time. also, bind(2) behaves
    differently for a socket used for active connect than one used for listening,
    but at the time of the bind call it is unknown what the socket will be used
    for.

commit 37f49043ae13ec2b641ee299e24972858aabcefa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 15 10:12:13 2016 -0500

    time(1) prints to stderr

commit a697477ef0eb805f40cb1e8dc68d22701c5e7325
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 15 10:29:52 2016 -0500

    make sure to send ACKs that increase window
    
    not just those that increase window from <1 MSS.
    
    we now download the linux kernel @2MB/s from WAN and @5MB/s from LAN. better,
    but still much slower than OpenBSD (35MB/s) from WAN.

commit 07034f6895c2dd2993f5ab0d82f3eeacdc1aa662
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 15 10:50:48 2016 -0500

    x

commit 10e8e8bb8c29dfd37ea1a5d85ccfbf6e61e8faa3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 15 11:51:44 2016 -0500

    rshd(1) -- remote shell
    
    its a little sad that we can now copy PMU profiles over the network instead of
    dumping them to the serial console in hex.

commit a0c764f41cc4b7da44db55cb52dbead5e52fc61c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 15 14:12:53 2016 -0500

    TCP fstat(2)
    
    so less(1) via rsh doesn't crash

commit 5a19a56a132b4128499f7fe16c4e864254f3e6ec
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 16 10:46:22 2016 -0500

    fix TSO size checks, size lnc(1)'s buffer to MTU

commit 16d4b5c2c5eba2fc86513e7e8ddc2d73a04b9430
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 16 12:05:09 2016 -0500

    finally, send RSTs

commit 661a5a93adab1ffdf98399b79890157799d5f346
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Nov 18 13:13:42 2016 -0500

    stat(2) file permissions

commit a69d43e24d89de67b5d08e99884f42c5649c034b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Nov 18 17:47:06 2016 -0500

    determine nginx dependencies, compile for biscuit
    
    much of these deps are not be needed; for instance, nginx does not use signals
    until shutdown or reload of configuration files.

commit 1d5fde4dbc1b66d594663627093755aec9140ac6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Nov 19 08:38:34 2016 -0500

    for C user space, disable red-zone, enable stack protector

commit 6be5b22380085a05bc85957f0692d19a04d22a20
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Nov 19 09:34:18 2016 -0500

    dur

commit 382978a84401536856f61d3a360893b8d5d87893
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Nov 19 15:06:44 2016 -0500

    support receiving out of order TCP segments

commit 30afc6394f8dc489aefad32d3c4665b857242f21
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Nov 20 13:59:13 2016 -0500

    x

commit 8f04a4984594847c843e142376b8843bee76d06f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Nov 20 14:48:04 2016 -0500

    fix memmove(3) return value
    
    sheesh

commit 13e1a81e1917c75245bf0b5b14b4f513a1ee8299
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 21 09:56:47 2016 -0500

    increaes FD_SETSIZE from 512 to 1024, same as linux/openbsd
    
    none of our benchmarks use select(2); just avoiding future surprises

commit a6759952b17cea6b7f06c75f505069a236f1ccf6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 21 12:56:33 2016 -0500

    in exec(2), correctly handle bss edge cases
    
    when the segment containing bss includes other sections and 1) the bss starts
    on page boundary or 2) the bss is completely contained on a pre-existing page.

commit 0af4eb12f9f25759efae0949f0879e976a42f251
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 21 15:55:32 2016 -0500

    allow changing backlog via subsequent listen(2)

commit 7523fde8e136973bb80513c61fbacc73cdd285b8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 22 00:07:15 2016 -0500

    MAP_SHARED for mmap(2)

commit fbe1ece5f339680213731619dcd91e829f42eac5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 22 11:24:52 2016 -0500

    socketpair(2) for UNIX stream sockets

commit 922fd018b70adbc98b75af694be8735417dba117
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 22 21:34:45 2016 -0500

    use interface for objects which copy to/from user memory
    
    preparing for system calls using iovecs; needed for sendmsg/recvmsg

commit afdc5c854b49bc1c0c0b0056e5f8b82a077e1c27
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 22 23:24:54 2016 -0500

    readv(2)/writev(2)

commit 923ba362678de3ded092e837496528ddd68c12a4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 22 23:29:03 2016 -0500

    checkpoint nginx stubs

commit 5aaa5779b92bb62e05b8321430613d2cd1971d99
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 22 23:43:46 2016 -0500

    whoops

commit 2cf442126ffaae8298b66f5fc48bf090fd857134
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Nov 27 18:06:00 2016 -0500

    lock proc pmap once per iov read/write

commit dd5eba5bddd994ff6ccd10d5a8262877e84adece
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 28 10:57:43 2016 -0500

    fdops: use recvmsg/sendmsg to implement recv/recvfrom/send/sendto

commit bcd6dc01dda258e3cfcda0d4f7f2f0a79c83bf94
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Nov 28 21:55:39 2016 -0500

    fd sending via CMSG/sendmsg/recvmsg
    
    a truly awful interface

commit 93f8ab0dbe7f6f57576a1bbc52713c4809df0c31
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 29 09:46:17 2016 -0500

    fix guard pages

commit c8f59de51cf19cba98ddc123a580f1f643c5536a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 29 10:19:47 2016 -0500

    fix free VM space search

commit c7875064ab4edde4a7b426320f51aa1d836647d4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 29 12:59:05 2016 -0500

    fix unusual calls to memset(3) (0 length) and malloc(3) (humongous size)

commit c9040fa5f688c7ece041c5f8b7af329385d44ea0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 29 14:15:58 2016 -0500

    enforce RLIMIT_NOFILE, set to 1024
    
    nginx eagerly allocates memory for RLIMIT_NOFILE fds. biscuit's RLIMIT_NOFILE
    used to be RLIM_INFINITY (-1), causing nginx to attempt to allocate an obscene
    amount of memory. set RLIMIT_NOFILE to 1024 and enforce it.

commit 17ff8cd514ba1a502f15ebb03a78763f529551a8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 29 14:21:41 2016 -0500

    nginx stub tweaks

commit 6f6fb93688e407d932a881105eb6acc4b28db2a8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 29 15:10:27 2016 -0500

    poll(2) support for listening TCP sockets

commit 869204ac471f3738cbc05838533293f8c3b20d20
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Nov 29 17:47:53 2016 -0500

    forgot to write address family for accepted TCP sockets
    
    nginx works!

commit ab185849948a7de1bd3e1c53726e9b4967822140
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Nov 30 16:36:29 2016 -0500

    x

commit 6338f565c8aee15dae802b39e6337144cf3006fe
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 1 10:40:09 2016 -0500

    fix TLB flushing
    
    broke it in the summer when i added better pmap freeing

commit db45e35b436f2e450d40edfce481d2fa95af0637
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 1 11:25:19 2016 -0500

    support lazy anonymous page allocation, simplify munmap(2)

commit 07a07bc534a6dfbc92739522da7ddd2bf4359071
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 1 16:08:55 2016 -0500

    fix fd leak in rshd(3)

commit 0f480689c01bc303bb459db7f777abb4c91e477c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 1 16:09:40 2016 -0500

    prevent superfluous packets during TCP teardown
    
    sending an extra FIN will cause unnecessary ACKs and RSTs

commit dfcd264c269e2b154c2d230bc3e0c172ded0b49c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Dec 2 11:55:28 2016 -0500

    raw disk block device
    
    dangerous, but useful

commit 22e1bba4a56a162dfa41bb5a129e3dea4d750ead
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Dec 2 12:02:05 2016 -0500

    bimage(3)
    
    use my fancy TCP stack to directly re-image biscuit from biscuit. greatly
    speeds up my iteration cycle!
    
    just execute bimage, then use the usual `make net' target from a machine on the
    PDOS network.

commit e060ed0f26aa0e5cec428bf56899b1cc36b2a9e6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 6 12:49:14 2016 -0500

    int->pid_t

commit 7fe444a75806a64500977f9ed00586529015b215
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 6 16:07:53 2016 -0500

    finally add my benchmark shell scripts

commit 5c4ef833ae9e54d83efaa2eb4f850d8a4d2e72ef
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 6 16:15:48 2016 -0500

    allow listening ports in TIMEWAIT to become new connections
    
    otherwise a node rapidly churning through short-lived TCP connections to a
    single host will quickly run out of ports, even though the local ports aren't
    even in TIMEWAIT.
    
    now nginx on biscuit can process thousands of serial requests quickly.

commit 675fc159570cb65fdd0a54b7d44352f037e4c286
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Dec 7 16:57:19 2016 -0500

    ps(1) hack

commit c2a2dde816e41bf87a39aa293208301166be1456
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Dec 7 17:18:08 2016 -0500

    non-blocking TCP support

commit 5c5c16bf07bf5a9f2b52bcc4a266590baa61fb2e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 8 21:29:24 2016 -0500

    TCP timestamp options
    
    i use it to robustly determine when a port in TIMEWAIT can be reused. it will
    also be useful for RTT estimation.

commit 0e6e99f4125f66f8d6b5e3b525e7473775dc5093
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Dec 10 18:41:43 2016 -0500

    x

commit 272dfb833229c488d08be3ddd6848e22710eeb11
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Dec 13 08:13:59 2016 -0500

    make partition table entry with non-zero partition type
    
    some BIOSes refuse to boot from a disk whose partition table entries are all 0,
    even when the disk has the 0x55aa signature.

commit 5de8ea145ac0d850a0921f9d37944267ef340a27
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Dec 14 08:47:32 2016 -0500

    x

commit 9e33ebe1996fed62a4fb8a98f84f8421d57c3f35
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Dec 14 10:15:21 2016 -0500

    fweb/fcgi latency benchmark

commit e89ca7e2b00ad3df864652b000d3932667b0bda1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 15 15:54:05 2016 -0500

    revert to ancestor of golang/master and go1.6.2

commit 106db54e283f176737d642420b2ff3ce71d84e32
Merge: e89ca7e2b0 7a62274065
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Dec 15 15:56:06 2016 -0500

    Merge commit '7a622740655bb5fcbd160eb96887032314842e6e' into newmaster
    
    Conflicts:
            src/runtime/os1_linux.go
            src/runtime/os_linux.go
            src/runtime/runtime2.go

commit 0ac702e900e2199f6b40d3d7228a29c08d4e730c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Dec 16 11:03:53 2016 -0500

    initialize SSE earlier in boot

commit 79084603337b9b4a4bea0ec201ede6079042ef36
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Dec 16 11:04:59 2016 -0500

    x

commit eaf3fec38b4f39b9e7ee9b48eb7164ee8634c983
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Dec 16 11:05:24 2016 -0500

    manually set ncpu, no-op getRandomData

commit 6d8c62768cab561c48376f9d45aa0b2d0acda4d4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Dec 16 11:05:55 2016 -0500

    fix Userrun()
    
    the fast syscall code is brittle and must know the size of the stack frame. the
    go1.7 compiler apparently changed the size of the stack frame.
    
    the fast syscall code needs an overhaul -- bandaid this for now; i'll fix and
    redo this code later.

commit f1e22ef8310565aab9ae6d542ebade541d997f6d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Dec 16 11:21:56 2016 -0500

    move yield int number from IRQ range to software int range

commit ec960a90d798404cb0a389a7bc60e6f9b5ad2da5
Merge: f1e22ef831 41908a5453
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Dec 16 15:33:11 2016 -0500

    Merge commit '41908a54530120b68a79e0fd22b5e709d33cced0' into newmaster
    
    Conflicts:
            src/runtime/os_linux.go
            src/runtime/sys_linux_amd64.s

commit fa2c4ef4a2941edebd0fc05fff6c1b2071029878
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Dec 16 15:57:05 2016 -0500

    updates for runtime upgrade

commit a4117b2e2a0bc3e092e1c3258ec7d9eb4d11cf68
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Dec 16 16:25:01 2016 -0500

    disable a couple unnecessary write barriers
    
    use the go compiler's nice new feature which asserts that a function neither
    contains nor ever calls a function containing write barriers.
    
    these pointer writes may be executed at any time (interrupt context) and the
    pointers they are modify are either to objects not allocated by the GC or must
    always be reachable (either through runtime.allgs or on the caller's stack). we
    need to disable them, otherwise they may be executed when certain invariants
    don't hold (namely when m.p == nil).

commit 0798105e0e92afadcd41b951e543f6044995fa1b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Dec 16 16:30:16 2016 -0500

    reminder to fix important bug

commit 02ed42593f1eee50ead42a9f6a88d77525e01303
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 18 12:31:21 2016 -0500

    paranoid check for binary rewriter

commit e2b11213618d4b6c72467dc3b6cf7968676fe2e4
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Dec 18 14:59:54 2016 -0500

    fix TSO + TCP timestamp option regression
    
    forgot to account for TCP option length in MSS and NIC's pseudo header, used
    for TSO.
    
    my TCP transmits at ~43MB/s on 1Gbe LAN. not too shabby!

commit fbc8c28e89273228f1d8974564dc7a691896e793
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 16 09:09:44 2017 -0500

    bandaid for locking bug

commit 79a8617b45871bcc73577f511d3340ac306e7e45
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 16 13:52:51 2017 -0500

    reduce "OS" quantum from 10ms to 1ms
    
    now runtime can more accurately preempt mutators from doing too much GC work.

commit 377dce5875cbe6a1cc12dc143a9ec484f3612df3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 20 14:37:27 2017 -0500

    restore NOFILE, for nginx

commit 8b1d227fec948797b287f12bc90a824e23b5f118
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Jan 20 14:37:53 2017 -0500

    remove debugging panic

commit b86cbe55fd2a37246949172c758dce91f2c64fd6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 23 11:07:24 2017 -0500

    x540 driver bugfix
    
    prevent recycling of TSO context descriptors that may still be in-use.

commit 239914f20e20d2db85cfbbdc6d4fa9064766f392
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 23 13:52:31 2017 -0500

    less stupid localtime(3)

commit 51a1efba44e4d91a0b89e931c2a24e34c6dca592
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 24 10:45:02 2017 -0500

    correctly report available physical memory

commit 06302ae668ba6e1c253870a00c71363b0681ecca
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 24 11:12:46 2017 -0500

    reduce allocation rate: reuse TCP send/receive buffers

commit 8e4f7cbeb2d793b05b9fe11a7311aafa1467a16b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 24 11:21:44 2017 -0500

    nits, don't forget perfmask IPI vector

commit f31230e67fcc4e222a1f30d29e31618592e04503
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 24 15:24:56 2017 -0500

    ixgbe optimizations
    
    don't read head/tail registers when enqueuing each packet for tx -- only write
    tail. this optimzation alone gives us 20% on the nginx benchmark. reading a
    hardware register takes 1-2us!
    
    also, only create a context descriptor if the parameters (IPv4/ethernet header
    lengths) have changed.

commit a20fa2f1154f6229decc08514c4a2948a7fad949
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 24 15:31:48 2017 -0500

    raise time in TIMEWAIT from 10 seconds to 1 minute
    
    was 10 seconds for debugging

commit 32eba37adb0d9dd6d9c664d440346ce0fc6b9985
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 30 11:42:00 2017 -0500

    terminate timewait goroutines of reused/killed TCP connections
    
    to reclaim their stacks

commit 0b894535bd1cf072459f6befe9b5e51db8a25b26
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Jan 30 15:02:43 2017 -0500

    avoid reading RDH/RDT too

commit ba6205f0411566e31e695ab202f7d83c0799881a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Jan 31 16:59:18 2017 -0500

    use built-in funcPC to get function address

commit 4b1377d122d8f49e36dd4927bb01b88671bb10c8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 1 19:23:12 2017 -0500

    busy wait for runnable Ms
    
    the old code would occasionally execute the hlt instruction during brief
    periods when there are no runnable threads (like during runtime lock
    contention). the result is that the runtime thread is not awoken until the next
    timer interrupt which doesn't occur until 500 us later, on average.
    
    instead, busy wait for runnable threads with interrupts enabled.

commit 765833c652e38ec1277fed11b7e1eb27ba1bacbb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 2 15:00:43 2017 -0500

    ixgbe rx bugfix
    
    bug that delayed a new packet's processing to the next interrupt if it was the
    only packet to arrive (again).

commit d6c5713ebb9f22d3e36b45fb112cc60fa2e9b973
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 2 17:01:31 2017 -0500

    poll sleeping Ms, too
    
    although i just modified the scheduler to poll for runnable threads, the old
    code wouldn't also check for sleeping threads that should be woken. thus these
    threads would not be awoken until the next timer interrupt (which is, on
    average, 500us away). a runtime thread sometimes sleeps for 100us when
    synchronizing with other runtime threads.
    
    this fixes our nginx and mailbench multicore performance. nginx with 1, 2, and
    4 cores have throughput within 5% of linux!

commit da0322e06aadfabf69841e256af8a3881a4fb354
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 2 17:10:29 2017 -0500

    code to disable one of the hyperthreaded CPUs on each core
    
    this code may "just work" work on all CPUs that support "extended topology" via
    CPUID 0xb, but it is technically PC specific.

commit 4d324ad609b90b418089c4feeb7c09d89f640c77
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 3 12:32:31 2017 -0500

    kill dead code, add paranoia debugging print

commit c808f5ba0203515d0a143e3fd53b07b41ce1e494
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 3 13:58:13 2017 -0500

    nits

commit 57e98f91c075807f05307284a86db4aa20413f3e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 7 09:35:27 2017 -0500

    allow write barriers, cleanup more ancient silly types
    
    these write-barriers are now OK since runtime uses %gs instead of %fs

commit 6844eb36923c95ddab3ba731b1018fba6114e492
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 8 13:25:43 2017 -0500

    cleanup/speedup system calls

commit 4f737b863dcdee98b5a44214dc16d7f0820d03e9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Feb 8 13:42:12 2017 -0500

    x

commit 5c9d22ebd97ae406ef783c56e44e3b33416deb41
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 13 13:26:34 2017 -0500

    sfork rounding bug and lock benchmark

commit c7551fcab5f34b451342236b1d72fc28b135bf3e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 13 17:55:10 2017 -0500

    pad cpu_t to be a multiple of cacheline size
    
    otherwise cache thrashing due to false sharing of tf/fxbuf reads with sysrsp
    writes tanks performance by up 18%.
    
    calling getpid in a loop with 4 CPUs is now perfectly scalable!

commit 7c5a6c91ad805a96c4b0a046521977c1b9267528
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 13 18:13:03 2017 -0500

    notes to remind myself how the FS locking protocol works
    
    may write lock-free dcache later

commit 1d9a67d53cf50dd3ed51b8caaf11b9aacbf16f5d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 14 10:29:06 2017 -0500

    fix ixgbe regression
    
    must create both ipv4 and tcp context descriptors, not one or the other.

commit 55c15d31f7183fc242b85f974b4f8534633a5cb6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 14 10:38:58 2017 -0500

    x540_t -> ixgbe_t
    
    x540_t is the worst type name i have ever come up with

commit ea46b73a16972b5bb170656cec09cd155abdbd8f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 16 11:05:07 2017 -0500

    fix regression of attempted regression fix
    
    yahoo!

commit 85629fb4bd92d26e884668806bc8a262287cff73
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 16 11:54:26 2017 -0500

    x

commit 905f5d62db424699c8bd578c68991e9db1edad89
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 16 16:54:15 2017 -0500

    retransmit lost FINs, tcp tuning
    
    the code used to send two or more FINs under certain conditions. be more
    careful about when sending acks or fins.

commit 72c261d9d7f041928a9c7dda5e9702a7181c1abb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 21 12:51:41 2017 -0500

    implement O_NONBLOCK for listening TCP sockets
    
    i allowed applications (nginx) to set O_NONBLOCK on listening TCP sockets but
    forgot to implement it! this resulted in the final HTTP connections being
    starved in very rare circumstances.

commit 340cd8600aaf815c987f9711eb7fef4b9f334a13
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 23 12:41:48 2017 -0500

    creat(3) wrapper, separate rmdir(2) and unlink(2)
    
    for lmbench

commit 2c213bd4cdfdf4da90cc880b9594e2e55820368d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 23 17:10:07 2017 -0500

    remove threadinfo lock from syscall path

commit 5b26157422cad0f21c3651ab95a4e97334ccb535
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Feb 23 18:30:35 2017 -0500

    support printf(3) format precision

commit aa005eb0cf6306855f257b6b533cc832043562e9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Feb 24 13:55:56 2017 -0500

    x

commit 88b963292d5cb4ce073466232048e4baab593838
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Feb 25 08:28:18 2017 -0500

    properly set circular buffer size
    
    forgot to set buffer size if buffer was expanded. took a while to track down
    since the buggy path was only taken when both the heap was large and TCP
    sockets were concurrently used.

commit 1736c0248301831d992e5ca8267284faab6a008c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Feb 25 17:49:50 2017 -0500

    mkstemp(3) for lmbench

commit 466b21c2f8a148018e003afc53c4265e279a0219
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Feb 25 18:13:18 2017 -0500

    fake dup(2)

commit 42139c4c7eb02cf748e5229ff48c445014ef31a0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Feb 26 10:45:42 2017 -0500

    last of lmbench litc code

commit d74b757091e1c08411dbef95f5bf111dfd06470f
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Feb 26 13:47:15 2017 -0500

    getppid(2)
    
    lmbench uses it in funny ways, like checking whether getppid() == 1 to
    determine whether the parent process has crashed.

commit 5f172858c669bba03467ec086c143b7f0e2c4daa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Feb 26 13:51:51 2017 -0500

    x

commit 3595a774046f172f07537a9310605b8c45bbbfc6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Feb 27 11:04:31 2017 -0500

    restore user SSE regs after servicing interrupts
    
    biscuit has always carefully saved user SSE regs, but until now didn't restore
    them after taking an interrupt. this was never detected until now since my user
    programs rarely use SSE instructions.
    
    i discovered the bug because lmbench calculates benchmark results with SSE
    double precision division and, for one particular benchmark, the compiler put
    fprintf on a new page. thus the benchmark tried to print the benchmark results
    via fprintf which caused a fault, lazily loaded fprintf's instructions, and
    finally clobbered the SSE regs holding the benchmark results. the benchmark
    then proceeded to print that biscuit has 128TB/s of read-file bandwidth.

commit 69b64a4cc4e86978403977376c2be1b0f44319ad
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 28 12:48:48 2017 -0500

    better float printing

commit 80a05d94d248184bca12bda317d114fd8a9c013e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 28 13:28:25 2017 -0500

    whoops

commit 32db35d8d1e61efb6141f09c71e8682f3823204a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 28 13:30:56 2017 -0500

    make it easy to use dlmalloc instead of my crud
    
    thank you, doug lea!

commit 6499bcedeca8d444f3fd267fe2e1de6429dff487
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Feb 28 14:39:02 2017 -0500

    progress in bimage(1)

commit 151c2460eae96d7fcc2a0a90a57ff5c29c6bb1dc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 1 15:26:49 2017 -0500

    x

commit fcb471721538c488842e0b918535c5d5d334c548
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 2 10:37:28 2017 -0500

    sfork(1) stat benchmark

commit 74c6983edbae5e9663c5718a74ca52db5ea5c03d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 2 10:41:09 2017 -0500

    disable runtime.netpolinited

commit 8f42e67bbb7f7b43cde1b9687411b25c7d6445da
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 2 16:46:49 2017 -0500

    x

commit 50924887463e6a687619e7d7344d16bcb1bcccd7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 2 17:56:18 2017 -0500

    make idle GC worker poll for interrupts, too

commit 1202115e54a3d68b545939fada6937325ec287fb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 6 09:09:38 2017 -0500

    forgot to lock tcb

commit eb157275f37a8e078aa652314e56d2b30ab5bda9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 6 13:30:56 2017 -0500

    fd support for mmap(2)
    
    we already had support to mmap files for fast exec(2), so most of the work was
    already done. had to add new error paths since there can now be pagefaults that
    cannot be handled when a mapped file is truncated before its first access
    through the mapping.

commit 3d4d9d6dd87b10b1e78d501e613885b64c916e75
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 6 13:48:22 2017 -0500

    x

commit 80b745b74dc287282eb0695f9d97ab3ae9f7a80a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 6 15:46:01 2017 -0500

    x

commit 90dca076b63524e751a64e1838bf696678c26b60
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 6 16:20:27 2017 -0500

    remove unnecessary casts

commit ea5698834f3a49bd5a3d772c11569d91a5419a3b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 6 21:09:56 2017 -0500

    getsockname(2), getpeername(2)

commit 9dc337f1469223247f46555081984b35e5326c44
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 7 09:42:57 2017 -0500

    NIC operations interface, lock-free NIC lookup, cleanup
    
    prepare for loopback interface, which some lmbench TCP benchmarks need.

commit 4038829eba0c1b655e66421b3cc7f8fd2b80ad43
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 7 15:19:56 2017 -0500

    useful debugging code

commit 5248a162298fc5813c6b11c76c56891d5e627225
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 7 15:56:53 2017 -0500

    biscuit gets a loopback device!
    
    welcome, good ol' lo0.
    
    my network stack assumes a NIC that that has TSO, thus the loopback has to
    segmentize TCP buffers larger than an MSS itself.

commit 61911eb08a005aed6820bd37a3dc280edecd8e54
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 8 10:18:39 2017 -0500

    setsockopt(2), SO_SNDBUF/SO_RCVBUF support

commit f599b4bbfc0cd2c7441b2030765068222687d670
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 8 11:30:59 2017 -0500

    x

commit 157661d5410f87bd4b988f2c4d6b408385254b28
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 8 13:14:21 2017 -0500

    limit number of user process VM objects to prevent OOM
    
    a funny situation can occur if a process creates the maximum number of VM
    objects, but isn't able to remember both the starting address of the mapping
    and the length. since unmapping the middle of an existing mapping creates a new
    VM object, i cannot allow the process to partially unmap a regions if the VM
    object limit has been reached.  thus a user program may not be able to easily
    free memory, even if it wants too!

commit 387809462cf01a3f3166434deb1e4e6ca80c864e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 8 15:22:17 2017 -0500

    remove some ancient crap

commit c7cd3594294ac30f8a64db97b4f5a626ac3c9efd
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 8 14:28:02 2017 -0500

    limit system-wide threads and per-process threads/exit statuses to prevent OOM
    
    usertests' forktest can finally fail as it expects

commit f513230c8f7bc678cb764183aa1d686c123faedb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 9 14:33:21 2017 -0500

    free TCP buffers when a connection enters TIMEWAIT

commit 19f71fffb86a9798da76d21c62a9e73093c844a2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 10 13:48:55 2017 -0500

    pg helper

commit 23c7174bad53b6cfe7bcddfac8c9ac0e968bb3a6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 10 13:57:02 2017 -0500

    make circbuf_t use physical page allocator for large buffers
    
    we cannot allocate large buffers in the kernel's heap or we will likely grow
    the heap until OOM due to fragmentation.
    
    such fragmentation is not a problem for the page allocater given that the
    buffer size is a multiple of the page size.

commit 98079cc5737d0c20b90ad18940a5cfb424e9cb5c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 10 14:02:03 2017 -0500

    limit total sockets and TCP buffers to prevent OOM

commit c83991a1fe837ec029f30f5419074b14b3f3d4dc
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 10 17:22:04 2017 -0500

    allow and tolerate failed page allocations
    
    handle failed allocations for all but the fs code. a veritable explosion of
    error paths; what fun!

commit 6a5b8d03f715c9b59eafa89a975450f584481dc1
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 12 13:32:43 2017 -0400

    handle page allocation failures in fs and limit vnodes to prevent OOM
    
    page allocation failures can be painful in the fs since we may need to
    roll-back the state of multiple inodes. for rename, i force any page
    allocations to happen up-front, that way i don't need to deal with rolling back
    a partially completed rename operation.

commit 21be94c2cb01f697bc9c9ff9024571ba35543148
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 12 13:41:07 2017 -0400

    nifty OOM simulator
    
    simulates an allocation failure for each call to the page allocator with a
    distinct call-path.
    
    i run usertests and mailbench over and over with the simulator enabled until
    they have exercised all their calls to the page allocator. the kernel should
    never panic and the fs always should remain in a consistent state.
    
    this method found many bugs.

commit abba53cd413f7d81835f86b2b0b4ea62fac8fbaa
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 12 15:46:42 2017 -0400

    bimage(1), only write full blocks
    
    imaging is quite slow, otherwise

commit f10df9287f582fb6916d837ee63dca914d48661a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 12 16:12:33 2017 -0400

    cleanup

commit 2e973ab52349807fed3e19a2fa1bb1dfec330c58
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Mar 12 18:02:32 2017 -0400

    bloat binaries to be a little larger than linux's

commit 9c271ae37a549ec834eb4d403d270974188f91c2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 13 19:25:36 2017 -0400

    bugfix

commit 695bf231cbdce324d920c9f9097a7408587d8745
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 13 19:27:03 2017 -0400

    struct sockaddr_storage for redis

commit c5841a1533b5e1f23f7b75c69729a3b673e58a5b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 13 19:27:34 2017 -0400

    inline version of getppid

commit 74778350af260706db8048dbd0d1a5d5e7adba43
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Mar 14 19:49:55 2017 -0400

    use timer wheels instead of goroutines for TCP timeouts
    
    brings nginx GC fraction from 13% to 5%, greatly improving throughput and
    latency.

commit db39b6a88ee58023747335a3e29f11c7475b5d4b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 16 16:49:45 2017 -0400

    x

commit d3ac71f4a17299bc4be3bdb6695325919561a9f8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Mar 16 19:39:17 2017 -0400

    make poll(2) simpler and faster
    
    specifically for the case when threads race to poll a single fd

commit 34e00fe2d2b46cdb6b01652da71ab96d5b4eea01
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Mar 20 09:29:51 2017 -0400

    ixgbe per-CPU TX queues
    
    in the old code, the lock on the single queue was the single most contended
    lock during the nginx experiment. per-CPU TX queues increase nginx throughput
    by 13%.

commit 55500ccb98ff52e9ed78871fb6e869afe7ad4a70
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 22 13:44:13 2017 -0400

    simplify TLB shootdown code

commit 0cb186f988c7198dd8a62e693c8a4ab6017071b8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Mar 22 15:09:28 2017 -0400

    slightly less dumb memset(3)/memcmp(3)/memmove(3)

commit ac749560f7ae2207f944097118cbb7c76e34ba6a
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Mar 24 15:21:43 2017 -0400

    better munch

commit 008480d26ffab1c975c84a488a6afadd360a2cb7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sat Mar 25 13:09:09 2017 -0400

    rewrite UNIX domain sockets
    
    faster and less bugs

commit 4902bc93035162b878a40d9ed204e197db231659
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 2 17:56:57 2017 -0400

    use 2MB pages to map kernel text
    
    greatly reduces iTLB misses, giving us the remaining 10% mailbench throughput!
    hooray!

commit 078fa24a6cafde6009a65bcea3f4f7fcb3d2b454
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 2 20:26:46 2017 -0400

    cache inode data blocks to avoid lookups

commit eae80daa0d4f388eb8d07bd31015cb61dc81f896
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 2 20:35:38 2017 -0400

    don't zero pages allocated for new files or that will be filled from disk

commit 4b38c22daa6954ca4a9a1ba82fc2336e2a96f8c8
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 2 21:13:16 2017 -0400

    for mapped files, only lookup the faulted page

commit 81f466d5871f7c43aa3a8ec8827c4f2e5afd6350
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 2 21:59:20 2017 -0400

    don't copy COW pages when they are mapped exactly once

commit 5f6442ad9a696ac4aca65f85a89b1003a4b36bf9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 2 22:35:43 2017 -0400

    cache pmap walks in vminfo_t, remove proc_t.cowfault() and cleanup
    
    doesn't matter much for performance

commit cb3dc7e156d03ab6f7e9c3466d49e2bfcbfb1fa0
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 3 00:29:48 2017 -0400

    don't immediately free pmap pages on process exit; cleanup
    
    under fork/exec heavy workload, its silly to carefully free each pmap page only
    to immediately reallocate/zero them to become new pmap pages again.

commit b72cef810e4c5569b21b21fcbe9f13fd7ff0ac36
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 3 00:47:28 2017 -0400

    eagerly map two pages of stack instead of one
    
    avoids a few mailbench page faults

commit 259a6c0049ed99328ce206f78864569a52dd2b29
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 3 01:30:10 2017 -0400

    "unsafe" readn/writen
    
    improves mailbench throughput by 3%!

commit 1aced677ba81080d685df58e0c8a993c87cc23be
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 3 20:18:58 2017 -0400

    limit total number of futexes created to prevent OOM
    
    i take it back, the futex code is probably the last vestige of CSP style still
    in biscuit.

commit 63fea1b1a8b31df8e8e50608eba6ec4b3309ee80
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 3 21:21:20 2017 -0400

    limit number of arp table entries/waiters to prevent OOM

commit 04a8694b64c1720a4f8daf58678449d4a3064921
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 4 11:43:48 2017 -0400

    limit route table entries to prevent OOM

commit f877eb114e177d7bb792bdc62032ccb6457018d7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 4 13:45:19 2017 -0400

    limit maximum number of segments remembered by a TCP socket to prevent OOM
    
    a program which calls many write(2)s with a small amount of data can reach the
    TX limit. when this occurs, we collapse all outstanding segments to the same
    timestamp; thus we will transmit more than strictly necessary if the segments
    aren't ACK'ed soon.
    
    the RX limit can be reached if a connection receives many non-contiguous
    segments out of order. in this case, we forget that we received the farthest
    segments in the stream.

commit af25a638e80ba8066ac88fd68d9eff2d3c940f41
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 4 14:05:52 2017 -0400

    limit number of buffered keyboard keypresses to prevent OOM
    
    just in case Data uses biscuit some day

commit 8704cfa9e4fc193926bc9f5226b0b148462ada24
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 4 20:10:22 2017 -0400

    munch bugfix

commit 532f6ec114359037c3c747680450d8b72fa040d3
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 5 11:13:03 2017 -0400

    limit number of cached directory entries to prevent OOM
    
    most of the new code is for lazy dentry cache population and to be able to
    complete directory operations without a dentry cache.

commit 0579bec8c8e58b10e9ed487ae9a35d1b8135317b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 5 11:58:26 2017 -0400

    start allocation checklist

commit 505979ff3acdd22a3b09cb36bb70dd0e5ed30d13
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 5 14:33:46 2017 -0400

    debugging code

commit c8ae02ec52fc4997283fdba9cfb57b3a71a04602
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 5 14:44:53 2017 -0400

    use page allocator for pipe buffers and cleanup
    
    which are reused for UNIX domain sockets, too. the error handling is much
    easier if we lazily allocate the page since then the read(2)/write(2) code
    paths have to deal with it with an allocation failure; read/write already have
    robust error handling since they operate on untrusted user addresses.

commit ccde8470fd0b01db8a4885ee7a0d7a134422a597
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 5 15:25:54 2017 -0400

    cleanup and limit pipes to prevent OOM

commit ac73599c517071d5196c069293ee162862849425
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 6 17:35:04 2017 -0400

    limit page cache per-page objects to prevent OOM
    
    use red-black tree instead of slice to avoid allocation failures for huge
    files.
    
    generics would be nice to re-use the VM red-black tree code...i tried using
    interface{} but mailbench xput was 10% lower.

commit e325a26f19b6c49c758b528a5fbaadd41d2d561d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 6 23:17:13 2017 -0400

    socketpair(2) bugfixes

commit 7ffb3163a265e4d4b2861de036a0b52afb400e3c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 6 23:53:38 2017 -0400

    x

commit bffe83c5eb6b3c52ac9052176de86b8a14408e39
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 6 23:55:01 2017 -0400

    complete allocation list
    
    only one remains

commit da17cd0d16d62f8a518f929e8fb0d9d752b3d80b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 7 11:19:42 2017 -0400

    limit per-thread poll(2) metadata to prevent OOM
    
    registering a waiting thread can fail now, so pass the error up to the polling
    thread.
    
    i think that is all the non-transient allocations

commit 52417010b7b13aa17cab44d5c27204c1582e92a2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 7 14:20:43 2017 -0400

    for pipe/UNIX sockets, actually use the entire allocated page

commit 7b2c427f0606a77c7f077925ee3b3f1dd4640333
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 9 22:02:27 2017 -0400

    usertests bugfix

commit 2ad88c3e00ce9c29612f54fc192d1ac65ab7c8c6
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Sun Apr 9 22:04:16 2017 -0400

    page cache eviction
    
    evict unmapped page cache pages on FS allocation failure. disabled for the
    memory fs, of course.

commit e00e47c3ee04f4b86e35f11967fa6f5c2de07602
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 10 10:38:15 2017 -0400

    bugfix: prevent disk read/log commit race
    
    with the old code, disk reads would read stale data when reading an evicted
    vnode page that had been written to the FS log but before the log had been
    committed.
    
    i considered a few ways to fix this; the following is the simplest i've come up
    with so far: any disk reads for vnodes that have been recently evicted need to
    see if the log contains a more recent version of the block. once the log has
    been committed, the vnode no longer needs to check the log.
    
    it's tempting to simply wait for the log to commit before evicting a vnode's
    pages, but this may result in deadlock since the log may not be able to commit
    until the allocating FS operation completes.

commit 9c3e371f0502cec5b37cd5a7bbbf83eecd1012ea
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 10 13:21:51 2017 -0400

    allow dup to fail, set errno correctly when execvp fails

commit 0bccb6991d4f21c7feb0be9fcf80947c22035929
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 10 13:35:15 2017 -0400

    make dup2(2) atomic with respect to other fd operations

commit 513ac0d65ecc6ccaa5b6827ed84f0837401c1667
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon Apr 10 13:36:00 2017 -0400

    avoid needlessly rescanning all directory blocks
    
    when creating a new directory entry, don't scan directory blocks to find an
    empty slot if we know one cannot exist.
    
    makes my memory limit stressing program run faster.

commit ead17424db473662e8381bcff981fe9123036e13
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue Apr 11 10:31:14 2017 -0400

    close child fds if process limit has been reached

commit 57293df73a7c42b55be6eb68ceb40f2cf600282b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 12 10:24:24 2017 -0400

    prevent fdtables and and proc_ts from exceeding memory limits

commit df5c137789d10ef871247a48204025dce6263ead
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed Apr 12 10:30:01 2017 -0400

    don't allocate port 0 as an ephemeral port
    
    0 is reserved

commit 57f19acc16b422a465e51661ce396f2e361268eb
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 14 14:38:38 2017 -0400

    read the correct block

commit 803348e34dd4791393ebded383162aa612a3db2d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri Apr 14 16:02:23 2017 -0400

    x

commit 1b1106afd0226c507fa83d175c9f6761dcb91912
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu Apr 20 15:48:39 2017 -0400

    x

commit cc6aff00d2e3c25e2ec99e627640601bd4d21ed2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 1 11:25:06 2017 -0400

    memory limits stress program

commit 5e480cec2e4b6af316384a0fe0c43a0132a17623
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 1 11:29:45 2017 -0400

    make mkstemp(3) fail after trying several random filenames
    
    instead of possibly looping forever

commit 83b01d3d721e05396b85fcbd2e2913d49be1a183
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 1 11:46:59 2017 -0400

    biscuit object size dumper

commit f4682e98191ce3225f8122def547dc7b15a73ca9
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 1 16:16:51 2017 -0400

    linked list instead of slice for free-directory entries
    
    start cleaning up pre-submission patches!

commit fa475c8ae25fce2fdff2cda5fb31ad1603d5ba8c
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 1 16:22:57 2017 -0400

    allow nofile ulimit of infinity

commit 75cca0a219339ba7283e27c049e1712e5f4ab986
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 1 16:32:31 2017 -0400

    prevent panic with per-cpu tx queues when cpus > 4

commit 68a6cb65cd911b8bd2140d103f90605aff35329e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 1 21:12:12 2017 -0400

    cleanup sys_fork; only copy fdtable if limit allows

commit 41a6b20f8d7605c48cbddbbf73306b380278ef57
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 2 12:02:46 2017 -0400

    use limits from paper

commit fd87c6d6974a9cd43b1c2b19e1081ca3c72414a7
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 2 18:00:03 2017 -0400

    use red-black trees instead of hashmaps for dcache entries
    
    avoid allocation failures for huge arrays. be careful not to increase size of
    icdent_t since it is passed around by value. reduces cmailbench xput by < 2%.

commit 558f2654757cb65f60fa072efc5c1bb6da371a1e
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Wed May 3 13:14:06 2017 -0400

    x

commit e7921c36811fd200ec3cc9b5586dc6a6eb8004df
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 4 09:16:55 2017 -0400

    linked list for child statuses, greatly simplify exit status handling
    
    use linked list to avoid large array allocations. the previous code was
    pointlessly complicated.
    
    improves cmailbench xput by ~5%

commit c179748af8e0aa07addae777f240ae4ac82f6fe5
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 4 09:23:12 2017 -0400

    dur bug

commit 58a84e2647c4d7ce399876da51736c4c396fbb66
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Thu May 4 09:44:59 2017 -0400

    defer has gotten cheaper; use it more

commit 912d82d5e5645cb6adcd86de7ab0c7520e415991
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 8 11:37:20 2017 -0400

    finally repent of int physical address type
    
    new types: physical address, pmap, word/byte page

commit 86913ec8667fa77d384ae0a67ef8e7b5b1984e4b
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 8 21:05:33 2017 -0400

    even bigger fs

commit 59b913e4c84194721247622ef735f7c266d4723d
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Mon May 8 21:35:49 2017 -0400

    remove more crap

commit 37dfcc34e8148d8c8a1700d382d85c727d034c33
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Tue May 9 15:23:56 2017 -0400

    x

commit 15e07e1056b3be6fde5887ee98aa357103ea34f2
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri May 12 09:26:36 2017 -0400

    disable bhw hyperthreads

commit b54de8fb8084d974a3b45be6a85a69ddc9d95bca
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri May 12 09:27:02 2017 -0400

    testing interface{} red-black tree

commit 22d0d3adf1e793e2e92a0e9253f98a0652b4ca46
Author: Cody Cutler <ccutler@mat.lcs.mit.edu>
Date:   Fri May 12 09:28:10 2017 -0400

    redis configs for four redis instances; redis experiment

commit 76038e9ced52581bfaecf13bc5c8151216493d5d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri May 12 09:35:54 2017 -0400

    x

commit 469e8aba736f02eb185b4733effadfc19e4737e3
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Oct 31 10:03:55 2017 -0400

    initialize NIC table
    
    this bug didn't crash biscuit because RCU-like updates create a new table.

commit 94c91c25c5320170267dcba7cd911888acce5d66
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Nov 7 09:23:09 2017 -0500

    x

commit 0c77c20e11da1a7459a987d97dc7fc8f35651c63
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Nov 8 08:52:24 2017 -0500

    checkpoint static analysis tool

commit fe8cae1d10f4278d65d2bb0a1b27cb70cdb9f288
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Nov 10 11:04:58 2017 -0500

    checkpoint tool

commit f1b758051123e11e5d69d92d40865ed5825dc0ae
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Nov 14 07:30:02 2017 -0500

    checkpoint tool

commit 741f46f5498db2b7677f7bb89de0a94bf5613b2a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Nov 15 16:17:40 2017 -0500

    checkpoint

commit 055ae0913fd777ffcf735452b109e0db0d837c10
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Nov 15 21:48:48 2017 -0500

    new loop detection/calculation
    
    far superior and maybe even correct

commit cbbcd20cfdc70e7b1221f4588cbfc6a908492812
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 13 10:27:17 2018 -0500

    fix TLB flush regression
    
    biscuit on 1 CPU may fail to flush the TLB under certain thread schedules. our
    TLB flush test case in usertests caught this bug!
    
    the TLB flushing/pmap freeing code desperately needs a cleanup -- i shall do so
    soonish...

commit efac513b6287a2ff8d8d45e17eb0893eb2d39aa0
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 13 11:05:28 2018 -0500

    more makefile hacks for packages
    
    also: make gnu11 the default C dialect for our C programs. apparently the
    default dialect differs between gcc versions.

commit 15f13f90a989bea475749caf222ffc52e63659d1
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 13 13:43:57 2018 -0500

    allow user to override qemu binary

commit b89d41c4dc00b1f8338ebc2aa3fc0c730eb1bc42
Merge: 15f13f90a9 cbbcd20cfd
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 13 13:46:35 2018 -0500

    Merge branch 'master' into package
    
    Conflicts:
            biscuit/main.go

commit e62084c751449a5032cd32fc1d61cad969daedac
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 13 14:06:20 2018 -0500

    remove whitespace only lines

commit 6df764cdcfb27b7bd49f91f58ffaea0a640c8a9a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 13 14:43:53 2018 -0500

    bimage(1) listen on port 31338, for AHCI images

commit 4fce16d9eed2cd643dccee22c2e402c11c85cbc2
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 13 15:09:59 2018 -0500

    Revert "remove whitespace only lines"
    
    This reverts commit e62084c751449a5032cd32fc1d61cad969daedac.

commit 6da6fdfa8439de7f154969683bcc554b2094d12e
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 13 15:20:04 2018 -0500

    go fmt everything
    
    shed a tear for the end of an era!

commit 9bc2d4ef73e456647f96b069cdea7b8ee075a136
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Feb 14 15:24:03 2018 -0500

    thank you, frans!

commit b6789860cb362ef6afef01a47d5b0d82ec5246bf
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Feb 16 08:58:48 2018 -0500

    raw disk and bimage(1) fixes

commit 2edaae455d982f94a4c19a0142b84c3a0b9eced4
Merge: b6789860cb 6285b8524d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Feb 16 08:59:32 2018 -0500

    Merge branch 'package' of g.csail.mit.edu:biscuit into package

commit 321b680e68aa081363f46d57df3f1368c88ed8c9
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Feb 19 08:01:28 2018 -0500

    bins.go is generated during build

commit d595e24c40b29b3dab2d1f2badc739c8c42c732a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Feb 19 08:01:47 2018 -0500

    fix build when GOPATH is not explicitly set

commit 4784aa8b7cb67ba4ee284df567fdf3fba827363d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Feb 19 09:18:03 2018 -0500

    mkfs.go: write only file content, not the whole block
    
    otherwise the files get padded with zeros to the block size

commit 3c3d7a319b91c736d0360c22e3a12ef2e546f040
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 13 15:44:34 2018 -0500

    halp

commit 916e7575c70670a7285cfb41bc0ebfd50076721f
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Feb 11 07:29:17 2018 -0500

    memory reservation mechanism
    
    a goroutine reserves n bytes by subtracting n from the global reservation
    counter. if the global reservation counter is less than n, the reservation
    fails. when the goroutine allocates, it subtracts the number of bytes allocated
    from its reservation.
    
    when the system call/interrupt is over, the goroutine returns the remaining
    bytes by adding them to the global reservation counter.
    
    after the GC sweeps all pages, the number of newly swept bytes are added back
    to the global reservation counter.

commit 60ff68d09b47a2dd9dc436703716957b898a1157
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Feb 12 18:51:38 2018 -0500

    incremental memory reservations

commit 677256a523accab182a3317b9b3334829a9a3dab
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Feb 22 12:24:43 2018 -0500

    syscall memory reservations

commit 2c2419c204ba753f2225de283fed4c8e97271c37
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Feb 23 10:36:52 2018 -0500

    debugging code to find allocations without reservations

commit b63167046696a974d04dd33020d1b784d5838c4a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Feb 23 11:58:51 2018 -0500

    fix sharedfd test

commit 04e14b53fb3cb5a46d272d4f81a518f41756eafb
Merge: b631670466 5489a16b76
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Feb 23 12:17:21 2018 -0500

    Merge branch 'package' of g.csail.mit.edu:biscuit into package

commit 6fecffacc7852a9eaec4a55aac3713ad3bbd186a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Feb 23 15:24:12 2018 -0500

    bugfix: prevent merging of MAP_PRIVATE and MAP_SHARED regions

commit 13aafa7ae89289a17270d6c97548c86496bd4ffa
Merge: 6fecffacc7 9821794006
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Feb 23 16:27:35 2018 -0500

    Merge branch 'package' of g.csail.mit.edu:biscuit into package

commit f4feb29ae4ed935ab249dbbee42be198f256a270
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Feb 25 15:17:54 2018 -0500

    fix block page ref count race between blockcache and VM system
    
    blockcache increases ref count of clock pages in Mmapi(). therefore caller of
    Mmapi() shouldn't increase ref count of block pages (but should for anonymous
    pages). this seemed easier than having caller increase all page ref counts but
    having to Relse blocks.
    
    for MAP_SHARED, block cache pins the page in Mmapi() and VM system unpins the
    page when the page is freed.
    
    usertests, redis, and cmailbench pass on bhw.

commit e141635248fba9110fe67cc2ffe2db2ac4dc934a
Merge: f4feb29ae4 107cb6df0d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Feb 25 15:21:21 2018 -0500

    Merge branch 'package' of g.csail.mit.edu:biscuit into package
    
    Conflicts:
            biscuit/src/fs/inode.go

commit 4404405605a312352502588ac62053f1b725c7f8
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Feb 26 11:46:13 2018 -0500

    don't unnecessarily allocate a directory data block

commit 2d4a24ea01d2d8e133cd7b72302818b2a63ba8bb
Merge: 4404405605 5179855773
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Feb 26 11:47:43 2018 -0500

    Merge branch 'package' of g.csail.mit.edu:biscuit into package

commit b4dd294d7b21cde1fede89fb41620f4cf2bec232
Merge: 2c2419c204 2d4a24ea01
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Mar 1 15:52:09 2018 -0500

    Merge remote-tracking branch 'origin/package' into package-res

commit cb0b5e6c961055a7e94605cfeb2e5146bbdda67e
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Mar 4 10:28:16 2018 -0500

    bugfix: deadlock in O_CREAT
    
    this code attempted to lock the parent directory and target file directly,
    without deadlock avoidance (iref_lockall).
    
    the old FS had to lock the parent directory and target file simultaneously in
    order to guarantee that the target file was not unlinked.
    
    with the fancy new FS, we can guarantee the target file isn't unlinked by
    simply getting a reference to the target imemnode_t before unlocking the
    parent. thus there is no need for iref_lockall.
    
    discovered via usertests on bhw

commit 2cc285045db2541ae6e583a35140bbd177fabe9e
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Mar 4 10:50:31 2018 -0500

    x

commit f287ef647fca71d087c8d3d6651dc3dbcdfaef79
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Mar 4 12:43:45 2018 -0500

    bugfix: another create race

commit 938e214318aa5968b1db01892c5676a96fd3935c
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Mar 4 14:47:00 2018 -0500

    free blocks in transaction size batches
    
    use imemnode_t.major to track freeing progress in-between transactions.
    
    it passes our tests along with some manual crashing tests. it would be great to
    test it with frans' crash checker!

commit e810f2057086c63c13e8eb6c7702038434031a5b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Mar 4 18:24:03 2018 -0500

    bugfix: free all the indirect blocks stored in the double-indirect block
    
    not just the first one! thanks, frans!

commit 01a29c4e6b7902a2c06447f6ab06e8e2e8d57945
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Mar 5 11:17:44 2018 -0500

    bugfix: free double-indirect block and simplify a little
    
    thanks again, frans!

commit 4f149afcf58117e8cb83baf07f4ba44d56cdcae1
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Mar 6 10:01:00 2018 -0500

    more makefile fixes
    
    so make clean works

commit d9800deabb983fd38e635e838a5e0fb86a25d205
Merge: b4dd294d7b 4f149afcf5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Mar 6 10:02:43 2018 -0500

    Merge branch 'package' into package-res

commit b3d739c7a38b87cfd8b613a9a75f97c7cbd1331e
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Mar 6 10:01:00 2018 -0500

    more makefile fixes
    
    so make clean works

commit b0e98731d2ee188a3ba87561b8c9af1a38a371b3
Merge: b3d739c7a3 3c7893d291
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Mar 6 10:05:25 2018 -0500

    Merge branch 'package' of g.csail.mit.edu:biscuit into package

commit 00164f9b3cdc4b148709e74f6e79316ee2911a41
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Mar 6 14:20:10 2018 -0500

    mkfs to "make clean"

commit deeb3584bbc64f589e0c53e56dde583005ee1217
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Mar 6 15:20:01 2018 -0500

    kernel thread reservation functions

commit ffb24466a05ed149805116c3614feeee05e007be
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Mar 6 15:20:17 2018 -0500

    no

commit 07e5e91803a3b2a6e3779f49aac196b358e35cd0
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Mar 6 19:29:59 2018 -0500

    run pthreadfd test in child process to avoid fd leaks
    
    which makes subsequent tests which fork() a lot take forever on qemu!

commit 8e8bc32eb1d35de4f633085097e60b113e7079b5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Mar 6 20:25:57 2018 -0500

    linux-like "current" to access owning Proc_t from its kernel thread
    
    this is useful to check a process's killed flag for when deciding whether to
    block for more memory or stop a possibly endless sleep/block (to kill).

commit 8cc60896d22ccb6b2d0d920f6c71a894840ee530
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Mar 6 20:48:09 2018 -0500

    update and add bounds for potentially long loops
    
    gofmt seems sensitive to context...

commit 2b2a48e95507197b880c8f4fb6739511c967197f
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Mar 6 20:58:00 2018 -0500

    start adding the "deep" reservations
    
    need to implement syscall restarting, too

commit 409a6ef90ad2dd0a7c911e79480ebb298a2ccd61
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Mar 7 14:17:08 2018 -0500

    wakeup sync()ers without (pointless) goroutine

commit f73cf2a896041c9850011bf33eef330b961c9785
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Mar 7 14:48:16 2018 -0500

    whoops; broke AP boot code with makefile changes...

commit 772257f58f263c0753c3a8605cd16ce61c7f8708
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Mar 7 15:08:34 2018 -0500

    return error code from Sys_pgfault
    
    to allow callers to distinguish failures due to lack of user pages or a bad
    address.

commit 4774505f2d25cd5976aa88a13ebe42bba3fba1a5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Mar 7 15:30:24 2018 -0500

    error codes in User2k

commit d2babdc130d27b24fabc836485a8c6197ad6c39c
Merge: 2b2a48e955 4774505f2d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Mar 7 15:31:15 2018 -0500

    Merge branch 'package' into package-res

commit 6c451998fd413c3bf1dde1f04eae632a7f6fd17f
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Mar 7 15:47:36 2018 -0500

    teach User2k and K2user error codes
    
    this is necessary in order to distinguish system calls that failed due to user
    page allocation failures and exhausted kernel heap. biscuit must restart system
    calls from non-hog processes that failed due to exhausted kernel heap.

commit 17fa11b50042826434b634a9e309a42b07bac31e
Merge: d2babdc130 6c451998fd
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Mar 7 15:51:45 2018 -0500

    Merge branch 'package' into package-res

commit 42ced10fcabdbcb2d6c847806bdc539ae8758a1b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Mar 7 15:58:38 2018 -0500

    deep limit checks
    
    if a deep reservation fails, it returns ENOHEAP back up to Syscall(), releasing
    all locks. Syscall() can then restart the system calls made my non-hog
    processes.

commit dd4e33503f6730968a46f3cc7214c078b0168b30
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Mar 7 16:00:49 2018 -0500

    debugging reservations
    
    these reservations are not necessary since the allocations made by these
    goroutines are covered by the sender's reservation, but they help me make sure
    all allocations are covered by a reservation.

commit fc259e8451583012348203cbf034ba124d05571c
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Mar 8 11:00:26 2018 -0500

    typos, some restarting
    
    naively restarting read/write is safe on files, but not on pipes. luckily the
    pipe code is simple and no locks are held when it makes a reservation, so
    sleeping is fine.

commit 2e621a00e34fcecf717a252f84d3dc011ccdefc3
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Mar 8 13:05:47 2018 -0500

    last debugs?

commit 00d2117753ffdfb444076c5e3a610eef277ba2a2
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Mar 8 13:48:04 2018 -0500

    last debugs??

commit f3f5f03213171a628ad5b49da012105471034775
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Mar 8 19:39:20 2018 -0500

    handle cached allocations
    
    for ifree() and bitmap_t.apply()

commit 1acee895f0364ff5497cbe6ae770da0e57ceb911
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 09:46:09 2018 -0500

    remove funny defer

commit cde1843d1499f1ed1b146723894a2c5fa3e9d44e
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 10:48:29 2018 -0500

    asynchronous eviction, for oom killer
    
    passes our tests, but leaving the on-demand eviction code enabled, for now...

commit 466d94e56c7090411b6b80af2c17d2630a27cfa2
Merge: f3f5f03213 cde1843d14
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 10:49:50 2018 -0500

    Merge branch 'package' into package-res

commit cf916a427f13aa56419293cc7500d86afdb12b56
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 12:02:39 2018 -0500

    explicitly try to evict cache allocations
    
    in the two important places: ifree() and bitmap_t.apply

commit 3a33eab68fc2120685644d227eb19c721de33e4b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 12:52:06 2018 -0500

    cannibalize the physical memory fail-er for the reservations
    
    for testing syscall restarting

commit a555995147fea728c00391f09f2b503370b90378
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 13:28:57 2018 -0500

    whoops; actually pass error code

commit fd082153c52093c5abd8494bfa3b2d7b64a62536
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 13:30:34 2018 -0500

    syscall restarter/reservation failure tester and hacks for user FS
    
    it instantly found bugs. hacks to prevent user-mode FS from bothering with
    (failed) reservations.

commit a2f49ce118ab9c330962987636fc1a5d1f77822a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 13:33:50 2018 -0500

    basic syscall restarting

commit 2d27522c038ff2bc84f7d50a6a91cf2847bc79c5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 15:29:14 2018 -0500

    repent of using bool instead of error codes for sys_pgfault return value
    
    yahoo!

commit 631f44239520109e0fd323869d8823311326cfa5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 16:01:15 2018 -0500

    whoops

commit 8079e34c0d3735e10aaf2fee2ae622fa98c1a8a4
Merge: a2f49ce118 631f442395
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 19:14:11 2018 -0500

    Merge branch 'package' into package-res

commit ce048b0b53da4adca3cc492c1c47ecebf80a7c9a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 18:35:47 2018 -0500

    restart page faults that failed due to low heap memory (ENOHEAP)

commit 54208b1694e2892d3d92c20574eb038a61144169
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 18:37:25 2018 -0500

    new error paths, courtesy of ENOHEAP
    
    sadly, Fs_rename doesn't handle ENOHEAP and its careful error handling strategy
    of pre-allocating necessary pages won't work. nuts!

commit 4acbd2947e547ea8b78838f4ecb5c8a36278127b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 19:03:52 2018 -0500

    make UNIX SOCK_DGRAM socket receives atomic, for restart-ability
    
    it is not good if a restarted recvmsg(2) call by a non-hog thread mysteriously
    returns a zero length message with a valid sender address.
    
    recvmsg(2) is still broken though, because writing the sender's socket address
    size and ancilary data size to user memory is not atomic w.r.t. the
    data/address copy.

commit 68059c0ba28fcd41331d509e72aca01d7c3ee1c9
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 9 19:29:40 2018 -0500

    don't try to be fancy but actually cause deadlock

commit 828977799cbe83d15074c0b3f5f268102dd575c3
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Mar 10 09:38:11 2018 -0500

    exit on pipe test failures in usertests

commit ab3f6a32a9f3f10e10dcabc85a4ef66360ee531c
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Mar 10 10:24:54 2018 -0500

    make PIPE_BUF writes atomic
    
    so ENOHEAP failures can't occur in the middle of a write of PIPE_BUF size.

commit 4a8386c2e1997a36029d5a01fd3d1201ad2cb95a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Mar 10 10:29:00 2018 -0500

    handle new ENOMEM failure path in exec
    
    simply move the code that writes the special struct to user space above the
    "commit" point (closing all the old fds, freeing the old page map/memory).
    
    besides rename and recvmsg, usertests passes on bhw while causing the first
    "deep" memory reservation of each distinct call-graph path to fail, forcing the
    system call to be restarted. hurray!

commit c221129e0f40f7e94de06933e4551e42427ac913
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Mar 10 13:27:42 2018 -0500

    prepare for reliable kill
    
    CSP can make killing even more annoying! we got a bit lucky with how we use
    channels; there are only four code sites where a goroutine can block for a long
    time on a channel operation, and the other three are simple.
    
    there are two ways that CSP makes killing more annoying. first, if the hog
    goroutine is blocking on a channel on which other non-hog goroutines are also
    blocked, we need to somehow tell the non-hogs to retry. second, many operations
    in CSP style involve two or more messages between the two parties.  well the
    code is unlikely to cope with the other party mysteriously bailing before all
    messages have been sent or received.
    
    the futex code was an example of the second case. luckily it is easy to fix by
    having the futex daemon send wakeups asynchronously. that way, if the hog is
    sleeping on a futex and gets killed before the futex wakes it, the futex daemon
    won't block forever.
    
    in biscuit, both of these annoyances are naturally dealt when using conditional
    variables instead of channels.

commit 0584e31f8ce62a2c0f75960bf6a0368623bee881
Merge: 4a8386c2e1 c221129e0f
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Mar 11 09:40:24 2018 -0400

    Merge branch 'package' into package-res

commit 24b49892e678d60b3d4681538b7962eb027073a3
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Mar 11 10:37:17 2018 -0400

    no hashmap for bounds; keys are contiguous

commit 0f6136c03c5a52a8e0644a0cbcf815d67ab89331
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Mar 11 10:38:10 2018 -0400

    whoops; forgot deep reservation in poll

commit 61e55ea75dca6907266f1f41c433d2ce49492346
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Mar 11 13:20:52 2018 -0400

    bugfix: deadlock in interrupt waking code with concurrent GC
    
    release spinlock and re-enable interrupts before calling functions that may
    split the stack, preempting the thread into a GC.

commit de642bbc41dd50e6a1be4b92f154111b7e9064b3
Merge: 0f6136c03c 61e55ea75d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Mar 11 15:25:50 2018 -0400

    Merge branch 'package' into package-res

commit 97921c0bb053f6506bf9a114974439c71ecca858
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Mar 11 17:34:40 2018 -0400

    reliable kill tests

commit 4671a6157b1224a9473d5963c9fa0b43dbdc755b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Mar 11 17:41:20 2018 -0400

    x

commit 9ebfe137348ca6a2767a7198cf27aef05c87af32
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Mar 11 17:42:42 2018 -0400

    reliable kill
    
    seems to work. its a bit of a shame that this design adds some synchronization
    overhead to every exit(2).

commit a7798c63a581113c1a3fbfe4a05a685c27f5fe05
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Mar 15 09:36:28 2018 -0400

    reservation failure tester is slow
    
    allow compiler to omit it when disabled

commit da6c5eec72494efb147710361331271da4a4e5ff
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Mar 15 10:07:39 2018 -0400

    res size dumper

commit 5b39a7dc30e42320f437711d6e2ba566152060b5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Mar 15 15:01:22 2018 -0400

    remove old crap

commit 52ec52b9abf561c2c9ec668ab01d861279b0759c
Merge: 5b39a7dc30 fcdb966573
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Mar 15 16:09:45 2018 -0400

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit 3a6a74cf8416a885acfd1b1df0922e247bdef47c
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 16 09:17:24 2018 -0400

    kill fake pause(2), too

commit a04abafc007b496f4860476a95b4745f863d21e0
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 16 09:40:17 2018 -0400

    more inode blocks

commit e9d5f2f4a71aa5d979769b14147540f6d1816d2e
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 16 09:44:08 2018 -0400

    remove explicit bound on inode and block caches
    
    by not evicting on lookup. the oom killer will evict them as needed.

commit df63bb9130f9e4617cd7a53ad774dd1e70df1207
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 16 11:26:22 2018 -0400

    reservation leaking
    
    useful for testing

commit a26cc76d8f76189ad4abc9fd8deee83c28d525f6
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 16 11:28:00 2018 -0400

    runtime.GCX(), to avoid excessive GCs during low memory situations

commit ea849969c7a51f495d9a576ca87550ca0589e263
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 16 15:45:19 2018 -0400

    OOM killer
    
    successfully kills the naughty program and leaves the good citizen program be.

commit 760539ce62c33b270c7b093cf3ec67e560dfc118
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Mar 16 15:47:28 2018 -0400

    new naughty program
    
    grow kernel heap using VMAs

commit d1a7bab6d0f11d4d3b725b133a8dbf9561a28024
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Mar 19 09:12:00 2018 -0400

    better and simpler live data accounting

commit b3b4659ac8294a01ca1b6a330530e0716483e80b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Mar 19 09:13:25 2018 -0400

    simpler gctrace info

commit 82a3d81b9af3ffe7a4b1416dbebf52186fba5ebd
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Mar 19 09:16:10 2018 -0400

    SQUASH ACCOUNTING

commit 515a81ecbe7c999e5ecbc3130c2437c2c4877e63
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Mar 19 09:17:54 2018 -0400

    "good citizen" process

commit 7ce622884d6f23d716fa213ce70092ee41fdd90d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Mar 19 09:19:08 2018 -0400

    update reservation leaker

commit 7a6287b6f5c3fd3393623b3d58bf239c3ee4604b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Mar 19 09:19:27 2018 -0400

    x

commit 0f4b37d57a2febc24ee8804ad5cc6d71cdb1ead5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Mar 19 09:22:24 2018 -0400

    better oomkiller
    
    less pointless gcs, only evict inodes and blocks when there are many

commit 0d6bf26a3d02c841809533d3413ccc1d2119134e
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Mar 19 15:21:18 2018 -0400

    code to free VMAs progressively

commit b08ea5ee9d3d1b5b0ab995450e8cf9d48a37f159
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Mar 19 15:21:33 2018 -0400

    probe only one AHCI port
    
    this way i can have multiple disks connected to bhw which allows me to more
    easily boot into linux.

commit 4587074a5db300a40a5d4b4b022ca8127ebc6f5d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Mar 19 16:13:55 2018 -0400

    make /dev/null polling work again
    
    useful for testing biscuit's TCP stack via netcat

commit 05fdba486965cf2fb3ff20e3b7c676b2b02648b6
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Mar 21 09:48:05 2018 -0400

    disable debugging panic?

commit 4476521a61a0644a232a2f2e22044f0bced7af13
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Mar 21 09:57:28 2018 -0400

    bimage(1) fixes
    
    bring all bimage blocks and metadata into block cache before imaging disk.

commit 01b7c155cc61121116356e2a9e18d8f4ed895b2a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Mar 21 09:50:15 2018 -0400

    resurrect bimage(1); rawdisk writes bypass page cache
    
    a write to the rawdisk block device must not write to page cache pages since
    such pages could be mapped by a user program.
    
    because of the above, bimage used to clobber its own instructions while imaging
    the disk. now bimage works, which greatly shortens my iteration cycle for
    performance testing.
    
    bimage now works and images quickly.

commit 7d7aee8e74b7f71bf2d26882e8ad5bf78f9bac86
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Mar 25 13:03:01 2018 -0400

    reservation counter bugfix

commit 85f8164b6005d4c2e5901a67bb68cafb634d5456
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Apr 3 14:00:25 2018 -0400

    getppid testing code

commit 79be4e5e798045c486b9149d8e92dda3bfb08d2c
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Apr 3 14:08:26 2018 -0400

    x

commit 690b83a1ace12d6985b0d3e9235e011acb87b0fc
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Apr 3 14:22:09 2018 -0400

    more to the pile of fast syscall hacks
    
    add syscall fast path. i'm tired of optimizing syscall overhead!
    
    biscuit's syscall design incurs additional overhead. it is convenient to treat
    a return to userspace as a function call (i.e. Userrun()) from the kernel. the
    result is that the corresponding return instruction is executed after switching
    to and back from usermode, which is quite slow (70us/getppid vs 50us/gettpid).
    
    i suspect my CPU flushes the return buffer after switching privilege modes. it
    isn't TLB flushes since the TLB was not flushed (getppid benchmark) and
    everything should have been in the cache...

commit c136e8f393a84cdcf9b904bf09f22aa2e5ee915b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Apr 11 11:01:50 2018 -0400

    hack compiler to allow bypassing package boundaries
    
    for debugging, it is nice to directly access symbols in other packages. this
    allows us to use the go:linkname directive to do so.
    
    packaged biscuit's days are numbered!

commit 4e04f97a854d3b3bbbbda539afa7a3b62caa8a04
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Apr 11 13:33:46 2018 -0400

    instructions retired counter to time(1)

commit 837dc9472cec2a87da90186241e21a498c7d407b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Apr 13 16:28:53 2018 -0400

    x

commit d26e091e4ea5a80357dfb105ca3e785f51c19713
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Apr 13 16:21:23 2018 -0400

    mark kernel text/bss/heap pages "global"
    
    reduces TLB misses for context-switch heavy benchmarks, like ping-pong

commit 8d0a6694009d0bab9ff581b83d13a68500d57edb
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Apr 13 16:47:51 2018 -0400

    dur

commit 5c034daf10983f18fe9e629f9daa0c20b09fa1c4
Merge: 8d0a669400 9d4215311b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Apr 14 07:50:10 2018 -0400

    Merge commit '9d4215311ba573a5b676de85b053eec03e577478' into rememrge

commit ce12e9bef3db23e95443d9a6df4458f26e974be0
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Apr 14 11:43:12 2018 -0400

    go1.10.1 build fixes
    
    the new build system apparently depends on netpollinitted() correctly
    working; use a less lame hack

commit 83e61395e0b5df6a6ae366071782fe512fbe57be
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Apr 14 11:45:17 2018 -0400

    disable my unused GC time counters

commit f5a071578940cdc8c89faabb6b20747ed6a8619d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Apr 14 11:46:24 2018 -0400

    merge startup path with go1.10.1

commit f64130c1048a9af00cfa5472310df0374c25b8e6
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Apr 15 10:59:53 2018 -0400

    fix runtime startup, some cleanup

commit f3d7ba0be5d7939f0e4ee6f69e99d68c31c5597e
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Apr 15 13:41:21 2018 -0400

    correct version file

commit 112690bce58a6b9a2c8b677c20babfbdd8302901
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Apr 15 13:41:44 2018 -0400

    fix Userrun() stack size
    
    compiler changed stack size. someday i will fix it so stack size changes won't
    matter.

commit 032ae82bda72553ff583c69b7dc1da3d81479aa0
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Apr 15 13:47:08 2018 -0400

    avoid write barrier in Ap_setup()
    
    be more careful and ensure no write barriers are present in the "shim" layer.
    
    everything seems to work.

commit 8294fc745ad21d8cbe695e5c30f646616fa018d5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Apr 15 14:05:41 2018 -0400

    resurrect compiler hack

commit af31ca14c64fec362fc91352e3596a7a6326b6ff
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Apr 17 09:00:37 2018 -0400

    fix memfs flag

commit aa5028466c0585729259e88c142f6a62cc541d77
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Apr 17 14:31:17 2018 -0400

    x

commit 230ec96d82e094a8f0c20f98d03db158a7f3e9cf
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Apr 17 15:01:46 2018 -0400

    x

commit 47c6ed35172b2f00cd177fa068952cdc951489b6
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Apr 17 20:35:16 2018 -0400

    memfs fixes

commit 0ad93588ea541d5c6edc892a8eedab956ed80218
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Apr 18 11:53:35 2018 -0400

    panic immediately on log recovery errors
    
    instead of on subsequent nil deref

commit 06c8387457653b06a2c270fb43470217bbc077b2
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Apr 18 21:58:07 2018 -0400

    record backtrace during PMC interrupt for kernel code
    
    a bit tricky since an NMI can occur when interrupts are masked, like between
    biscuit's swapgs pairs. luckily we can use go's backtrace code without much
    difficulty.
    
    hopefully this will be helpful in optimizing our benchmarks.

commit f487189707cc76b1a90b15d211fa87242e12b096
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Apr 18 23:08:50 2018 -0400

    /dev/prof
    
    to more easily dump profiles. no more copying-pasting from serial console. sad!

commit e05938e9f20e35327be8a496eee70ab73af2898b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Apr 18 23:11:15 2018 -0400

    profile copying script

commit 89fffeb593db4be2013e1ac58e08203d07783e2a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Apr 18 23:20:52 2018 -0400

    x

commit 0f772d7824e108ae73aeaf35875800bc52f04931
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Apr 19 09:37:11 2018 -0400

    x

commit 911c6702b26ffa49772ebde3129ce0ff825fda9a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Apr 19 10:21:59 2018 -0400

    munch.py tabs -> four spaces

commit 22e4386647bb4e378aada14bad6f914f342efc39
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Apr 19 10:33:13 2018 -0400

    backtrace flag to time(1)

commit a0974516713f7f073f70c250926e652fef7dffcb
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Apr 19 13:48:16 2018 -0400

    backtrace, graphviz support to munch.py
    
    sadly the graphviz crap was a complete waste of time!

commit 18f1080b39713bbb40638e1a02e72976720a38b7
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Apr 19 21:25:47 2018 -0400

    remove unnecessary closure allocation
    
    (only the Get_fill allocation matters). improves cmailbench xput by 11%.

commit 9cf2b65fab5c6d53ccc2e56d1b4c6881804b07ab
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Apr 20 13:49:13 2018 -0400

    fix FS race
    
    hold imemnode's lock before reading size and itype during write(3)

commit 9ee56cbcbc7507c1a5e825091c7fbb9ab03316e2
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Apr 20 14:21:11 2018 -0400

    makefile fix: mkfs depends on FS go files too

commit b8826d12a691bdd63c8d7522e9bc26a1df0d717a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Apr 20 14:21:47 2018 -0400

    consistent locking in FS; use ilock/iunlock

commit d5ca5f676b0ec7f112e33d2d648c60a7e727e212
Merge: 8294fc745a b8826d12a6
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Apr 20 22:15:47 2018 -0400

    Merge commit 'b8826d12a691bdd63c8d7522e9bc26a1df0d717a' into remerge

commit e6d7de0057ab1b00f3526f4bb89db100c9f6139a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Apr 20 22:19:59 2018 -0400

    update go backtrace code for go1.10.1

commit 4180f2418605841d12bc9d912bb669a1a941c3d7
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Apr 20 10:02:25 2018 -0400

    increase default goroutine stack size to 8k
    
    cmailbench constantly creates new goroutines via fork which promptly grow their
    stacks before exiting, using ~11% CPU cycles. linux uses 16k stacks so
    increasing stack size is probably fair, at least.
    
    we may be able to reduce stack usage instead, perhaps by reducing function
    arguments, return values, or locals.

commit 788336d926020df5a56b62f8821ca35bffc2b110
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Apr 20 23:12:45 2018 -0400

    go less crazy with defer
    
    remove a few of the easily replaced defers. i left the defers in rename, open,
    unlink, and exec since replacing those is painful.
    
    before this patch, cmailbench spent ~9% of CPU cycles in defer related stuff.

commit 983da12ce4fb40eb30a87112a9c14c88aa7ac6d5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Apr 21 00:05:31 2018 -0400

    refcache: remove per-ref_t lock, atomics for ref counts
    
    now each lookup acquires and releases one lock instead of two (only the
    refcache hashtable lock) and Refup/Refdowns can proceed in parallel instead of
    serializing with the hashtable lock.
    
    this improves 4 CPU cmailbench throughput (on memfs) by 36%. using go1.10.1
    also gives us a free speedup of 6% -- apparently hash table lookups have gotten
    faster.
    
    PMC backtraces made it easy to find these top bottlenecks! i'm nearly done with
    cmailbench...

commit 04ea2dcb99aac2a356870adb029893d16951f87a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Apr 21 12:47:45 2018 -0400

    res cleanup

commit 8d1f473e8688bce7d737e33da8d211ef7918480a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Apr 21 12:48:35 2018 -0400

    x

commit 8e67edac1ffedd29d63c4790a26196d7989cbf09
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Apr 21 12:54:16 2018 -0400

    debugging stuff

commit 277dd37932c67ec617446e84c519727d2c538af2
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Apr 23 12:19:16 2018 -0400

    x

commit 1a8df1e91a3c402557d345669d0ef1df41c249ab
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Apr 15 13:47:08 2018 -0400

    avoid write barrier in Ap_setup()
    
    be more careful and ensure no write barriers are present in the "shim" layer.
    
    everything seems to work.
    
    (cherry picked from go1.10.1 merge branch)

commit 053eb172207ed12cbd54601aab1619406498b3fc
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Apr 23 16:28:04 2018 -0400

    slice for syscall bounds

commit 21d15638fc7e8baab73083a326368d96c3520ea3
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Apr 23 16:37:43 2018 -0400

    PMI memory corruption bug
    
    if an PMI occurs after the "OS" scheduler stops executing a thread and unlocks
    the threadlock but before the CPU starts executing a new thread, the old thread
    may be picked up by another CPU and have its TLS change unexpectedly due to the
    setg() call

commit 7b8346a7006640818c8e3ccfcea8046670f2edd0
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Apr 24 19:42:45 2018 -0400

    disable fs prints

commit a639262350ee2925672c8f678ca4d9bc1277d4c7
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Apr 24 19:43:04 2018 -0400

    disable fs counters

commit 424b40e3f3a63ac03f1c39512a3aa300f46a6199
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Apr 24 21:19:22 2018 -0400

    script to find all write barrier instructions
    
    seems to work

commit cbf1be8033ddef3c8631c00476e59b3c4194ab69
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Apr 26 08:52:03 2018 -0400

    checkpoint script
    
    find nil pointer checks, break into basic blocks for detecting bounds checks

commit 76baaa3e77c12b43b066816b507b7fec1f39b594
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Apr 26 14:03:33 2018 -0400

    x

commit 642d7a23723806cc61c8991364a804093e5036c7
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Apr 26 15:11:40 2018 -0400

    bound checks seem to work

commit 351f0071219207f4ad29817442926d0abed67daf
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Apr 26 16:25:52 2018 -0400

    find stack splits

commit 9a9bb07ef480ca9a8fcc759767e8532c7040d415
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Apr 26 16:56:29 2018 -0400

    find slice range and divide checks

commit 500fe5ef63ab111fbfff20268ed959840ca906fa
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Apr 26 17:30:00 2018 -0400

    find type assertion checks

commit 63ef4ba8ab1189ac633427ec2d14e8c3013d0cf2
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Apr 27 11:27:55 2018 -0400

    x

commit c5464599c1b78da070ad292342b75bd7282e3ab4
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Apr 29 10:20:20 2018 -0400

    simpler vnode bloating

commit 44898c30e9c4dc036c7de24aba0498387c0d90c5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Apr 30 15:19:59 2018 -0400

    prevent myself from accidentally using broken GC percent next year

commit 5e7ee047350b0f57be0c9f00ca88c34e19459cce
Merge: 44898c30e9 c7c424ec57
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Apr 30 15:21:31 2018 -0400

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit 01ec84acb8e3a21e95d7f256b2aa8b5c3aa1f5e3
Merge: e6d7de0057 5e7ee04735
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Apr 30 17:27:42 2018 -0400

    Merge branch 'master' (early part) into remerge

commit 36cbe52c2b18fb453ab69a77c1b1323e236945db
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed May 2 11:05:57 2018 -0400

    fweb latency profiling

commit 7cb9b125c79763f489e37c23d060911e11e96548
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed May 2 11:15:29 2018 -0400

    hacked per-cpu profiles

commit 70b528fd8419412249cb70f47c211570fb511ee7
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu May 3 14:24:23 2018 -0400

    save magic lines to reduce allocator unit from 64MB to 4MB

commit 0ef0e6d928b7913dcb0dde79cd6de6339e0db031
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu May 3 14:28:09 2018 -0400

    fix oom infinite loop

commit 69c7b14abd3fe289507ff85de2a11e82b8a0acfa
Merge: 0ef0e6d928 e3e0939d22
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu May 3 14:29:50 2018 -0400

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit d1df9922669b010b11a8a184f6c7cdadb5d60dc8
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed May 16 11:37:31 2018 -0400

    remove userbuf allocator pool
    
    as requested by rtm. it gives <3% performance on our full application
    benchmarks.

commit cfe71aac6c2b34f3e77e863141318636a2f18bbb
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed May 16 12:03:39 2018 -0400

    prevent OOM killer from GCing constantly immediately after killing

commit 7674d66b4db5ee96432a0ab6fd3f6b097adcaa9d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed May 16 12:04:58 2018 -0400

    memory fs flag

commit b1403637c17c974c7d08d48643de965f1bae8082
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed May 16 12:17:28 2018 -0400

    percentile dump

commit 50ee3a12710b78ee4357aa5c1c5ce162d343b6f0
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed May 16 12:20:06 2018 -0400

    simpler gc printer

commit 86bd5624fa48bbb4fb1890f2a651105285cf3843
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed May 16 12:27:40 2018 -0400

    x

commit 449f846c111657c25defe1efc355d58490aa351f
Merge: 86bd5624fa 70b528fd84
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed May 16 14:05:23 2018 -0400

    Merge branch 'remerge'
    
    merge go1.10.1! goodbye go1.8

commit 94e1fba19e4d8d4bbc112d95bf580ed563fad521
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed May 16 14:40:14 2018 -0400

    fix previous fix
    
    introduced a deadlock when fixing a file size race... code that acquires an
    inode lock and log admission must get log admission before locking the inode.

commit 5487da153bfc0da5fd974e6b000305d558b870a1
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue May 22 10:14:40 2018 -0400

    per-CPU backtrace support, too
    
    begin post-submission cleanup tasks!

commit fb4e21b0b4a9c34ce8ca9f08d060cda73d668b74
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue May 22 10:27:39 2018 -0400

    fix CPU display family/model calculation

commit b789efae68ba3d1349db7561981f57782bcbdb64
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu May 24 11:50:25 2018 -0400

    cleanup

commit 5dfc23a332707c762cdc1852e7c6476aa11d641f
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu May 24 16:47:29 2018 -0400

    find both go1.8 and go1.10 style write barriers

commit e147880f1f21675234696e323bd8367b00ab55f7
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jun 4 12:50:13 2018 -0400

    opid == 0 with memfs is OK; don't panic

commit 344dda35baf06658ea42e2470928e60fea308729
Merge: e147880f1f e3e1794fe3
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jun 4 12:50:56 2018 -0400

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit 9a48c6f6f31249cdf1a68fb3dece0714b7a65d66
Merge: 344dda35ba fadc22a0a9
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Jun 5 08:36:34 2018 -0400

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit 0a9fea2b8f81811d806ed00f1095d3ec4a6eaf47
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Jun 5 08:46:17 2018 -0400

    add lstat(3) as wrapper around fstat(2)
    
    for no good reason

commit 4f0ba91ab7d995f58f1514659f2c188b6f4fa6f5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Jun 7 11:24:33 2018 -0400

    x

commit 8a1b0cd262fcb207c9e00099b12eb5339cf95b01
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Jun 7 11:34:49 2018 -0400

    Revert "x"
    
    This reverts commit 4f0ba91ab7d995f58f1514659f2c188b6f4fa6f5.
    
    did not mean to commit all that debugging crap...

commit dfb902df769a154e6f0a880b4dc71f017eb61016
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Jun 7 11:35:55 2018 -0400

    try again...

commit 0866ef9079c3093ce049d780442e86e1fdeadd98
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Jun 19 12:01:19 2018 -0400

    remove frans halp, add todo

commit 5ad5266af47bd33f445372e92e5aa108b8b11bfa
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jun 25 12:56:33 2018 -0400

    explicitly set mutator assist factor, cleanup

commit 303ff897fab55d83c9b52fd01098db5429ad66e1
Merge: 5ad5266af4 17cf214e69
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jun 25 13:34:27 2018 -0400

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit 68660f834baed6b60aa48a53d0d4e7b148355197
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Jun 27 17:13:20 2018 -0400

    dump caller rips

commit 2081f1a3e270062fa2418a26dab4f37039c151ea
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Jul 11 12:31:04 2018 -0400

    runtime.[LSM]fence()

commit fc7f26c04f07f1dde51d36be7a7ad48666285f6b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Jul 17 11:02:10 2018 -0400

    instead of once, push '\' three times within one second to panic
    
    so i won't punch my monitor of my desk

commit e02ae2be85c3ce8d75623784c6b08ff9e7145fd0
Merge: fc7f26c04f 38d7c136c9
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Jul 20 16:06:32 2018 -0400

    Merge remote-tracking branch 'origin/refactor' into refactmerge

commit cbc00a23067bf421de50dd3cbdb5e588200cb3b5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Jul 20 16:12:53 2018 -0400

    common -> defs

commit 91e0b7ef4cfd7ced1c4eb1220459162f3f91673b
Merge: cbc00a2306 b01c587972
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 23 10:58:59 2018 -0400

    Merge remote-tracking branch 'origin/refactor' into refactmerge

commit ec4cfb25d0ad2ace2eaa2da94627a4a0b790332c
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 23 13:08:02 2018 -0400

    post-submission MAXLIVE

commit 461e840040e5eab140af675c3346db7eb712eaa1
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 23 13:10:52 2018 -0400

    x

commit ef623fd962a5fa8b5ed8889bcdec76a990d381bf
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 23 13:11:28 2018 -0400

    maxlive dir

commit ff5fe86f9837cea2ccca055d24c8538a71bfb0d1
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 23 13:11:56 2018 -0400

    script to quickly add annotations

commit eb8bdc040050de881a2dc034a866deba184bea12
Merge: 91e0b7ef4c ff5fe86f98
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 23 13:13:53 2018 -0400

    Merge branch 'master' into refactmerge

commit 47177dd141e35424206567a5450b6610684f2967
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 23 13:37:54 2018 -0400

    x

commit c3359466daf649777521866e0aeaf477760d7616
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 23 13:38:05 2018 -0400

    make init(1) size heap for our evaluation

commit 5f15ef30627f8bce8647e8e6c585fddda2c4e972
Merge: 47177dd141 c3359466da
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 23 13:39:04 2018 -0400

    Merge branch 'master' into refactmerge

commit d52f381ca6534fcc547f9ca751783630da1f7701
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 23 15:09:31 2018 -0400

    unconditionally update directory data blocks

commit ed62bf8ff43ef3c63361b07a39a60ebb32dcfc51
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Jul 24 10:34:12 2018 -0400

    update vnode bloating code

commit d746b6d0a82c20a8dc5106c643f3a7f16ed5bc2e
Merge: ed62bf8ff4 01c1edad20
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Jul 24 10:42:11 2018 -0400

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit 2925fec25aee2eee1954c3863c6e1deb8a19fce2
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Jul 24 11:04:30 2018 -0400

    simplify how the GC replenishes reservation credit

commit 76431e8b28631ed1943033884afb2c3355b2800e
Merge: 2925fec25a e91ac3e9cf
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Jul 24 14:15:57 2018 -0400

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit f643b76cc4e774f028f9042a555b9f824f646d0b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Jul 24 17:02:36 2018 -0400

    checkpoint size-class reservations

commit 841f938a2207cadc1c96a5941f933682ff52d763
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Jul 27 12:12:59 2018 -0400

    prevent race between allocating OomCh and blocking on OomCh

commit 82fded59d7a7d3f16323a48679bc9ffe2bf42502
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Jul 28 17:14:49 2018 -0400

    verify CPU SSE/AVX support

commit 5fc29bd3e1d27383e9d4b20f2693030f80e9d1e0
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Jul 28 18:22:09 2018 -0400

    SSE optimized, distributed size-class reservations
    
    (still uses live bytes since MAXLIVE doesn't support size-classes)
    
    throughput is still good: parrun performance is 16.1k msgs/sec and nginx is
    higher than the submission. using SIMD for adding/subtracting/comparing
    size-classes improves throughput by ~6% compared to iteration.

commit 026c67444c11ef4c0f5017945b44e16c9598809c
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Jul 28 18:42:25 2018 -0400

    tests for SSE size-class functions

commit 2d6361a2b0997521b45b664a05b5ac37adc6a8a9
Merge: 026c67444c b86f504344
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Jul 28 18:44:12 2018 -0400

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit b616504a351f6a1dc456dbd7d07528c82a2e445f
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 30 09:01:31 2018 -0400

    x

commit ce3cd47a44aa2293d683ff0d87fa6f21df2e2272
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 30 09:10:24 2018 -0400

    x

commit 80471afb6d072aa6731075f7afe553038a3f5688
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 30 11:01:21 2018 -0400

    disable ulimits for testing

commit 8fe8f81b94161fd1505eeba1b5d93ec41cb81821
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 30 18:57:54 2018 -0400

    remove unnecessary second call to mkobj()

commit a6833be863d5cf68091923d373c808565144b675
Merge: 8fe8f81b94 3bedfb2756
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 30 18:58:31 2018 -0400

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit 0fe62e95266e639ba9a9588391bc9faf0550baf1
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Jul 30 19:26:31 2018 -0400

    whoops; must increase limit before increasing heap RAM

commit 1e90c0ff1d7efb1e03ee694bd96fee8c732d6992
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Jul 31 15:43:22 2018 -0400

    restructure Userargs loop for maxlive
    
    forgot to merge this from last memory analysis

commit 31d724ed2c10335e986dd1aa302307249ecc6606
Merge: 1e90c0ff1d d5a19725a4
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Jul 31 15:44:29 2018 -0400

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit ed4980c55322c9e7cfa847314609721795d2d4b0
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Aug 1 16:05:49 2018 -0400

    bugfix bugfix

commit 36ca2972c5a97aacaea61b66aa9384807fbc2e5b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Aug 1 16:06:33 2018 -0400

    nit

commit 59ca22051b1020191d810c6fa50c3409585d7d16
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Aug 3 12:01:26 2018 -0400

    recomputed reservation bounds
    
    excepting redis, throughput/latency is still better than in the submission

commit 6272844f87d868a9cb3ab5f10c86eb2f08719b34
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Aug 3 12:12:16 2018 -0400

    maxlive updates: new kernel packages, size-class counting, and a fix or two

commit f2dc01d95d7520c5a4b7a411f3eac78d09eeeeb4
Merge: 6272844f87 47d83d16e1
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Aug 3 12:15:06 2018 -0400

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit 6f1fad0afa3ce360031ff03387368ce63c0a7377
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Aug 3 12:18:22 2018 -0400

    shrink dir hashtables from 1,000 to 100 buckets
    
    doesn't seem to affect performance and reduces maxlive bounds
    
    eventually, we probably should use a single, global dirent cache

commit 55f5b27585e2fcfa06391c8a33b66690d72367f4
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Aug 6 17:38:00 2018 -0400

    tax script update

commit 29bc261bd01400045b970e602d33c758c595d1e7
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Aug 6 17:38:17 2018 -0400

    avoid allocation for debug string

commit 4b8cf886583ad0909536cc14b6891cd4cbe10a80
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Aug 6 17:39:35 2018 -0400

    x

commit 011be40afbee79fb5e72b155ed9f7e97a10349d8
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 7 09:06:40 2018 -0400

    redis experiment script

commit 7a034c96f69367720cab9f3873e7ccae14162f3e
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Aug 13 19:12:54 2018 -0400

    optimistic, lock-free TCP poll(2)
    
    use double-checked locking to prevent missed wakeups. gives us 10% on redis.

commit e8bdfe39ca391de4d6135196b75d6e0ecb5d7210
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Aug 13 19:18:18 2018 -0400

    forgot script

commit 459cd6e47dcba3c7261bdc9d6dab80a51e9775cd
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Aug 13 20:42:32 2018 -0400

    faster timestamp in TCP stack
    
    and avoid a redundant call or two. gives us 5-8% on redis.

commit 7412786f32371b9137c16b5d829f0c9f0ce1ca0c
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 14 09:29:56 2018 -0400

    fix /dev/cons polling
    
    we broke it the first time we split biscuit into packages. it is very useful
    for TCP testing over loopback via lnc(1).

commit 48ef2c57f4307866f4d8d3d2ffc372547ec4ad4d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 14 11:50:49 2018 -0400

    lnc(1) bugfix: wait for EOF on both stdin and the socket

commit 444972daac503420ee6bea590b92eb573996f11d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 14 11:52:31 2018 -0400

    release TCP socket buffers on last close, not after entering TIMEWAIT
    
    a user program may not read all data before both sides close the connection.
    this bug only occured during tests over loopback.

commit b99a183e6589de221930513342a9551cba59afa4
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 14 11:56:12 2018 -0400

    whoops, fix comparison of sequence numbers which breaks if they wrap

commit 9bf0267d601508e44ff43aa3e5abfb53cfd6c142
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 14 17:42:07 2018 -0400

    be more careful about when to free socket buffers
    
    can't free them on last close since unless they are in timewait.

commit 527024e04f4888710261f6d74af9768a75418af8
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 14 17:57:28 2018 -0400

    restore ACK delaying
    
    my recent ack hack broke it. remove the ack hack and fix the real problem:
    incorrect MSS size which didn't account for TCP option length (though TSO in
    the ixgbe driver did). thus bimage isn't super slow due to Linux waiting for an
    ack sent by a timeout after sending a single MSS of the new image.
    
    redis performance is good again!

commit 654a4ffafa83c56e2991fc5c9ffbc53b58773e7d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 14 18:05:34 2018 -0400

    fix ACK validity sanity check
    
    an ack is valid in [una, nxt), not [una, una + ready TX bytes).
    (there may be far more bytes in the TX socket buffer than the send window)

commit abf657b7f32624852c6fda9b8018f67f02d50eb9
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Aug 16 13:23:33 2018 -0400

    update vnode bloating code
    
    don't use fake directory since it wastes tons of memory on dcache hashtable

commit 58b7e6e4fefffe6f43a6789f1c07999021a88385
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Aug 16 13:24:48 2018 -0400

    count write barrier flushing functions against write barrier tax

commit 4fc1a229194cedf7b33bdb020df2c2ed971ac2e1
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Aug 16 13:26:08 2018 -0400

    script to calculate all HLL taxes

commit 916a7b0a1726e81c5ad68a740e27a648e50df73e
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Aug 17 12:00:17 2018 -0400

    in fdopendir(3), using dirent name instead of inum to distinguish valid dirents
    
    inum of 0 used to be invalid, but it is now valid (root directory). i was
    wondering where "." and ".." in root and the immediate children of root went.

commit 6170fd700a3b7f04077e67b3815b11e85a318e91
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Aug 17 13:53:39 2018 -0400

    fix a few unbalanced refcount bugs in namei
    
    refcounts seem correct now. maybe eviction will work!

commit 7dc7fa9b4ecbde8bac7eee303a6cfe3884aa7f6d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Aug 20 13:58:21 2018 -0400

    fix funny empty dir check typo
    
    found via working eviction. wasn't discovered before because all dirents are
    nearly always in present in memory without eviction.

commit 28671d82d53ae54764ec6331c40aed275304b287
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 21 09:22:40 2018 -0400

    x

commit d9227c9b46070028aae89193b7c33bd67ba24393
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 21 09:51:11 2018 -0400

    allocate dirents in ascending order
    
    just so ls lists files in creation order

commit 6aa2c1f3c894a0fdd0525971e3e5cacfbadb902e
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 21 10:52:28 2018 -0400

    ensure locked during dir ops
    
    even the child inode must be locked on creation as it may race with eviction.

commit 1aa692551b499b4d1a9cf3b6ce60beeef5dc935a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 21 10:54:34 2018 -0400

    fix two block refcount leaks

commit 18eaaecf01b47d4afdf209053fc4a02ac80097f8
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 21 10:57:15 2018 -0400

    release refcounts on logged blocks only after containing transaction has been applied
    
    thus future reads of blocks which are in the log but not yet installed to disk
    are guaranteed to be in the block cache. after the log is applied, it is safe
    to release the refcount since the reads will fetch the block from disk.

commit 81698d5f471aec201983fef6620b6ba319648868
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 21 11:03:58 2018 -0400

    eviction routine updates

commit b23939e966846ad6708b29125d5121d7cb4f0f94
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 21 11:07:53 2018 -0400

    remove per-imemnode parent lists
    
    the parent lists are difficult to maintain efficiently and without deadlocking
    with eviction (must update the parent lists of both the parent and children
    dirents of an evicted directory inode).
    
    make a dirent's pointer to an imemnode not increase the refcount of the target
    imemnode. because unopened, unused files now have a refcount of 0, lock-free
    namei must check that the target imemnode's link count is non-zero since the it
    was looked-up without locking its parent, which may have been concurrently
    unlinked.

commit 178f3a0b428755ea6d2dd96eac1c499b4fe0a320
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 21 11:16:45 2018 -0400

    lock for rename's _isancestor is now acquired by namei

commit 1d1e1be705627e93d04924ef1e5a4835fc980c29
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 21 11:19:34 2018 -0400

    nits

commit 0eded277d6084a0231fee04c03952846290656db
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 21 13:43:06 2018 -0400

    bugfix: make sure unlink observes 0 refcount with concurrent lock-free namei
    
    fixes usertests

commit ea32abf6fe48ecc83166df345ff9e22790435e69
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 21 15:14:29 2018 -0400

    return dead inode to caller from namei

commit 2763f726f3a27bbf4c31e054d236acf105299047
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 21 16:16:23 2018 -0400

    check dead for all namei calls
    
    passes all tests

commit 2ba61918d76a7219d63e13ce20c0c23dfcb574e0
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 21 17:30:37 2018 -0400

    fix leaked inode lock in _isancestor
    
    god dammit

commit 71c65f42e8c162d355a97e969644926081819b32
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Aug 21 22:27:14 2018 -0400

    avoid superfluous reservation

commit e699f5f8777420da30cc376acb3225752d3f4628
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Aug 22 15:43:56 2018 -0400

    remove obsolete dcache syslimit

commit 427b92a6f448f220948bb1182d47ca5333942848
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Aug 22 15:44:37 2018 -0400

    check dead and handle deep reservation failures in mkdir(2)

commit 2694a7da4122aa1c26545c30a25a673dc935ca8b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Aug 22 15:46:11 2018 -0400

    update GCX() for go1.10.1
    
    synchronize with GC to prevent the OOM killer from forcing two back-to-back
    GCs.

commit eda6a4d1ec6c8495558a86fb8457ecd093bdc3ac
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Aug 22 15:47:38 2018 -0400

    enable reservations after boot
    
    log recovery can allocate a lot, exhausting the 1MB boot reservation. init(1)
    will set the correct heap limit.

commit c4c2158042930b13244a59d4a74ff690c747a88d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Aug 24 09:09:26 2018 -0400

    reminder

commit 414389959af9d740ad419eeb3547376662ff7685
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Aug 24 13:37:55 2018 -0400

    Aspace_t -> Vm_t
    
    to save my left hand

commit eff097fadfbd8c02fcb31f22367f84b7859d226b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Aug 27 12:28:54 2018 -0400

    complete Dmap_init if 1GB pages are supported

commit ac6f06b9eb2ccded2a9ce3c3b318e37e4a7614c6
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Aug 27 18:17:03 2018 -0400

    add PCI device ID of new hardware's SATA controller
    
    frans's AHCI driver supports it

commit c79cdf5337b10e0bdd2bd64cd938feb1d9319888
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Aug 27 18:19:50 2018 -0400

    x

commit 2c4cd606649c393c515b4dabded861ee2e43131a
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Sep 5 13:18:43 2018 -0400

    fix path to bootloader .d files

commit c7300965962d6c361cd581d7d9b15455aceee72f
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Sep 5 13:19:45 2018 -0400

    option for dTLB store misses in time(1)

commit 40d67c8fbe1aeb7d9520383d7b84d30776536d2d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Sep 26 09:05:04 2018 -0400

    MIT license, use biscuit's README.md

commit 5f9f8f2797cdc73ba0c448dc122160834ec0414d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Sep 26 09:34:32 2018 -0400

    fix bootloader bug
    
    caused no problems since it reads blocks in ascending order. stumbled upon it
    while browsing the source on github!

commit bc427f6562ee02f6f52c654cc1fe37e54e2a4bea
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Sep 26 09:57:27 2018 -0400

    x

commit 59d815e902c6576d06c99d45e85d25061eb150ff
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Sep 26 10:10:13 2018 -0400

    explicitly set accessed/dirty on page fault
    
    mainly because i think it is a really neat optimization and it took me a week
    to find it. it improves cmailbench xput by 2%.
    
    if we cared to optimize page faults more, this optimization would soon become
    important.

commit 6180539d5bdf7ff0ac990dc7e3155fe3e730c75d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Oct 5 09:15:17 2018 -0400

    x

commit 3355de3066f9f1242d7a5bc5c7c07d900b0ba560
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Oct 5 09:37:03 2018 -0400

    x

commit 67a9704758cca107b18bfed3f8f614e6552baf39
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Oct 5 09:53:11 2018 -0400

    authors/contributors

commit fabd9611985b29542b97a8e2ddb1a5beaf804c6c
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Oct 5 10:03:25 2018 -0400

    x

commit e83b17a14af3cf38dc6b5d3435f138228e15c279
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Oct 5 13:48:29 2018 -0400

    x

commit 26c83e7d936068075260a51ff4817d094ba2b637
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Oct 5 13:54:35 2018 -0400

    remove some immaturity from my youth

commit dbda51f5542560c697960a1fcc3c893b8f63e59f
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Oct 8 18:28:44 2018 -0400

    x

commit 390acd3dc4f987718f8871e8278747de8c019b88
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sun Oct 21 08:35:21 2018 -0400

    nit

commit 699d36b73f72c396762fca2a0e97f1732b53406d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Oct 31 09:49:02 2018 -0400

    remove golang's CONTRIBUTING.md to prevent confusion

commit 668988921cbdf15e2739a689fc6adf1e3d8d670b
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Nov 27 09:49:56 2018 -0500

    remake /boot/uefi dir; usertest's cwdtest requires it

commit fc0a5c59668fde8848ad34337acaccdc032c3c33
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Nov 27 10:00:44 2018 -0500

    malloc(3), use doubly linked list

commit fb482819e88394fc13e2c2ef195e63f5b28ba5d5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Nov 27 10:02:58 2018 -0500

    malloc(3) bug
    
    free(3) will munmap the segment if it has 0 live objects and isn't the segment
    currently being allocated into. fix malloc to munmap these unused, cached
    segments when malloc allocates a new cached segment.
    
    thanks, easydaniel!

commit 2a2dbe1228881c94764f1cdf6134dca27defab12
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Nov 27 10:09:26 2018 -0500

    fix single page leak in mmap error path

commit 34fdabbe0ae4e5e6c9d78813c507cc7926272334
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Jan 12 12:45:54 2019 -0500

    before i forget

commit 259ccd1ab9cafeedd71cce00476203ed2c7a18a3
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Jan 24 11:44:12 2019 -0500

    remove old image script

commit 29171921f44168eb094740501be0acd10e142b06
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Jan 24 15:21:56 2019 -0500

    bhw2 imaging

commit 19424651ca691fc77a0a6d505a69c869981c62e1
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Jan 24 15:28:17 2019 -0500

    x

commit 99109907aebcdf4d34acf3b19f1d071ffbcb4701
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Jan 25 13:00:59 2019 -0500

    fix size of AHCI port MMIO regs

commit 0d837d5ad37bbcc545abce9a664fa0be2eb516f5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Jan 25 13:43:00 2019 -0500

    diff ips for bhw/bhw2

commit 1dc8454c823a570c52bc57e8613cb41437c1d68d
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Feb 4 21:07:21 2019 -0500

    stores to MMIO registers must not be locked
    
    hurray, bhw2 finally works! goodbye four days of my life

commit b9ce068468d9fd75b662aacb09e34df933f52270
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Feb 4 21:13:32 2019 -0500

    bhw2 AHCI controller
    
    should instead attach to AHCI devices based on PCI CC register.

commit 42fce140964600bce24bf891fc2a63e0d35b2d25
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Feb 4 21:29:22 2019 -0500

    sanity and padding checks

commit 64ce540d9734823c29813d155678915003537174
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Feb 4 21:42:40 2019 -0500

    pedantic cleanup

commit d939b5b5ed154502c642488171e05a9b1e2858f9
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Feb 4 21:58:09 2019 -0500

    ensure feature words are valid

commit 946ad13e8a2477c207097deb805bfb6b860e022f
Merge: 1dc8454c82 19424651ca
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Feb 4 22:07:10 2019 -0500

    Merge branch 'master' of g.csail.mit.edu:biscuit

commit 60a722d8fef490f418a189fe32de1e4ffb37aa20
Merge: 946ad13e8a d939b5b5ed
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Mon Feb 4 22:07:45 2019 -0500

    Merge branch 'cleanup'

commit 990581c5a41f9295e16da78182d3079962481c17
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 5 09:17:19 2019 -0500

    -r switch to start rshd from init(1)
    
    keyboard/serial console input is broken on bhw2 (maybe IOAPIC is
    misconfigured?); work around with rshd/telnet.

commit 11debf42cdfa39ce19f20cb66c7e72feb9b93bca
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 12 17:01:59 2019 -0500

    another missed make dependency

commit 485de00b5adb1ad0247a1684c4bf0f9b6f62b57e
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 12 17:25:33 2019 -0500

    fix LAPIC version check

commit 962068ba3b7c71342376d08792433410727a09cf
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 12 17:29:00 2019 -0500

    IO APIC redirection table is initially undefined
    
    biscuit assumed it was zeroed. bhw's firmware does zero it, but bhw2's doesn't.

commit 5142c3db662651ffefec2d603e8e95ee39cf60bb
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 12 17:34:03 2019 -0500

    make sure to use the correct IO APIC
    
    bhw2 has three IO APICs (!), make sure to program and use the IO APIC which
    handles the ISA interrupt lines.
    
    this fixes bhw2's keyboard and serial console!

commit c8d9356d7759b8c9f6b46777568f5c9b0cf71290
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 12 17:39:37 2019 -0500

    cleanup

commit 4b03828582b806a7b50db38f8515e9fffb4dc0a4
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 12 17:49:43 2019 -0500

    ICMP echo debugging hack

commit 2a63c646ef8c999eb491e74e883dd7f8754e08ad
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Feb 13 08:30:07 2019 -0500

    less boot printing

commit 7d320f31de71051a996978dd6ced377e327d03d1
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Wed Feb 13 15:26:13 2019 -0500

    disable syscall fast path
    
    it improves performance only a little and has been broken for a while.

commit 878d28f8c995cc129073be59a68c9f9d6df03f7f
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Thu Feb 14 17:35:37 2019 -0500

    fix race between AP bootup and first TLB shootdown
    
    if a CPU sends a TLB shootdown IPI before an AP has enabled its LAPIC, the IPI
    will apparently be lost. the sender will loop forever, waiting for a TLB
    shootdown acknowledgment that will never occur.
    
    the race was unlikely to occur with low core counts, but with bhw2's 20 CPUs,
    it occurred every boot.
    
    fix this race by making the BSP wait until all APs have configured their
    LAPICs.

commit 528f464fc16d0c19861b2a61f1d51ddcd8b5b232
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 19 10:34:26 2019 -0500

    x

commit 964a35615adfe79c971c57b138c5ef493d5fbdf3
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 19 11:23:37 2019 -0500

    x

commit 2cf86de45213bd52f55100d7acff64959860a291
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 19 11:38:41 2019 -0500

    remove old and confusing debug hack

commit dbeb6394d74a80954882bf302622339032ed0e18
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Tue Feb 19 20:34:55 2019 -0500

    fix feof(3) for unbuffered streams

commit 25fddeb2d8af061aa62446fe9d6c8c3ecebf93a5
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Fri Feb 22 16:00:10 2019 -0500

    vary(1), to help find scalability problems

commit 9775142c8695dd93ca059d91f16c2aaef3ad884c
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Feb 23 09:29:44 2019 -0500

    x

commit e11ecef1612ded1d050f51aa73d012fc3e1bb238
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Feb 23 09:30:29 2019 -0500

    ensure CPUID leafs are supported

commit 565ddaf86cea6461649f22a362409682c9ea1d58
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Feb 23 10:44:08 2019 -0500

    fine-grained control of CPU use
    
    bhw2 has 2 sockets with 10 cores and hyperthreads. add support to
    enable/disable specific CPUs at various levels.

commit 175c5ab63fc4fe6e11b821541566f5c496f422e1
Author: Cody Cutler <ccutler@csail.mit.edu>
Date:   Sat Feb 23 10:48:38 2019 -0500

    raise MAXCPUS to 64
